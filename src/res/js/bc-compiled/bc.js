var BC=function(h){var d=h.Matrix=h.Matrix||{};d.makeLookAt=function(a,c,f){c=BC.Math.normalize(BC.Math.subtractVectors(a,c));f=BC.Math.cross(f,c);var b=BC.Math.cross(c,f);return[f[0],f[1],f[2],0,b[0],b[1],b[2],0,c[0],c[1],c[2],0,a[0],a[1],a[2],1]};d.makePerspective=function(a,c,f,b){a=Math.tan(0.5*Math.PI-0.5*a);var d=1/(f-b);return[a/c,0,0,0,0,a,0,0,0,0,(f+b)*d,-1,0,0,f*b*d*2,0]};d.makeTranslation=function(a,c,f){return[1,0,0,0,0,1,0,0,0,0,1,0,a,c,f,1]};d.makeXRotation=function(a){var c=Math.cos(a);
a=Math.sin(a);return[1,0,0,0,0,c,a,0,0,-a,c,0,0,0,0,1]};d.makeYRotation=function(a){var c=Math.cos(a);a=Math.sin(a);return[c,0,-a,0,0,1,0,0,a,0,c,0,0,0,0,1]};d.makeZRotation=function(a){var c=Math.cos(a);a=Math.sin(a);return[c,a,0,0,-a,c,0,0,0,0,1,0,0,0,0,1]};d.makeScale=function(a,c,f){return[a,0,0,0,0,c,0,0,0,0,f,0,0,0,0,1]};d.makeInverse=function(a){var c=a[0],f=a[1],b=a[2],d=a[3],k=a[4],g=a[5],h=a[6],q=a[7],p=a[8],r=a[9],v=a[10],s=a[11],e=a[12],l=a[13],m=a[14];a=a[15];var t=v*a,x=m*s,u=h*a,A=
m*q,C=h*s,D=v*q,B=b*a,E=m*d,y=b*s,z=v*d,w=b*q,F=h*d,G=p*l,H=e*r,I=k*l,J=e*g,K=k*r,L=p*g,M=c*l,N=e*f,O=c*r,P=p*f,Q=c*g,R=k*f,S=t*g+A*r+C*l-(x*g+u*r+D*l),T=x*f+B*r+z*l-(t*f+E*r+y*l),l=u*f+E*g+w*l-(A*f+B*g+F*l),f=D*f+y*g+F*r-(C*f+z*g+w*r),g=1/(c*S+k*T+p*l+e*f);return[g*S,g*T,g*l,g*f,g*(x*k+u*p+D*e-(t*k+A*p+C*e)),g*(t*c+E*p+y*e-(x*c+B*p+z*e)),g*(A*c+B*k+F*e-(u*c+E*k+w*e)),g*(C*c+z*k+w*p-(D*c+y*k+F*p)),g*(G*q+J*s+K*a-(H*q+I*s+L*a)),g*(H*d+M*s+P*a-(G*d+N*s+O*a)),g*(I*d+N*q+Q*a-(J*d+M*q+R*a)),g*(L*d+O*q+
R*s-(K*d+P*q+Q*s)),g*(I*v+L*m+H*h-(K*m+G*h+J*v)),g*(O*m+G*b+N*v-(M*v+P*m+H*b)),g*(M*h+R*m+J*b-(Q*m+I*b+N*h)),g*(Q*v+K*b+P*h-(O*h+R*v+L*b))]};d.matrixMultiply=function(a,c){return[a[0]*c[0]+a[1]*c[4]+a[2]*c[8]+a[3]*c[12],a[0]*c[1]+a[1]*c[5]+a[2]*c[9]+a[3]*c[13],a[0]*c[2]+a[1]*c[6]+a[2]*c[10]+a[3]*c[14],a[0]*c[3]+a[1]*c[7]+a[2]*c[11]+a[3]*c[15],a[4]*c[0]+a[5]*c[4]+a[6]*c[8]+a[7]*c[12],a[4]*c[1]+a[5]*c[5]+a[6]*c[9]+a[7]*c[13],a[4]*c[2]+a[5]*c[6]+a[6]*c[10]+a[7]*c[14],a[4]*c[3]+a[5]*c[7]+a[6]*c[11]+a[7]*
c[15],a[8]*c[0]+a[9]*c[4]+a[10]*c[8]+a[11]*c[12],a[8]*c[1]+a[9]*c[5]+a[10]*c[9]+a[11]*c[13],a[8]*c[2]+a[9]*c[6]+a[10]*c[10]+a[11]*c[14],a[8]*c[3]+a[9]*c[7]+a[10]*c[11]+a[11]*c[15],a[12]*c[0]+a[13]*c[4]+a[14]*c[8]+a[15]*c[12],a[12]*c[1]+a[13]*c[5]+a[14]*c[9]+a[15]*c[13],a[12]*c[2]+a[13]*c[6]+a[14]*c[10]+a[15]*c[14],a[12]*c[3]+a[13]*c[7]+a[14]*c[11]+a[15]*c[15]]};return h}(BC||{});BC=function(h){(h.Time=h.Time||{}).getTimeInSeconds=function(){return 0.001*Date.now()};return h}(BC||{});BC=function(h){(h.Ring=h.Ring||{}).makeRing=function(d,a,c){for(var f=a.numSlices,b=a.outerRadius,n=a.maxY,k=a.minY,g=BC.Math.circlePoints(a.innerRadius,f),f=BC.Math.circlePoints(b,f),b=[],h=[],q=0,p=function(a,b,c,d,f,e,g){b=a.textureCoord(b,c);h[q++]=b[0];h[q++]=b[1];b=a.textureCoord(d,f);h[q++]=b[0];h[q++]=b[1];b=a.textureCoord(e,g);h[q++]=b[0];h[q++]=b[1]},r=0,v=0,s=0,e=0,l=0;s<a.numSlices;s++,l+=2){for(var m=(l+2)%f.length;v===r;)r=Math.floor(Math.random()*c.length);var v=r,t=c[r];b[e++]=g[l];
b[e++]=n;b[e++]=-g[l+1];b[e++]=f[l];b[e++]=n;b[e++]=-f[l+1];b[e++]=f[m];b[e++]=n;b[e++]=-f[m+1];p(t,0,0,0,1,1,1);b[e++]=g[l];b[e++]=n;b[e++]=-g[l+1];b[e++]=f[m];b[e++]=n;b[e++]=-f[m+1];b[e++]=g[m];b[e++]=n;b[e++]=-g[m+1];p(t,0,0,1,1,1,0);b[e++]=g[l];b[e++]=k;b[e++]=-g[l+1];b[e++]=f[m];b[e++]=k;b[e++]=-f[m+1];b[e++]=f[l];b[e++]=k;b[e++]=-f[l+1];p(t,0,0,1,1,0,1);b[e++]=g[l];b[e++]=k;b[e++]=-g[l+1];b[e++]=g[m];b[e++]=k;b[e++]=-g[m+1];b[e++]=f[m];b[e++]=k;b[e++]=-f[m+1];p(t,0,0,1,0,1,1);b[e++]=f[l];b[e++]=
k;b[e++]=-f[l+1];b[e++]=f[m];b[e++]=k;b[e++]=-f[m+1];b[e++]=f[m];b[e++]=n;b[e++]=-f[m+1];p(t,0,1,1,1,1,0);b[e++]=f[l];b[e++]=k;b[e++]=-f[l+1];b[e++]=f[m];b[e++]=n;b[e++]=-f[m+1];b[e++]=f[l];b[e++]=n;b[e++]=-f[l+1];p(t,0,1,1,0,0,0);b[e++]=g[l];b[e++]=k;b[e++]=-g[l+1];b[e++]=g[m];b[e++]=n;b[e++]=-g[m+1];b[e++]=g[m];b[e++]=k;b[e++]=-g[m+1];p(t,0,1,1,0,1,1);b[e++]=g[l];b[e++]=k;b[e++]=-g[l+1];b[e++]=g[l];b[e++]=n;b[e++]=-g[l+1];b[e++]=g[m];b[e++]=n;b[e++]=-g[m+1];p(t,0,1,0,0,1,0)}var x=d.createBuffer();
d.bindBuffer(d.ARRAY_BUFFER,x);d.bufferData(d.ARRAY_BUFFER,new Float32Array(b),d.STATIC_DRAW);var u=b.length/3,A=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,A);d.bufferData(d.ARRAY_BUFFER,new Float32Array(h),d.STATIC_DRAW);return{draw:function(a,b){d.bindBuffer(d.ARRAY_BUFFER,x);d.enableVertexAttribArray(a);d.vertexAttribPointer(a,3,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,A);d.enableVertexAttribArray(b);d.vertexAttribPointer(b,2,d.FLOAT,!1,0,0);d.drawArrays(d.TRIANGLES,0,u)}}};return h}(BC||
{});BC=function(h){(h.Selector=h.Selector||{}).makeSelector=function(d,a,c){var f=a.minY,b=a.maxY;a=BC.Math.circlePoints(a.outerRadius+0.01,a.numSlices,-Math.PI/2);var n=a.length-2,k=[],g=0;k[g++]=a[n]+0.001;k[g++]=f;k[g++]=-a[n+1]-0.001;k[g++]=a[0]+0.001;k[g++]=f;k[g++]=-a[1]-0.001;k[g++]=a[0]+0.001;k[g++]=b;k[g++]=-a[1]-0.001;k[g++]=a[n]+0.001;k[g++]=b;k[g++]=-a[n+1]-0.001;k[g++]=a[0]+0.001;k[g++]=f;k[g++]=-a[1]-0.001;k[g++]=a[2]+0.001;k[g++]=f;k[g++]=-a[3]-0.001;k[g++]=a[2]+0.001;k[g++]=b;k[g++]=-a[3]-
0.001;k[g++]=a[0]+0.001;k[g++]=b;k[g++]=-a[1]-0.001;var h=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,h);d.bufferData(d.ARRAY_BUFFER,new Float32Array(k),d.STATIC_DRAW);f=c.textureCoord(0,0);b=c.textureCoord(1,0);a=c.textureCoord(1,1);c=c.textureCoord(0,1);c=new Float32Array([].concat(f,b,a,c,f,b,a,c));var q=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,q);d.bufferData(d.ARRAY_BUFFER,c,d.STATIC_DRAW);var p=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7]),r=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,
r);d.bufferData(d.ELEMENT_ARRAY_BUFFER,p,d.STATIC_DRAW);return{draw:function(a,b){d.enable(d.BLEND);d.bindBuffer(d.ARRAY_BUFFER,h);d.enableVertexAttribArray(a);d.vertexAttribPointer(a,3,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,q);d.enableVertexAttribArray(b);d.vertexAttribPointer(b,2,d.FLOAT,!1,0,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,r);d.drawElements(d.TRIANGLES,p.length,d.UNSIGNED_SHORT,0);d.disable(d.BLEND)}}};return h}(BC||{});BC=function(h){(h.Game=h.Game||{}).run=function(){function d(){return f.width!=f.clientWidth||f.height!=f.clientHeight?(f.width=f.clientWidth,f.height=f.clientHeight,!0):!1}function a(){var a=f.width/f.height,b=BC.Math.radians(90);return BC.Matrix.makePerspective(b,a,1,2E3)}function c(){b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.viewport(0,0,b.canvas.width,b.canvas.height);var a=BC.Time.getTimeInSeconds(),d=a-v;v=a;b.uniformMatrix4fv(q,!1,x);b.uniformMatrix4fv(p,!1,l);if(0!=w)if(d*=w,Math.abs(y)<
z){var f=y+d;0<w&&f>z?d-=f-z:0>w&&-f>z&&(d+=-f-z);y+=d;s[1]+=d}else y=w=0;B=BC.Matrix.makeYRotation(s[1]);d=BC.Matrix.matrixMultiply(e,E);d=BC.Matrix.matrixMultiply(d,B);d=BC.Matrix.matrixMultiply(d,D);b.uniformMatrix4fv(r,!1,d);A.draw(g,h);a=1+Math.abs(Math.sin(4*a))/50;a=BC.Matrix.makeScale(a,a,1);b.uniformMatrix4fv(r,!1,a);C.draw(g,h);requestAnimationFrame(c)}var f=document.getElementById("canvas");if(f){var b=f.getContext("webgl")||f.getContext("experimental-webgl");if(b){b.enable(b.CULL_FACE);
b.enable(b.DEPTH_TEST);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);var n=BC.GL.loadShader(b,"vertex-shader",b.VERTEX_SHADER),k=BC.GL.loadShader(b,"fragment-shader",b.FRAGMENT_SHADER),n=BC.GL.createProgram(b,[n,k]);b.useProgram(n);var g=b.getAttribLocation(n,"a_position"),h=b.getAttribLocation(n,"a_texcoord"),q=b.getUniformLocation(n,"u_projectionMatrix"),p=b.getUniformLocation(n,"u_viewMatrix"),r=b.getUniformLocation(n,"u_matrix"),v=BC.Time.getTimeInSeconds(),s=[0,0,0],n=[1,1,1],e=BC.Matrix.makeScale(n[0],
n[1],n[2]),n=BC.Matrix.makeLookAt([0,0.75,2],[0,0,0],[0,1,0]),l=BC.Matrix.makeInverse(n),m=b.createTexture();b.bindTexture(b.TEXTURE_2D,m);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,1,1,0,b.RGBA,b.UNSIGNED_BYTE,new Uint8Array([0,0,0,255]));var t=new Image;t.src="images/textures.png";$(t).load(function(){b.bindTexture(b.TEXTURE_2D,m);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,t);b.generateMipmap(b.TEXTURE_2D)});n={numSlices:24,innerRadius:0.75,outerRadius:1,maxY:0.15,minY:-0.15};d();var x=a();
$(window).resize(function(){d()&&(x=a())});var u=BC.GL.textureTileSet(4,4,0.002),k=[u.tile(0,0),u.tile(0,1),u.tile(0,2),u.tile(0,3),u.tile(1,0),u.tile(1,1)],u=u.tile(1,2),A=BC.Ring.makeRing(b,n,k),C=BC.Selector.makeSelector(b,n,u),D=BC.Matrix.makeXRotation(s[0]),B=BC.Matrix.makeYRotation(s[1]),E=BC.Matrix.makeZRotation(s[2]),y=0,z=2*Math.PI/24,w=0;$(document).keydown(function(a){switch(a.keyCode){case 37:0===w&&(w=-4);break;case 39:0===w&&(w=4)}});c()}}};return h}(BC||{});$(document).ready(function(){BC.Game.run()});BC=function(h){var d=h.Math=h.Math||{};d.radians=function(a){return a*Math.PI/180};d.circlePoints=function(a,c,d){d=d||0;for(var b=2*Math.PI/c,h=[],k=0;k<c;k++)h[2*k]=a*Math.cos(d+k*b),h[2*k+1]=a*Math.sin(d+k*b);return h};d.cross=function(a,c){return[a[1]*c[2]-a[2]*c[1],a[2]*c[0]-a[0]*c[2],a[0]*c[1]-a[1]*c[0]]};d.subtractVectors=function(a,c){return[a[0]-c[0],a[1]-c[1],a[2]-c[2]]};d.normalize=function(a){var c=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return 1E-5<c?[a[0]/c,a[1]/c,a[2]/c]:[0,0,0]};
return h}(BC||{});BC=function(h){var d=h.GL=h.GL||{};d.loadShader=function(a,c,d,b){b=b||BC.Util.error;var h=document.getElementById(c);if(!h)return b("** Error getting script element:"+c),null;c=a.createShader(d);a.shaderSource(c,h.text);a.compileShader(c);return a.getShaderParameter(c,a.COMPILE_STATUS)?c:(lastError=a.getShaderInfoLog(c),b("*** Error compiling shader '"+c+"':"+lastError),a.deleteShader(c),null)};d.createProgram=function(a,c,d,b){for(var h=a.createProgram(),k=0;k<c.length;k++)a.attachShader(h,c[k]);
if(d)for(k=0;k<d.length;k++)a.bindAttribLocation(h,b?b[k]:k,d[k]);a.linkProgram(h);return a.getProgramParameter(h,a.LINK_STATUS)?h:(lastError=a.getProgramInfoLog(h),error("Error in program linking: "+lastError),a.deleteProgram(h),null)};d.textureTileSet=function(a,c,d){var b=1/a,h=1/c;return{tile:function(a,c){var U=b*c,q=h*a;return{textureCoord:function(a,c){return[U+d+(b-2*d)*a,q+d+(h-2*d)*c]}}}}};return h}(BC||{});BC=function(h){(h.Util=h.Util||{}).error=function(d){window.console&&(window.console.error?window.console.error(d):window.console.log&&window.console.log(d))};return h}(BC||{});
