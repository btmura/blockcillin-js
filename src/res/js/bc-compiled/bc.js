var BC=function(c){var e=c.Core=c.Core||{},e=e.Cell=e.Cell||{};e.CellState={EMPTY:0,EMPTY_NO_SWAP:1,EMPTY_NO_DROP:2,BLOCK:3,BLOCK_INCOMING:4,BLOCK_RECEIVING:5,BLOCK_CLEARING_MARKED:6,BLOCK_CLEARING_PREPARING:7,BLOCK_CLEARING_READY:8,BLOCK_CLEARING_IN_PROGRESS:9};e.make=function(a){function b(){var a=BC.Matrix.makeYRotation(u[1]),b=BC.Matrix.makeTranslation(n[0],n[1],n[2]);l.matrix=BC.Matrix.matrixMultiply(a,b)}var r=BC.Cell.CellState,p=BC.Direction,d=BC.Audio.Sound,
g=a.metrics,h=a.rotationY,e=a.state,f=a.blockStyle,c=a.audioPlayer,m=BC.Math.sliceRadians(g.numCells),q=[],v=!1,u=[0,h,0],n=[0,0,0],l={matrix:BC.Matrix.makeYRotation(u[1]),state:e,blockStyle:f,yellowBoost:0,alpha:1,markBlock:function(){l.state=r.BLOCK_CLEARING_MARKED;0<q.length&&BC.Log.error("markBlock: pending animations: "+q.length);var a=BC.Animation.make({duration:0.5,startCallback:function(){l.state=r.BLOCK_CLEARING_PREPARING},updateCallback:function(a){l.yellowBoost=
Math.abs(Math.sin(50*a.now)/2);return!1},finishCallback:function(){l.yellowBoost=0}}),b=BC.Animation.make({duration:0.25,startCallback:function(){l.blockStyle+=g.numBlockTypes},finishCallback:function(){l.state=r.BLOCK_CLEARING_READY}});q.push(a,b)},clearBlock:function(){l.state=r.BLOCK_CLEARING_IN_PROGRESS;0<q.length&&BC.Log.error("clearBlock: pending animations: "+q.length);var a=BC.Animation.make({duration:0.25,startCallback:function(){c.play(d.CELL_CLEAR)},updateCallback:function(a){l.alpha=
1-a.elapsedPercent;return!1},finishCallback:function(){l.state=r.EMPTY_NO_DROP;l.alpha=1}});q.push(a)},sendBlock:function(a){var b=l.blockStyle;l.blockStyle=0;l.state=r.EMPTY_NO_SWAP;0<q.length&&BC.Log.error("sendBlock: pending animations: "+q.length);q.push(BC.Animation.make({duration:a,finishCallback:function(){l.state=r.EMPTY}}));return b},receiveBlock:function(a,d,f){l.blockStyle=f;l.state=r.BLOCK_RECEIVING;switch(d){case p.LEFT:u[1]-=m;break;case p.RIGHT:u[1]+=m;break;case p.UP:n[1]=
g.ringHeight;v=!0;break;default:BC.Log.error("receiveBlock: unsupport direction: "+d)}b();0<q.length&&BC.Log.error("receiveBlock: pending animations: "+q.length);q.push(BC.Animation.make({duration:a,updateCallback:function(a){var b=m*a.deltaPercent;a=g.ringHeight*a.deltaPercent;switch(d){case p.LEFT:return u[1]+=b,!0;case p.RIGHT:return u[1]-=b,!0;case p.UP:return n[1]-=a,!0;default:return!1}},finishCallback:function(){l.state=r.BLOCK;v=!1}}))},isClearing:function(){return l.state===
r.BLOCK_CLEARING_MARKED||l.state===r.BLOCK_CLEARING_PREPARING||l.state===r.BLOCK_CLEARING_READY||l.state===r.BLOCK_CLEARING_IN_PROGRESS},isDrawable:function(){return l.state!==r.EMPTY&&l.state!==r.EMPTY_NO_SWAP&&l.state!==r.EMPTY_NO_DROP},isTransparent:function(){return l.state===r.BLOCK_CLEARING_IN_PROGRESS},hasDroppingBlock:function(){return v},update:function(a){BC.Animation.process(q,a)&&b()}};return l};return c}(BC||{});BC=function(c){var e=c.Core=c.Core||{};(e.Ring=e.Ring||{}).make=function(a){var b=BC.Cell.CellState,r=a.metrics,p=a.translationY,d=a.selectable;a=a.audioPlayer;for(var g=BC.Math.sliceRadians(r.numCells),p=BC.Matrix.makeTranslation(0,p,0),b=d?b.BLOCK:b.BLOCK_INCOMING,h=[],e=0;e<r.numCells;e++){var f=e*g,c=BC.Math.randomInt(r.numBlockTypes);d||(c+=2*r.numBlockTypes);h[e]=BC.Cell.make({metrics:r,rotationY:f,state:b,blockStyle:c,audioPlayer:a})}return{matrix:p,cells:h,isEmpty:function(){for(var a=
0;a<h.length;a++)if(h[a].state!==BC.Cell.CellState.EMPTY)return!1;return!0},setSelectable:function(a){if(!d&&a)for(var b=0;b<h.length;b++)h[b].state===BC.Cell.CellState.BLOCK_INCOMING&&(h[b].state=BC.Cell.CellState.BLOCK,h[b].blockStyle-=2*r.numBlockTypes);d=a},isSelectable:function(){return d}}};return c}(BC||{});BC=function(c){var e=c.Core=c.Core||{};(e.Selector=e.Selector||{}).make=function(a){function b(a){c=a;0<m.length&&BC.Log.error("startMoving: pending animations: "+m.length);m.push(BC.Animation.make({duration:e,updateCallback:function(a){var b=r.ringHeight*a.deltaPercent;a=v*a.deltaPercent;switch(c){case g.UP:return q[1]+=b,!0;case g.DOWN:return q[1]-=b,!0;case g.LEFT:return p.rotate(a),!0;case g.RIGHT:return p.rotate(-a),!0;default:return!1}},finishCallback:function(){c=g.NONE;d.play(h.SELECTOR_MOVEMENT)}}))}
var r=a.metrics,p=a.board,d=a.audioPlayer,g=BC.Direction,h=BC.Audio.Sound,e=0.025,f={matrix:BC.Matrix.identity,move:function(a){switch(a){case g.LEFT:return c!==g.NONE?a=!1:(b(g.LEFT),a=!0),a;case g.RIGHT:return c!==g.NONE?a=!1:(b(g.RIGHT),a=!0),a;case g.UP:return c!==g.NONE?a=!1:(b(g.UP),a=!0),a;case g.DOWN:return c!==g.NONE?a=!1:(b(g.DOWN),a=!0),a;default:return BC.Log.error("move: unsupported direction: "+a),!1}},update:function(a){BC.Animation.process(m,a);a=1+Math.abs(Math.sin(4*
a.now))/25;a=BC.Matrix.makeScale(a,a,1);var b=BC.Matrix.makeTranslation(q[0],q[1],q[2]);f.matrix=BC.Matrix.matrixMultiply(a,b)}},c=g.NONE,m=[],q=[0,0,0],v=BC.Math.sliceRadians(r.numCells);return f};return c}(BC||{});BC=function(c){var e=c.Core=c.Core||{};(e.Stage=e.Stage||{}).make=function(a,b){b+=a.ringHeight/2-0.01;return{matrix:BC.Matrix.makeTranslation(0,b,0)}};return c}(BC||{});BC=function(c){var e=c.Core=c.Core||{};(e.Drop=e.Drop||{}).makeManager=function(a){var b=BC.Cell.CellState,r=BC.Direction,p=[];return{update:function(d){for(var g=0;g<d.rings.length;g++)for(var h=0;h<a.numCells;h++){var e=d,f=g,c=h,m=e.rings[f].cells[c];m.state===b.BLOCK&&(f+=1,f>=e.rings.length||(e=e.rings[f].cells[c],m.state===b.BLOCK&&e.state==b.EMPTY&&(m=m.sendBlock(0.05),e.receiveBlock(0.05,r.UP,m),p.push(e))))}a:{for(;0<p.length;){if(p[0].hasDroppingBlock()){d=!0;break a}p.shift()}d=
!1}return d}}};return c}(BC||{});BC=function(c){var e=c.Core=c.Core||{};(e.StatBoard=e.StatBoard||{}).make=function(a){function b(){var a=d.get(p);return a?JSON.parse(a):[]}function r(a,b){var d=b.score-a.score;if(0!==d)return d;d=b.elapsedTime-a.elapsedTime;return 0!==d?d:b.speedLevel-a.speedLevel}var p="bc.stats",d=a.storage;return{getStats:b,addStats:function(a){var e=b();e.push(a);e.sort(r);e.slice(0,5);d.set(p,JSON.stringify(e))}}};return c}(BC||{});BC=function(c){var e=c.Core=c.Core||{};(e.Stat=e.Stat||{}).make=function(a){a=a||{};return{value:a.value||0,unit:a.unit||BC.Unit.NONE}};return c}(BC||{});BC=function(c){var e=c.Core=c.Core||{};(e.Board=e.Board||{}).make=function(a){function b(a){a=BC.Ring.make({metrics:d,translationY:-d.ringHeight*A,selectable:a,audioPlayer:g});x.push(a);A++}function r(){w.translationMatrix=BC.Matrix.makeTranslation(t[0],t[1],t[2])}function e(){var a=BC.Matrix.makeXRotation(y[0]),b=BC.Matrix.makeYRotation(y[1]),d=BC.Matrix.makeZRotation(y[2]),b=BC.Matrix.matrixMultiply(d,b),b=BC.Matrix.matrixMultiply(b,a);w.rotationMatrix=
b}var d=a.metrics,g=a.audioPlayer,c=BC.Cell.CellState,k=BC.Direction,f=BC.Audio.Sound;a=BC.Stat;for(var s=BC.Unit,m=11*d.ringHeight,q=2*d.ringHeight,v=0,u=d.numCells-1,n=5.5*-d.ringHeight-d.ringHeight/2,l=d.ringHeight*d.numRings,t=[0,n+l,0],y=[0,0,0],x=[],A=0,z=0;z<d.numRings;z++)b(!0);for(z=0;2>z;z++)b(!1);var w={metrics:d,rings:x,rotationMatrix:BC.Matrix.identity,translationMatrix:BC.Matrix.identity,move:function(a){switch(a){case k.LEFT:B.move(k.LEFT)&&(u--,
0>u&&(u=d.numCells-1));break;case k.RIGHT:B.move(k.RIGHT)&&(u++,u>=d.numCells&&(u=0));break;case k.UP:0<v&&B.move(k.UP)&&v--;break;case k.DOWN:v+1<w.rings.length&&x[v+1].isSelectable()&&B.move(k.DOWN)&&v++}},rotate:function(a){y[1]+=a},swap:function(){var a=x[v].cells[u%d.numCells],b=x[v].cells[(u+1)%d.numCells];BC.Log.log("swap: ("+a.state+", "+b.state+")");var r=a.blockStyle,e=b.blockStyle;a.state!==c.EMPTY&&a.state!==c.EMPTY_NO_DROP||b.state!==c.BLOCK?a.state!==c.BLOCK||b.state!==c.EMPTY&&
b.state!==c.EMPTY_NO_DROP?a.state===c.BLOCK&&b.state===c.BLOCK&&(a.receiveBlock(0.1,k.RIGHT,e),b.receiveBlock(0.1,k.LEFT,r),g.play(f.CELL_SWAP)):(a.sendBlock(0.1,k.RIGHT),b.receiveBlock(0.1,k.LEFT,r),g.play(f.CELL_SWAP)):(b.sendBlock(0.1,k.LEFT),a.receiveBlock(0.1,k.RIGHT,e),g.play(f.CELL_SWAP))},update:function(a){for(var f=0;f<x.length;f++)for(var c=0;c<d.numCells;c++)x[f].cells[c%d.numCells].update(a);for(var f=0|G.update(w),c=H.update(w),g=0;g<c.newChains.length;g++)C.value+=100*c.newChains[g].length;
f|=0<c.pendingChainCount;f||(f=(0.02+0.01*(E.value-1))*a.deltaTime,l+f>m&&(f=m-l),l+=f,t[1]+=f);D.value+=a.deltaTime;E.value=1+Math.floor(D.value/30);B.update(a);r();for(e();0<x.length&&x[0].isEmpty();)x.shift(),l-=d.ringHeight,v--;for(a=l-d.ringHeight*x.length;a>-q;)b(!1),a-=d.ringHeight;for(a=x.length-1;0<=a&&!x[a].isSelectable();a--)0<=l-d.ringHeight*(a+1)&&x[a].setSelectable(!0);return l>=m}};r();e();var B=BC.Selector.make({metrics:d,board:w,audioPlayer:g});w.selector=B;n=BC.Stage.make(d,
n);w.stage=n;var H=BC.Chain.makeManager(),G=BC.Drop.makeManager(d),E=a.make({value:1,unit:s.NONE});w.speedLevel=E;var D=a.make({value:0,unit:s.SECONDS});w.elapsedTime=D;var C=a.make({value:0,unit:s.NONE});w.score=C;return w};return c}(BC||{});BC=function(c){var e=c.Core=c.Core||{},e=e.Chain=e.Chain||{};e.find=function(a){function b(b,d){return a.rings[b].cells[d]}function r(){for(var d=a.rings.length,r=[],e=0;e<d;e++){var c;c=e;for(var p=0,g=b(c,p),l=0;l<k;l++){var t=b(c,p);if(g.state!==t.state||g.blockStyle!=t.blockStyle)break;p+=1;p=p===k?0:p}c=p;for(p=0;p<k;)if(l=(p+c)%k,t=b(e,l),t.state!==h.BLOCK)p++;else{for(var y=1,g=p+1;g<k;g++)if(l=(g+c)%k,l=b(e,l),t.state===l.state&&t.blockStyle==l.blockStyle)y++;else break;if(y>=f){for(t=[];p<
g;p++)l=(p+c)%k,y=b(e,l),t.push({cell:y,row:e,col:l});r.push(t)}p=g}}return r}function e(){for(var d=a.rings.length,r=[],p=0;p<k;p++)for(var c=0;c<d;){var g=b(c,p);if(g.state!==h.BLOCK)c++;else{for(var n=1,l=c+1;l<d;l++){var t=b(l,p);if(g.state===t.state&&g.blockStyle==t.blockStyle)n++;else break}if(n>=f){for(g=[];c<l;c++)n=b(c,p),g.push({cell:n,row:c,col:p});r.push(g)}c=l}}return r}function d(a,b){for(var d=0;d<a.length;d++)for(var f=a[d],c=0;c<b.length;c++){var p=b[c];if(f.blockStyle===p.blockStyle&&
f.row===p.row&&f.col===p.col)return!0}return!1}function c(a,b){for(var d=0;d<a.length;d++){var f=a[d];if(f.blockStyle===b.blockStyle&&f.row===b.row&&f.col===b.col)return!0}return!1}var h=BC.Cell.CellState,k=a.rings[0].cells.length,f=3;return function(){for(var a=[],b=r(),f=e();0<b.length;){var h=b.shift();for(a.push(h);;){for(var k=!1,n=0;n<f.length;n++)if(d(h,f[n])){for(k=0;k<f[n].length;k++)c(h,f[n][k])||h.push(f[n][k]);f.splice(n,1);k=!0}if(!k)break;k=!1;for(n=0;n<b.length;n++)if(d(h,b[n])){for(k=
0;k<b[n].length;k++)c(h,b[n][k])||h.push(b[n][k]);b.splice(n,1);k=!0}if(!k)break}}for(;0<f.length;)h=f.shift(),a.push(h);for(n=0;n<a.length;n++)a[n].sort(function(a,b){return a.row-b.row});return a}()};e.makeManager=function(){var a=BC.Cell.CellState,b=[],c=[];return{update:function(p){p=BC.Chain.find(p);for(var d=0;d<p.length;d++){var e=p[d];c.push(e);for(var h=0;h<e.length;h++){var k=e[h].cell;k.markBlock();b.push(k)}}if(0<b.length)switch(k=b[0],k.state){case a.BLOCK_CLEARING_MARKED:case a.BLOCK_CLEARING_PREPARING:break;
case a.BLOCK_CLEARING_READY:k.clearBlock();break;case a.BLOCK_CLEARING_IN_PROGRESS:break;default:b.shift()}if(0<c.length){e=c[0];h=!0;for(d=0;d<e.length;d++)k=e[d].cell,h&=!k.isClearing();if(h){for(d=0;d<e.length;d++)k=e[d].cell,k.state===a.EMPTY_NO_DROP&&(k.state=a.EMPTY);c.shift()}}return{newChains:p,pendingChainCount:c.length}}}};return c}(BC||{});BC=function(c){var e=c.Audio=c.Audio||{};(e.Player=e.Player||{}).make=function(){function a(a){var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=function(){b.decodeAudioData(d.response,function(a){c=a},function(){BC.Log.error("error decoding data for "+a)})};d.send()}var b,c;window.AudioContext=window.AudioContext||window.webkitAudioContext;window.AudioContext&&(b=new AudioContext,a("audio/sounds.ogg"));return{play:function(a){if(c){var d=c,e=a.offset;a=a.duration;
var h=b.createBufferSource();h.buffer=d;h.connect(b.destination);h.start(0,e,a)}}}};return c}(BC||{});BC=function(c){function e(a,b){return{offset:a,duration:b}}(c.Audio=c.Audio||{}).Sound={BUTTON_HOVER:e(1,0.5),BUTTON_CLICK:e(0,0.75),SELECTOR_MOVEMENT:e(1,0.5),CELL_SWAP:e(2,0.5),CELL_CLEAR:e(3,0.5)};return c}(BC||{});BC=function(c){(c.Common=c.Common||{}).Unit={NONE:"NONE",SECONDS:"SECONDS"};return c}(BC||{});BC=function(c){var e=c.Common=c.Common||{},e=e.Math=e.Math||{};e.radians=function(a){return a*Math.PI/180};e.sliceRadians=function(a){return 2*Math.PI/a};e.randomInt=function(a){return Math.floor(Math.random()*a)};e.circlePoints=function(a,b,c){c=c||0;for(var e=2*Math.PI/b,d=[],g=0;g<b;g++)d[2*g]=a*Math.cos(c+g*e),d[2*g+1]=a*Math.sin(c+g*e);return d};e.cross=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]};e.subtractVectors=function(a,b){return[a[0]-b[0],a[1]-b[1],
a[2]-b[2]]};e.normalize=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return 1E-5<b?[a[0]/b,a[1]/b,a[2]/b]:[0,0,0]};return c}(BC||{});BC=function(c){(c.Common=c.Common||{}).Direction={NONE:"0",UP:"1",DOWN:"2",LEFT:"3",RIGHT:"4"};return c}(BC||{});BC=function(c){var e=c.Common=c.Common||{};(e.Storage=e.Storage||{}).make=function(){var a=localStorage||{};return{get:function(b){return a[b]},set:function(b,c){a[b]=c}}};return c}(BC||{});BC=function(c){var e=c.Common=c.Common||{},e=e.GL=e.GL||{};e.loadShader=function(a,b,c,e){e=e||BC.Log.error;var d=document.getElementById(b);if(!d)return e("** Error getting script element:"+b),null;b=a.createShader(c);a.shaderSource(b,d.text);a.compileShader(b);return a.getShaderParameter(b,a.COMPILE_STATUS)?b:(lastError=a.getShaderInfoLog(b),e("*** Error compiling shader '"+b+"':"+lastError),a.deleteShader(b),null)};e.createProgram=function(a,b,c,e){for(var d=a.createProgram(),g=0;g<b.length;g++)a.attachShader(d,
b[g]);if(c)for(g=0;g<c.length;g++)a.bindAttribLocation(d,e?e[g]:g,c[g]);a.linkProgram(d);return a.getProgramParameter(d,a.LINK_STATUS)?d:(lastError=a.getProgramInfoLog(d),BC.Log.error("Error in program linking: "+lastError),a.deleteProgram(d),null)};e.textureTileSet=function(a,b,c){var e=1/a,d=1/b;return{tile:function(a,b){var k=e*b,f=d*a;return{textureCoord:function(a,b){return[k+c+(e-2*c)*a,f+c+(d-2*c)*b]}}}}};return c}(BC||{});BC=function(c){var e=c.Common=c.Common||{};(e.Clock=e.Clock||{}).make=function(){return{now:function(){return Date.now()}}};return c}(BC||{});BC=function(c){var e=c.Common=c.Common||{},e=e.Matrix=e.Matrix||{};e.makeLookAt=function(a,b,c){b=BC.Math.normalize(BC.Math.subtractVectors(a,b));c=BC.Math.cross(c,b);var e=BC.Math.cross(b,c);return[c[0],c[1],c[2],0,e[0],e[1],e[2],0,b[0],b[1],b[2],0,a[0],a[1],a[2],1]};e.makePerspective=function(a,b,c,e){a=Math.tan(0.5*Math.PI-0.5*a);var d=1/(c-e);return[a/b,0,0,0,0,a,0,0,0,0,(c+e)*d,-1,0,0,c*e*d*2,0]};e.makeTranslation=function(a,b,c){return[1,0,0,0,0,1,0,0,0,0,1,0,a,b,
c,1]};e.makeXRotation=function(a){var b=Math.cos(a);a=Math.sin(a);return[1,0,0,0,0,b,a,0,0,-a,b,0,0,0,0,1]};e.makeYRotation=function(a){var b=Math.cos(a);a=Math.sin(a);return[b,0,-a,0,0,1,0,0,a,0,b,0,0,0,0,1]};e.makeZRotation=function(a){var b=Math.cos(a);a=Math.sin(a);return[b,a,0,0,-a,b,0,0,0,0,1,0,0,0,0,1]};e.makeScale=function(a,b,c){return[a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1]};e.identity=e.makeScale(1,1,1);e.makeInverse=function(a){var b=a[0],c=a[1],e=a[2],d=a[3],g=a[4],h=a[5],k=a[6],f=a[7],s=a[8],
m=a[9],q=a[10],v=a[11],u=a[12],n=a[13],l=a[14];a=a[15];var t=q*a,y=l*v,x=k*a,A=l*f,z=k*v,w=q*f,B=e*a,H=l*d,G=e*v,E=q*d,D=e*f,C=k*d,F=s*n,I=u*m,J=g*n,K=u*h,L=g*m,M=s*h,N=b*n,O=u*c,P=b*m,Q=s*c,R=b*h,S=g*c,T=t*h+A*m+z*n-(y*h+x*m+w*n),U=y*c+B*m+E*n-(t*c+H*m+G*n),n=x*c+H*h+D*n-(A*c+B*h+C*n),c=w*c+G*h+C*m-(z*c+E*h+D*m),h=1/(b*T+g*U+s*n+u*c);return[h*T,h*U,h*n,h*c,h*(y*g+x*s+w*u-(t*g+A*s+z*u)),h*(t*b+H*s+G*u-(y*b+B*s+E*u)),h*(A*b+B*g+C*u-(x*b+H*g+D*u)),h*(z*b+E*g+D*s-(w*b+G*g+C*s)),h*(F*f+K*v+L*a-(I*f+J*
v+M*a)),h*(I*d+N*v+Q*a-(F*d+O*v+P*a)),h*(J*d+O*f+R*a-(K*d+N*f+S*a)),h*(M*d+P*f+S*v-(L*d+Q*f+R*v)),h*(J*q+M*l+I*k-(L*l+F*k+K*q)),h*(P*l+F*e+O*q-(N*q+Q*l+I*e)),h*(N*k+S*l+K*e-(R*l+J*e+O*k)),h*(R*q+L*e+Q*k-(P*k+S*q+M*e))]};e.matrixMultiply=function(a,b){return[a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],
a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*b[3]+a[5]*b[7]+a[6]*b[11]+a[7]*b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]]};return c}(BC||{});BC=function(c){var e=c.Common=c.Common||{},e=e.Animation=e.Animation||{};e.make=function(a){var b=a.duration,c=a.startCallback||function(){},e=a.updateCallback||function(){return!1},d=a.finishCallback||function(){},g=0,h=!1,k=!1;return{update:function(a){h||(h=!0,c());var s=a.deltaTime;g+s>b&&(s=b-g);g+=s;a=e({now:a.now,deltaTime:s,elapsedPercent:g/b,deltaPercent:s/b});g>=b&&(k=!0,d());return a},isDone:function(){return k}}};e.process=function(a,b){var c=!1;if(0<a.length){var e=a[0],c=c|e.update(b);
e.isDone()&&a.shift()}return c};return c}(BC||{});BC=function(c){var e=c.Common=c.Common||{},e=e.Log=e.Log||{};e.log=function(a){window.console&&window.console.log&&window.console.log(a)};e.error=function(a){window.console&&(window.console.error?window.console.error(a):window.console.log&&window.console.log(a))};return c}(BC||{});BC=function(c){var e=c.Common=c.Common||{},e=e.Controller=e.Controller||{};e.Key={UP:"0",DOWN:"1",LEFT:"2",RIGHT:"3",PRIMARY_ACTION:"4",MENU_ACTION:"5"};e.make=function(a){function b(a,b){var d=parseInt(g.get(a),10)||b;return{storageKey:a,keyCode:d}}function c(a){return t[a].keyCode}function e(a,b){t[a].keyCode=b;g.set(t[a].storageKey,b);v(a,b)}var d=BC.Controller.Key,g=a.storage;a=a.canvas;var h=function(){},k=function(){},f=function(){},s=function(){},m=function(){},q=function(){},v=function(){},
u=0,n=0,l,t={};t[d.UP]=b("bc.controller.up",38);t[d.DOWN]=b("bc.controller.down",40);t[d.LEFT]=b("bc.controller.left",37);t[d.RIGHT]=b("bc.controller.right",39);t[d.PRIMARY_ACTION]=b("bc.controller.primaryAction",32);t[d.MENU_ACTION]=b("bc.controller.menuAction",27);$(document).keydown(function(a){if(null!=l){a=a.keyCode;var b=c(l),g;a:{var n=l;for(g in t)if(t.hasOwnProperty(g)&&g!==n&&t[g].keyCode===a)break a;g=null}g&&e(g,b);e(l,a);l=null;return!1}switch(a.keyCode){case c(d.LEFT):h.call();break;
case c(d.RIGHT):k.call();break;case c(d.UP):f.call();break;case c(d.DOWN):s.call();break;case c(d.PRIMARY_ACTION):m.call();break;case c(d.MENU_ACTION):q.call();break;default:console.log(a.keyCode)}return!1});$(a).on("touchstart touchmove touchend",function(a){var b=a.originalEvent.changedTouches[0];switch(a.type){case "touchstart":u=b.pageX;n=b.pageY;break;case "touchend":var d=b.pageX-u,c=b.pageY-n,e=Math.abs(d),g=Math.abs(c);a=function(){return 20<g?(0<c?s.call():f.call(),!0):!1};b=function(){return 20<
e?(0<d?h.call():k.call(),!0):!1};if(e>g){if(b()||a())break}else if(a()||b())break;m.call()}return!1});return{setMoveLeftListener:function(a){h=a},setMoveRightListener:function(a){k=a},setMoveUpListener:function(a){f=a},setMoveDownListener:function(a){s=a},setPrimaryActionListener:function(a){m=a},setMenuActionListener:function(a){q=a},setKeyCodeAssignmentListener:function(a){v=a},startKeyCodeAssignment:function(a){l=a},cancelKeyCodeAssignment:function(){l=null},getKeyCode:c}};return c}(BC||{});BC=function(c){var e=c.Common=c.Common||{};(e.StopWatch=e.StopWatch||{}).make=function(a){function b(){e.then=0.001*c.now()}var c=a.clock,e={reset:b,tick:function(){e.now=0.001*c.now();e.deltaTime=e.now-e.then;e.then=e.now}};b();return e};return c}(BC||{});BC=function(c){(c.Game=c.Game||{}).make=function(c){function a(a){return f.getUniformLocation(F,a)}function b(){return canvas.width!=canvas.clientWidth||canvas.height!=canvas.clientHeight?(canvas.width=canvas.clientWidth,canvas.height=canvas.clientHeight,!0):!1}function r(){var a=canvas.width/canvas.height,b=BC.Math.radians(90);return BC.Matrix.makePerspective(b,a,1,2E3)}function p(){t=!1;H();z.reset();d()}function d(){f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT);f.viewport(0,0,f.canvas.width,
f.canvas.height);f.uniformMatrix4fv(I.projectionMatrixLocation,!1,J);var a=!t&&!y&&w;if(a){z.tick();var b=y;y=w.update(z);b!==y&&m.addStats({speedLevel:w.speedLevel.value,elapsedTime:w.elapsedTime.value,score:w.score.value})}B&&B.draw();a&&requestAnimationFrame(d);y&&(t=l=!1,E())}var g=BC.Time.Clock,h=BC.Direction,k=BC.Time.Stopwatch,f=c.gl,s=c.controller,m=c.statBoard,q=c.audioPlayer,v=c.gmSpeedLevelView,u=c.gmElapsedTimeView,n=c.gmScoreView,l=!1,t=!1,y=!1,x={numRings:3,numCells:24,numBlockTypes:6,
ringInnerRadius:0.75,ringOuterRadius:1,ringHeight:0.3},A=BC.Resources.make();c=g.make();var z=k.make({clock:c}),w,B,H=function(){},G=function(){},E=function(){},D=f.createTexture();f.bindTexture(f.TEXTURE_2D,D);f.texImage2D(f.TEXTURE_2D,0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,new Uint8Array([0,0,0,255]));var C=new Image;C.src="images/textures.png";$(C).load(function(){f.bindTexture(f.TEXTURE_2D,D);f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,C);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,
f.LINEAR);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR_MIPMAP_NEAREST);f.generateMipmap(f.TEXTURE_2D)});f.enable(f.CULL_FACE);f.enable(f.DEPTH_TEST);f.enable(f.BLEND);f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA);k=BC.GL.loadShader(f,"vertex-shader",f.VERTEX_SHADER);c=BC.GL.loadShader(f,"fragment-shader",f.FRAGMENT_SHADER);var F=BC.GL.createProgram(f,[k,c]);f.useProgram(F);var I={positionLocation:f.getAttribLocation(F,"a_position"),textureCoordLocation:f.getAttribLocation(F,
"a_textureCoord"),projectionMatrixLocation:a("u_projectionMatrix"),viewMatrixLocation:a("u_viewMatrix"),boardRotationMatrixLocation:a("u_boardRotationMatrix"),boardTranslationMatrixLocation:a("u_boardTranslationMatrix"),selectorMatrixLocation:a("u_selectorMatrix"),ringMatrixLocation:a("u_ringMatrix"),cellMatrixLocation:a("u_cellMatrix"),yellowBoostLocation:a("u_yellowBoost"),alphaLocation:a("u_alpha")};b();var J=r();$(window).resize(function(){b()&&(J=r(),d())});k=function(){var a=BC.Matrix.makeLookAt([0,
0.1,3],[0,0,0],[0,1,0]);return BC.Matrix.makeInverse(a)}();f.uniformMatrix4fv(I.viewMatrixLocation,!1,k);return{resume:p,start:function(){l=!0;y=!1;w=BC.Board.make({metrics:x,audioPlayer:q});B=BC.Board.View.make({board:w,gl:f,programLocations:I,resources:A,speedLevelStatView:v,elapsedTimeStatView:u,scoreStatView:n});s.setMoveLeftListener(function(){w.move(h.LEFT)});s.setMoveRightListener(function(){w.move(h.RIGHT)});s.setMoveUpListener(function(){w.move(h.UP)});s.setMoveDownListener(function(){w.move(h.DOWN)});
s.setPrimaryActionListener(function(){w.swap()});p()},pause:function(){t=!0;G()},isPaused:function(){return t},isGameOver:function(){return y},isStarted:function(){return l},setResumeListener:function(a){H=a},setPauseListener:function(a){G=a},setGameOverListener:function(a){E=a},getSpeedLevel:function(){return w.speedLevel},getElapsedTime:function(){return w.elapsedTime},getScore:function(){return w.score}}};return c}(BC||{});BC=function(c){(c.Main=c.Main||{}).run=function(){function c(a){a?(g.show(m),h.hide()):(g.hide(),h.show())}var a=document.getElementById("canvas");if(a){var b=a.getContext("webgl")||a.getContext("experimental-webgl");if(b){var r=BC.Storage.make(),a=BC.Controller.make({canvas:a,storage:r}),p=BC.StatBoard.make({storage:r}),d=BC.Audio.Player.make(),g=BC.Menu.Main.make(),h=BC.Menu.Game.make(),k=BC.Menu.Stats.make({statBoard:p}),f=BC.Menu.Options.make({controller:a}),s=BC.Credits.Menu.make(),
m=BC.Game.make({gl:b,storage:r,controller:a,statBoard:p,audioPlayer:d,gmSpeedLevelView:h.getSpeedLevelView(),gmElapsedTimeView:h.getElapsedTimeView(),gmScoreView:h.getScoreView()});g.setContinueListener(function(){m.resume()});g.setNewGameListener(function(){m.start()});g.setStatsListener(function(){k.show()});g.setOptionsListener(function(){f.show()});g.setCreditsListener(function(){s.show()});h.setPauseListener(function(){m.pause()});m.setResumeListener(function(){c(!1)});m.setPauseListener(function(){c(!0)});
m.setGameOverListener(function(){c(!0)});a.setMenuActionListener(function(){m.isPaused()?m.resume():m.pause()});document.addEventListener("visibilitychange",function(){document.hidden&&m.pause()});BC.Menu.init({audioPlayer:d});c(!0)}}};return c}(BC||{});$(document).ready(function(){BC.Main.run()});BC=function(c){var e=c.Menu=c.Menu||{};(e.Credits=e.Credits||{}).make=function(){function a(){e||(e=$("#credits-menu"),$("#close-button",e).click(function(){b()}))}function b(){e.fadeOut(c)}var c="slow",e;return{show:function(){a();e.fadeIn(c)},hide:b}};return c}(BC||{});BC=function(c){var e=c.Menu=c.Menu||{};(e.Game=e.Game||{}).make=function(){var a=$("#game-menu"),b=$("#pause-button",a),c=BC.Stat.View.make($("#speed-level-stat",a)),e=BC.Stat.View.make($("#elapsed-time-stat",a)),d=BC.Stat.View.make($("#score-stat",a)),g=function(){};b.click(function(){g()});return{setPauseListener:function(a){g=a},show:function(){a.fadeIn("slow")},hide:function(){a.fadeOut("slow")},getSpeedLevelView:function(){return c},getElapsedTimeView:function(){return e},getScoreView:function(){return d}}};
return c}(BC||{});BC=function(c){var e=c.Menu=c.Menu||{};(e.Options=e.Options||{}).make=function(a){function b(a,b,c){var d=$(a,b);s[c]=d;d.click(function(){d.text(h);f.startKeyCodeAssignment(c)});return d}function c(a,b){var d=f.getKeyCode(b);a.text(g[d]||"#"+d)}function e(){f.cancelKeyCodeAssignment();m.fadeOut(k)}var d=BC.Controller.Key,g={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause/Break",20:"Caps Lock",27:"Esc",32:"Space",33:"Page Up",34:"Page Down",35:"End",36:"Home",37:"Left",
38:"Up",39:"Right",40:"Down",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"Windows",93:"Right Click",96:"Numpad 0",97:"Numpad 1",98:"Numpad 2",99:"Numpad 3",100:"Numpad 4",101:"Numpad 5",102:"Numpad 6",103:"Numpad 7",104:"Numpad 8",105:"Numpad 9",106:"Numpad *",107:"Numpad +",
109:"Numpad -",110:"Numpad .",111:"Numpad /",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Num Lock",145:"Scroll Lock",182:"My Computer",183:"My Calculator",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},h="PRESS KEY",k="slow",f=a.controller,s={},m=$("#options-menu"),q=b("#up-button",m,d.UP),v=b("#down-button",m,d.DOWN),u=b("#left-button",m,d.LEFT),n=b("#right-button",m,d.RIGHT),l=b("#swap-button",
m,d.PRIMARY_ACTION),t=b("#menu-button",m,d.MENU_ACTION);$("#close-button",m).click(function(){e()});f.setKeyCodeAssignmentListener(function(a,b){s[a].text(g[b]||"#"+b)});return{show:function(){c(q,d.UP);c(v,d.DOWN);c(u,d.LEFT);c(n,d.RIGHT);c(l,d.PRIMARY_ACTION);c(t,d.MENU_ACTION);m.fadeIn(k)},hide:e}};return c}(BC||{});BC=function(c){var e=c.Menu=c.Menu||{};(e.Main=e.Main||{}).make=function(){function a(a){return a.isGameOver()?e:a.isStarted()&&a.isPaused()?c:b}var b="b l o c k c i l l i n",c="P A U S E D",e="G A M E  O V E R",d=$("#main-menu"),g=$("#main-menu-title",d),h=$("#main-menu-stats",d),k=$("#continue-button",d),f=$("#new-game-button",d),s=$("#stats-button",d),m=$("#options-button",d),q=$("#credits-button",d),v=BC.Stat.View.make($("#speed-level-stat",d)),u=BC.Stat.View.make($("#elapsed-time-stat",d)),n=
BC.Stat.View.make($("#score-stat",d)),l=function(){},t=function(){},y=function(){},x=function(){},A=function(){};k.click(function(){l()});f.click(function(){t()});s.click(function(){y()});m.click(function(){x()});q.click(function(){A()});return{setContinueListener:function(a){l=a},setNewGameListener:function(a){t=a},setStatsListener:function(a){y=a},setOptionsListener:function(a){x=a},setCreditsListener:function(a){A=a},show:function(b){g.text(a(b));var c=b.isStarted()||b.isGameOver();c&&(v.draw(b.getSpeedLevel()),
n.draw(b.getScore()),u.draw(b.getElapsedTime()));c?h.show():h.hide();b.isStarted()?k.show():k.hide();d.fadeIn("slow")},hide:function(){d.fadeOut("slow")}}};return c}(BC||{});BC=function(c){(c.Menu=c.Menu||{}).init=function(c){var a=BC.Audio.Sound,b=c.audioPlayer;c=$(".button");c.click(function(c){b.play(a.BUTTON_CLICK);$(c.target).fadeIn(20).fadeOut(20).fadeIn(20).fadeOut(20).fadeIn(20)});c.mouseenter(function(){b.play(a.BUTTON_HOVER)})};return c}(BC||{});BC=function(c){var e=c.Menu=c.Menu||{};(e.Stats=e.Stats||{}).make=function(a){function b(){h.fadeOut(c)}var c="slow",e=BC.Stat,d=BC.Unit,g=a.statBoard,h=$("#stats-menu"),k=$("#no-stats-label",h);a=$("#close-button",h);for(var f=[],s=[],m=1;5>=m;m++){var q=$("#stats-entry-"+m,h);f.push(q);var v=function(a){return BC.Stat.View.make($(a,q))};s.push({speedLevel:v("#speed-level-stat"),elapsedTime:v("#elapsed-time-stat"),score:v("#score-stat")})}var u=e.make(),n=e.make({unit:d.SECONDS}),l=e.make();
a.click(function(){b()});return{show:function(){var a=g.getStats();0==a.length?k.show():k.hide();for(var b=0;b<f.length;b++)b<a.length?(u.value=a[b].speedLevel,n.value=a[b].elapsedTime,l.value=a[b].score,s[b].speedLevel.draw(u),s[b].elapsedTime.draw(n),s[b].score.draw(l),f[b].show()):f[b].hide();h.fadeIn(c)},hide:b}};return c}(BC||{});BC=function(c){var e=c.View=c.View||{};(e.Cell=e.Cell||{}).make=function(a,b,c){function e(b,c){var d=c.positionLocation,f=c.textureCoordLocation,g=c.yellowBoostLocation,h=c.alphaLocation;a.bindBuffer(a.ARRAY_BUFFER,s);a.enableVertexAttribArray(d);a.vertexAttribPointer(d,3,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,m[b.blockStyle]);a.enableVertexAttribArray(f);a.vertexAttribPointer(f,2,a.FLOAT,!1,0,0);a.uniform1f(g,b.yellowBoost);a.uniform1f(h,b.alpha);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,q);a.drawElements(a.TRIANGLES,
v,a.UNSIGNED_SHORT,0)}var d=b.numCells,g=b.ringOuterRadius,h=b.ringHeight/2,k=-h,f=-Math.PI/2;b=BC.Math.circlePoints(b.ringInnerRadius,d,f);g=BC.Math.circlePoints(g,d,f);d=0;f=[];f[d++]=b[0];f[d++]=h;f[d++]=-b[1];f[d++]=g[0];f[d++]=h;f[d++]=-g[1];f[d++]=g[2];f[d++]=h;f[d++]=-g[3];f[d++]=b[2];f[d++]=h;f[d++]=-b[3];f[d++]=g[0];f[d++]=k;f[d++]=-g[1];f[d++]=b[0];f[d++]=k;f[d++]=-b[1];f[d++]=b[2];f[d++]=k;f[d++]=-b[3];f[d++]=g[2];f[d++]=k;f[d++]=-g[3];f[d++]=b[0];f[d++]=h;f[d++]=-b[1];f[d++]=
b[0];f[d++]=k;f[d++]=-b[1];f[d++]=g[0];f[d++]=k;f[d++]=-g[1];f[d++]=g[0];f[d++]=h;f[d++]=-g[1];f[d++]=g[2];f[d++]=h;f[d++]=-g[3];f[d++]=g[2];f[d++]=k;f[d++]=-g[3];f[d++]=b[2];f[d++]=k;f[d++]=-b[3];f[d++]=b[2];f[d++]=h;f[d++]=-b[3];f[d++]=g[0];f[d++]=h;f[d++]=-g[1];f[d++]=g[0];f[d++]=k;f[d++]=-g[1];f[d++]=g[2];f[d++]=k;f[d++]=-g[3];f[d++]=g[2];f[d++]=h;f[d++]=-g[3];f[d++]=b[2];f[d++]=h;f[d++]=-b[3];f[d++]=b[2];f[d++]=k;f[d++]=-b[3];f[d++]=b[0];f[d++]=k;f[d++]=-b[1];f[d++]=b[0];f[d++]=h;f[d++]=-b[1];
var s=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,s);a.bufferData(a.ARRAY_BUFFER,new Float32Array(f),a.STATIC_DRAW);h=[];for(d=0;d<c.length;d++)for(k=c[d],h[d]=[],g=b=0;6>b;b++)f=k.textureCoord(0,0),h[d][g++]=f[0],h[d][g++]=f[1],f=k.textureCoord(0,1),h[d][g++]=f[0],h[d][g++]=f[1],f=k.textureCoord(1,1),h[d][g++]=f[0],h[d][g++]=f[1],f=k.textureCoord(1,0),h[d][g++]=f[0],h[d][g++]=f[1];for(var m=[],d=0;d<c.length;d++)m[d]=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,m[d]),a.bufferData(a.ARRAY_BUFFER,
new Float32Array(h[d]),a.STATIC_DRAW);c=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);var q=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,q);a.bufferData(a.ELEMENT_ARRAY_BUFFER,c,a.STATIC_DRAW);var v=c.length;return{drawOpaque:function(a,b){a.isDrawable()&&!a.isTransparent()&&e(a,b)},drawTransparent:function(b,c){b.isDrawable()&&b.isTransparent()&&(a.disable(a.CULL_FACE),e(b,c),a.enable(a.CULL_FACE))}}};return c}(BC||{});BC=function(c){var e=c.View=c.View||{};(e.Selector=e.Selector||{}).make=function(a,b,c){var e=-b.ringHeight/2,d=-e;b=BC.Math.circlePoints(b.ringOuterRadius+0.01,b.numCells,-Math.PI/2);var g=b.length-2,h=[],k=0;h[k++]=b[g]+0.001;h[k++]=e;h[k++]=-b[g+1]-0.001;h[k++]=b[0]+0.001;h[k++]=e;h[k++]=-b[1]-0.001;h[k++]=b[0]+0.001;h[k++]=d;h[k++]=-b[1]-0.001;h[k++]=b[g]+0.001;h[k++]=d;h[k++]=-b[g+1]-0.001;h[k++]=b[0]+0.001;h[k++]=e;h[k++]=-b[1]-0.001;h[k++]=b[2]+0.001;h[k++]=e;h[k++]=-b[3]-0.001;h[k++]=
b[2]+0.001;h[k++]=d;h[k++]=-b[3]-0.001;h[k++]=b[0]+0.001;h[k++]=d;h[k++]=-b[1]-0.001;var f=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,f);a.bufferData(a.ARRAY_BUFFER,new Float32Array(h),a.STATIC_DRAW);e=c.textureCoord(0,0);d=c.textureCoord(1,0);b=c.textureCoord(1,1);c=c.textureCoord(0,1);c=new Float32Array([].concat(e,d,b,c,e,d,b,c));var s=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,s);a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW);var m=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7]),q=a.createBuffer();
a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,q);a.bufferData(a.ELEMENT_ARRAY_BUFFER,m,a.STATIC_DRAW);return{draw:function(b){var c=b.positionLocation,d=b.textureCoordLocation;b=b.alphaLocation;a.bindBuffer(a.ARRAY_BUFFER,f);a.enableVertexAttribArray(c);a.vertexAttribPointer(c,3,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,s);a.enableVertexAttribArray(d);a.vertexAttribPointer(d,2,a.FLOAT,!1,0,0);a.uniform1f(b,1);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,q);a.drawElements(a.TRIANGLES,m.length,a.UNSIGNED_SHORT,0)}}};
return c}(BC||{});BC=function(c){var e=c.View=c.View||{};(e.Resources=e.Resources||{}).make=function(){var a=BC.GL.textureTileSet(8,8,0.002),b=[a.tile(0,0),a.tile(0,1),a.tile(0,2),a.tile(0,3),a.tile(0,4),a.tile(0,5),a.tile(2,0),a.tile(2,1),a.tile(2,2),a.tile(2,3),a.tile(2,4),a.tile(2,5),a.tile(1,0),a.tile(1,1),a.tile(1,2),a.tile(1,3),a.tile(1,4),a.tile(1,5)],c=a.tile(4,0),a=a.tile(4,1);return{blockTextureTiles:b,selectorTextureTile:c,blackTextureTile:a}};return c}(BC||{});BC=function(c){var e=c.View=c.View||{};(e.Stage=e.Stage||{}).make=function(a,b,c){b=[];var e=0;b[e++]=-1;b[e++]=0;b[e++]=1;b[e++]=1;b[e++]=0;b[e++]=1;b[e++]=1;b[e++]=0;b[e++]=-1;b[e++]=-1;b[e++]=0;b[e++]=-1;b[e++]=-1;b[e++]=-1;b[e++]=1;b[e++]=1;b[e++]=-1;b[e++]=1;b[e++]=1;b[e++]=0;b[e++]=1;b[e++]=-1;b[e++]=0;b[e++]=1;var d=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d);a.bufferData(a.ARRAY_BUFFER,new Float32Array(b),a.STATIC_DRAW);b=c.textureCoord(0,0);var e=c.textureCoord(1,0),g=c.textureCoord(1,
1);c=c.textureCoord(0,1);c=new Float32Array([].concat(b,e,g,c,b,e,g,c));var h=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,h);a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW);var k=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7]),f=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,f);a.bufferData(a.ELEMENT_ARRAY_BUFFER,k,a.STATIC_DRAW);return{draw:function(b){var c=b.positionLocation,e=b.textureCoordLocation,g=b.yellowBoostLocation;b=b.alphaLocation;a.bindBuffer(a.ARRAY_BUFFER,d);a.enableVertexAttribArray(c);
a.vertexAttribPointer(c,3,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,h);a.enableVertexAttribArray(e);a.vertexAttribPointer(e,2,a.FLOAT,!1,0,0);a.uniform1f(g,0);a.uniform1f(b,1);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,f);a.drawElements(a.TRIANGLES,k.length,a.UNSIGNED_SHORT,0)}}};return c}(BC||{});BC=function(c){var e=c.View=c.View||{},a;(e.Stat=e.Stat||{}).make=function(b){if(!a){var c=BC.Unit;a={};a[c.NONE]=function(a){return a};a[c.SECONDS]=function(a){var b=Math.floor(a/3600);a-=3600*b;var c=Math.floor(a/60);a=Math.floor(a-60*c);10>b&&(b="0"+b);10>c&&(c="0"+c);10>a&&(a="0"+a);return b+":"+c+":"+a}}return{draw:function(c){b.text((0,a[c.unit])(c.value))}}};return c}(BC||{});BC=function(c){var e=c.View=c.View||{};(e.Board=e.Board||{}).make=function(a){var b=a.board,c=a.gl,e=a.programLocations,d=a.resources,g=a.speedLevelStatView,h=a.elapsedTimeStatView,k=a.scoreStatView,f=e.boardRotationMatrixLocation,s=e.boardTranslationMatrixLocation,m=e.selectorMatrixLocation,q=e.ringMatrixLocation,v=e.cellMatrixLocation,u=BC.Cell.View.make(c,b.metrics,d.blockTextureTiles),n=BC.Selector.View.make(c,b.metrics,d.selectorTextureTile),l=BC.Stage.View.make(c,b.metrics,d.blackTextureTile);
return{draw:function(){g.draw(b.speedLevel);h.draw(b.elapsedTime);k.draw(b.score);c.uniformMatrix4fv(f,!1,b.rotationMatrix);c.uniformMatrix4fv(s,!1,b.translationMatrix);c.uniformMatrix4fv(m,!1,BC.Matrix.identity);for(var a=b.rings,d=0;2>d;d++)for(var x=0;x<a.length;x++){c.uniformMatrix4fv(q,!1,a[x].matrix);for(var A=a[x].cells,z=0;z<A.length;z++)c.uniformMatrix4fv(v,!1,A[z].matrix),0==d?u.drawOpaque(A[z],e):u.drawTransparent(A[z],e)}c.uniformMatrix4fv(f,!1,BC.Matrix.identity);c.uniformMatrix4fv(s,
!1,BC.Matrix.identity);c.uniformMatrix4fv(m,!1,b.stage.matrix);c.uniformMatrix4fv(q,!1,BC.Matrix.identity);c.uniformMatrix4fv(v,!1,BC.Matrix.identity);l.draw(e);c.uniformMatrix4fv(f,!1,BC.Matrix.identity);c.uniformMatrix4fv(s,!1,b.translationMatrix);c.uniformMatrix4fv(m,!1,b.selector.matrix);c.uniformMatrix4fv(q,!1,BC.Matrix.identity);c.uniformMatrix4fv(v,!1,BC.Matrix.identity);n.draw(e)}}};return c}(BC||{});
