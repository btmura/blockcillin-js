var BC=function(k){var d=k.Matrix=k.Matrix||{};d.makeLookAt=function(a,b,d){b=BC.Math.normalize(BC.Math.subtractVectors(a,b));d=BC.Math.cross(d,b);var c=BC.Math.cross(b,d);return[d[0],d[1],d[2],0,c[0],c[1],c[2],0,b[0],b[1],b[2],0,a[0],a[1],a[2],1]};d.makePerspective=function(a,b,d,c){a=Math.tan(0.5*Math.PI-0.5*a);var e=1/(d-c);return[a/b,0,0,0,0,a,0,0,0,0,(d+c)*e,-1,0,0,d*c*e*2,0]};d.makeTranslation=function(a,b,d){return[1,0,0,0,0,1,0,0,0,0,1,0,a,b,d,1]};d.makeXRotation=function(a){var b=Math.cos(a);
a=Math.sin(a);return[1,0,0,0,0,b,a,0,0,-a,b,0,0,0,0,1]};d.makeYRotation=function(a){var b=Math.cos(a);a=Math.sin(a);return[b,0,-a,0,0,1,0,0,a,0,b,0,0,0,0,1]};d.makeZRotation=function(a){var b=Math.cos(a);a=Math.sin(a);return[b,a,0,0,-a,b,0,0,0,0,1,0,0,0,0,1]};d.makeScale=function(a,b,d){return[a,0,0,0,0,b,0,0,0,0,d,0,0,0,0,1]};d.makeInverse=function(a){var b=a[0],d=a[1],c=a[2],e=a[3],f=a[4],h=a[5],k=a[6],q=a[7],r=a[8],s=a[9],w=a[10],x=a[11],g=a[12],l=a[13],n=a[14];a=a[15];var u=w*a,t=n*x,B=k*a,D=
n*q,p=k*x,F=w*q,G=c*a,v=n*e,y=c*x,C=w*e,E=c*q,I=k*e,z=r*l,J=g*s,K=f*l,A=g*h,L=f*s,H=r*h,M=b*l,N=g*d,O=b*s,P=r*d,Q=b*h,R=f*d,S=u*h+D*s+p*l-(t*h+B*s+F*l),T=t*d+G*s+C*l-(u*d+v*s+y*l),l=B*d+v*h+E*l-(D*d+G*h+I*l),d=F*d+y*h+I*s-(p*d+C*h+E*s),h=1/(b*S+f*T+r*l+g*d);return[h*S,h*T,h*l,h*d,h*(t*f+B*r+F*g-(u*f+D*r+p*g)),h*(u*b+v*r+y*g-(t*b+G*r+C*g)),h*(D*b+G*f+I*g-(B*b+v*f+E*g)),h*(p*b+C*f+E*r-(F*b+y*f+I*r)),h*(z*q+A*x+L*a-(J*q+K*x+H*a)),h*(J*e+M*x+P*a-(z*e+N*x+O*a)),h*(K*e+N*q+Q*a-(A*e+M*q+R*a)),h*(H*e+O*q+
R*x-(L*e+P*q+Q*x)),h*(K*w+H*n+J*k-(L*n+z*k+A*w)),h*(O*n+z*c+N*w-(M*w+P*n+J*c)),h*(M*k+R*n+A*c-(Q*n+K*c+N*k)),h*(Q*w+L*c+P*k-(O*k+R*w+H*c))]};d.matrixMultiply=function(a,b){return[a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*b[3]+a[5]*b[7]+a[6]*b[11]+a[7]*
b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]]};return k}(BC||{});BC=function(k){(k.Time=k.Time||{}).getTimeInSeconds=function(){return 0.001*Date.now()};return k}(BC||{});BC=function(k){(k.Ring=k.Ring||{}).makeRing=function(d,a,b){for(var m=a.numSlices,c=a.outerRadius,e=a.maxY,f=a.minY,h=BC.Math.circlePoints(a.innerRadius,m),m=BC.Math.circlePoints(c,m),c=[],k=[],q=0,r=function(a,b,c,d,e,g,f){b=a.textureCoord(b,c);k[q++]=b[0];k[q++]=b[1];b=a.textureCoord(d,e);k[q++]=b[0];k[q++]=b[1];b=a.textureCoord(g,f);k[q++]=b[0];k[q++]=b[1]},s=0,w=0,x=0,g=0,l=0;x<a.numSlices;x++,l+=2){for(var n=(l+2)%m.length;w===s;)s=Math.floor(Math.random()*b.length);var w=s,u=b[s];c[g++]=h[l];
c[g++]=e;c[g++]=-h[l+1];c[g++]=m[l];c[g++]=e;c[g++]=-m[l+1];c[g++]=m[n];c[g++]=e;c[g++]=-m[n+1];r(u,0,0,0,1,1,1);c[g++]=h[l];c[g++]=e;c[g++]=-h[l+1];c[g++]=m[n];c[g++]=e;c[g++]=-m[n+1];c[g++]=h[n];c[g++]=e;c[g++]=-h[n+1];r(u,0,0,1,1,1,0);c[g++]=h[l];c[g++]=f;c[g++]=-h[l+1];c[g++]=m[n];c[g++]=f;c[g++]=-m[n+1];c[g++]=m[l];c[g++]=f;c[g++]=-m[l+1];r(u,0,0,1,1,0,1);c[g++]=h[l];c[g++]=f;c[g++]=-h[l+1];c[g++]=h[n];c[g++]=f;c[g++]=-h[n+1];c[g++]=m[n];c[g++]=f;c[g++]=-m[n+1];r(u,0,0,1,0,1,1);c[g++]=m[l];c[g++]=
f;c[g++]=-m[l+1];c[g++]=m[n];c[g++]=f;c[g++]=-m[n+1];c[g++]=m[n];c[g++]=e;c[g++]=-m[n+1];r(u,0,1,1,1,1,0);c[g++]=m[l];c[g++]=f;c[g++]=-m[l+1];c[g++]=m[n];c[g++]=e;c[g++]=-m[n+1];c[g++]=m[l];c[g++]=e;c[g++]=-m[l+1];r(u,0,1,1,0,0,0);c[g++]=h[l];c[g++]=f;c[g++]=-h[l+1];c[g++]=h[n];c[g++]=e;c[g++]=-h[n+1];c[g++]=h[n];c[g++]=f;c[g++]=-h[n+1];r(u,0,1,1,0,1,1);c[g++]=h[l];c[g++]=f;c[g++]=-h[l+1];c[g++]=h[l];c[g++]=e;c[g++]=-h[l+1];c[g++]=h[n];c[g++]=e;c[g++]=-h[n+1];r(u,0,1,0,0,1,0)}var t=d.createBuffer();
d.bindBuffer(d.ARRAY_BUFFER,t);d.bufferData(d.ARRAY_BUFFER,new Float32Array(c),d.STATIC_DRAW);var B=c.length/3,D=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,D);d.bufferData(d.ARRAY_BUFFER,new Float32Array(k),d.STATIC_DRAW);return{draw:function(a,b){d.bindBuffer(d.ARRAY_BUFFER,t);d.enableVertexAttribArray(a);d.vertexAttribPointer(a,3,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,D);d.enableVertexAttribArray(b);d.vertexAttribPointer(b,2,d.FLOAT,!1,0,0);d.drawArrays(d.TRIANGLES,0,B)}}};return k}(BC||
{});BC=function(k){(k.Selector=k.Selector||{}).makeSelector=function(d,a,b){var m=a.minY,c=a.maxY;a=BC.Math.circlePoints(a.outerRadius+0.01,a.numSlices,-Math.PI/2);var e=a.length-2,f=[],h=0;f[h++]=a[e]+0.001;f[h++]=m;f[h++]=-a[e+1]-0.001;f[h++]=a[0]+0.001;f[h++]=m;f[h++]=-a[1]-0.001;f[h++]=a[0]+0.001;f[h++]=c;f[h++]=-a[1]-0.001;f[h++]=a[e]+0.001;f[h++]=c;f[h++]=-a[e+1]-0.001;f[h++]=a[0]+0.001;f[h++]=m;f[h++]=-a[1]-0.001;f[h++]=a[2]+0.001;f[h++]=m;f[h++]=-a[3]-0.001;f[h++]=a[2]+0.001;f[h++]=c;f[h++]=-a[3]-
0.001;f[h++]=a[0]+0.001;f[h++]=c;f[h++]=-a[1]-0.001;var k=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,k);d.bufferData(d.ARRAY_BUFFER,new Float32Array(f),d.STATIC_DRAW);m=b.textureCoord(0,0);c=b.textureCoord(1,0);a=b.textureCoord(1,1);b=b.textureCoord(0,1);b=new Float32Array([].concat(m,c,a,b,m,c,a,b));var q=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,q);d.bufferData(d.ARRAY_BUFFER,b,d.STATIC_DRAW);var r=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7]),s=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,
s);d.bufferData(d.ELEMENT_ARRAY_BUFFER,r,d.STATIC_DRAW);return{draw:function(a,b){d.enable(d.BLEND);d.bindBuffer(d.ARRAY_BUFFER,k);d.enableVertexAttribArray(a);d.vertexAttribPointer(a,3,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,q);d.enableVertexAttribArray(b);d.vertexAttribPointer(b,2,d.FLOAT,!1,0,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,s);d.drawElements(d.TRIANGLES,r.length,d.UNSIGNED_SHORT,0);d.disable(d.BLEND)}}};return k}(BC||{});BC=function(k){(k.Game=k.Game||{}).run=function(){function d(){return c.width!=c.clientWidth||c.height!=c.clientHeight?(c.width=c.clientWidth,c.height=c.clientHeight,!0):!1}function a(){var a=c.width/c.height,b=BC.Math.radians(90);return BC.Matrix.makePerspective(b,a,1,2E3)}function b(a){switch(a){case p.LEFT:v===p.NONE&&(v=p.LEFT,y=0);break;case p.RIGHT:v===p.NONE&&(v=p.RIGHT,y=0);break;case p.UP:v===p.NONE&&0<E&&(v=p.UP,y=0,E--);break;case p.DOWN:v===p.NONE&&E+1<B.length&&(v=p.DOWN,y=0,E++)}}function m(){e.clear(e.COLOR_BUFFER_BIT|
e.DEPTH_BUFFER_BIT);e.viewport(0,0,e.canvas.width,e.canvas.height);var a=BC.Time.getTimeInSeconds(),b=a-x;x=a;e.uniformMatrix4fv(r,!1,u);e.uniformMatrix4fv(s,!1,g);if(v!==p.NONE){y+b>C&&(b=C-y);var c=b*H/C,d=b*L/C;switch(v){case p.UP:A[1]+=c;break;case p.DOWN:A[1]-=c;break;case p.LEFT:z[1]+=d;break;case p.RIGHT:z[1]-=d}y+=b;y>=C&&(v=p.NONE,y=0)}b=BC.Matrix.makeYRotation(z[1]);for(c=0;c<B.length;c++){var d=BC.Matrix.makeTranslation(0,-c*H,0),f=BC.Matrix.matrixMultiply(I,K),f=BC.Matrix.matrixMultiply(f,
b),f=BC.Matrix.matrixMultiply(f,J),f=BC.Matrix.matrixMultiply(f,d);e.uniformMatrix4fv(w,!1,f);B[c].draw(k,q)}a=1+Math.abs(Math.sin(4*a))/50;a=BC.Matrix.makeScale(a,a,1);b=BC.Matrix.makeTranslation(A[0],A[1],A[2]);a=BC.Matrix.matrixMultiply(a,b);e.uniformMatrix4fv(w,!1,a);D.draw(k,q);requestAnimationFrame(m)}var c=document.getElementById("canvas");if(c){var e=c.getContext("webgl")||c.getContext("experimental-webgl");if(e){e.enable(e.CULL_FACE);e.enable(e.DEPTH_TEST);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);
var f=BC.GL.loadShader(e,"vertex-shader",e.VERTEX_SHADER),h=BC.GL.loadShader(e,"fragment-shader",e.FRAGMENT_SHADER),f=BC.GL.createProgram(e,[f,h]);e.useProgram(f);var k=e.getAttribLocation(f,"a_position"),q=e.getAttribLocation(f,"a_texcoord"),r=e.getUniformLocation(f,"u_projectionMatrix"),s=e.getUniformLocation(f,"u_viewMatrix"),w=e.getUniformLocation(f,"u_matrix"),x=BC.Time.getTimeInSeconds(),f=BC.Matrix.makeLookAt([0,0.75,2],[0,0,0],[0,1,0]),g=BC.Matrix.makeInverse(f),l=e.createTexture();e.bindTexture(e.TEXTURE_2D,
l);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([0,0,0,255]));var n=new Image;n.src="images/textures.png";$(n).load(function(){e.bindTexture(e.TEXTURE_2D,l);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n);e.generateMipmap(e.TEXTURE_2D)});f={numSlices:24,innerRadius:0.75,outerRadius:1,maxY:0.15,minY:-0.15};d();var u=a();$(window).resize(function(){d()&&(u=a())});var t=BC.GL.textureTileSet(4,4,0.002),h=[t.tile(0,0),t.tile(0,1),t.tile(0,2),t.tile(0,3),t.tile(1,
0),t.tile(1,1)],t=t.tile(1,2),B=[BC.Ring.makeRing(e,f,h),BC.Ring.makeRing(e,f,h),BC.Ring.makeRing(e,f,h)],D=BC.Selector.makeSelector(e,f,t),p={NONE:0,UP:1,DOWN:2,LEFT:3,RIGHT:4},F=0,G=0;$(c).on("touchstart touchmove touchend",function(a){var c=a.originalEvent.changedTouches[0];switch(a.type){case "touchstart":F=c.pageX;G=c.pageY;break;case "touchend":a=c.pageX-F;var c=c.pageY-G,d=p.NONE;50<a?d=p.LEFT:-50>a?d=p.RIGHT:50<c?d=p.DOWN:-50>c&&(d=p.UP);b(d)}return!1});$(document).keydown(function(a){b({37:p.LEFT,
39:p.RIGHT,38:p.UP,40:p.DOWN}[a.keyCode]);return!1});var v=p.NONE,y=0,C=0.05,E=0,I=BC.Matrix.makeScale(1,1,1),z=[0,0,0],J=BC.Matrix.makeXRotation(z[0]);BC.Matrix.makeYRotation(z[1]);var K=BC.Matrix.makeZRotation(z[2]),A=[0,0,0],L=2*Math.PI/24,H=0.3;m()}}};return k}(BC||{});$(document).ready(function(){BC.Game.run()});BC=function(k){var d=k.Math=k.Math||{};d.radians=function(a){return a*Math.PI/180};d.circlePoints=function(a,b,d){d=d||0;for(var c=2*Math.PI/b,e=[],f=0;f<b;f++)e[2*f]=a*Math.cos(d+f*c),e[2*f+1]=a*Math.sin(d+f*c);return e};d.cross=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]};d.subtractVectors=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]};d.normalize=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return 1E-5<b?[a[0]/b,a[1]/b,a[2]/b]:[0,0,0]};
return k}(BC||{});BC=function(k){var d=k.GL=k.GL||{};d.loadShader=function(a,b,d,c){c=c||BC.Util.error;var e=document.getElementById(b);if(!e)return c("** Error getting script element:"+b),null;b=a.createShader(d);a.shaderSource(b,e.text);a.compileShader(b);return a.getShaderParameter(b,a.COMPILE_STATUS)?b:(lastError=a.getShaderInfoLog(b),c("*** Error compiling shader '"+b+"':"+lastError),a.deleteShader(b),null)};d.createProgram=function(a,b,d,c){for(var e=a.createProgram(),f=0;f<b.length;f++)a.attachShader(e,b[f]);
if(d)for(f=0;f<d.length;f++)a.bindAttribLocation(e,c?c[f]:f,d[f]);a.linkProgram(e);return a.getProgramParameter(e,a.LINK_STATUS)?e:(lastError=a.getProgramInfoLog(e),error("Error in program linking: "+lastError),a.deleteProgram(e),null)};d.textureTileSet=function(a,b,d){var c=1/a,e=1/b;return{tile:function(a,b){var k=c*b,q=e*a;return{textureCoord:function(a,b){return[k+d+(c-2*d)*a,q+d+(e-2*d)*b]}}}}};return k}(BC||{});BC=function(k){(k.Util=k.Util||{}).error=function(d){window.console&&(window.console.error?window.console.error(d):window.console.log&&window.console.log(d))};return k}(BC||{});
