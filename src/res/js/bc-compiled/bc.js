var BC=function(g){var c=g.Matrix=g.Matrix||{};c.makeLookAt=function(a,b,c){b=BC.Math.normalize(BC.Math.subtractVectors(a,b));c=BC.Math.cross(c,b);var d=BC.Math.cross(b,c);return[c[0],c[1],c[2],0,d[0],d[1],d[2],0,b[0],b[1],b[2],0,a[0],a[1],a[2],1]};c.makePerspective=function(a,b,c,d){a=Math.tan(0.5*Math.PI-0.5*a);var q=1/(c-d);return[a/b,0,0,0,0,a,0,0,0,0,(c+d)*q,-1,0,0,c*d*q*2,0]};c.makeTranslation=function(a,b,c){return[1,0,0,0,0,1,0,0,0,0,1,0,a,b,c,1]};c.makeXRotation=function(a){var b=Math.cos(a);
a=Math.sin(a);return[1,0,0,0,0,b,a,0,0,-a,b,0,0,0,0,1]};c.makeYRotation=function(a){var b=Math.cos(a);a=Math.sin(a);return[b,0,-a,0,0,1,0,0,a,0,b,0,0,0,0,1]};c.makeZRotation=function(a){var b=Math.cos(a);a=Math.sin(a);return[b,a,0,0,-a,b,0,0,0,0,1,0,0,0,0,1]};c.makeScale=function(a,b,c){return[a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1]};c.makeInverse=function(a){var b=a[0],c=a[1],d=a[2],q=a[3],k=a[4],e=a[5],h=a[6],p=a[7],g=a[8],s=a[9],w=a[10],y=a[11],f=a[12],l=a[13],n=a[14];a=a[15];var r=w*a,D=n*y,F=h*a,B=
n*p,G=h*y,I=w*p,z=d*a,H=n*q,M=d*y,N=w*q,O=d*p,P=h*q,J=g*l,t=f*s,C=k*l,v=f*e,A=k*s,x=g*e,E=b*l,K=f*c,L=b*s,Q=g*c,R=b*e,S=k*c,T=r*e+B*s+G*l-(D*e+F*s+I*l),U=D*c+z*s+N*l-(r*c+H*s+M*l),l=F*c+H*e+O*l-(B*c+z*e+P*l),c=I*c+M*e+P*s-(G*c+N*e+O*s),e=1/(b*T+k*U+g*l+f*c);return[e*T,e*U,e*l,e*c,e*(D*k+F*g+I*f-(r*k+B*g+G*f)),e*(r*b+H*g+M*f-(D*b+z*g+N*f)),e*(B*b+z*k+P*f-(F*b+H*k+O*f)),e*(G*b+N*k+O*g-(I*b+M*k+P*g)),e*(J*p+v*y+A*a-(t*p+C*y+x*a)),e*(t*q+E*y+Q*a-(J*q+K*y+L*a)),e*(C*q+K*p+R*a-(v*q+E*p+S*a)),e*(x*q+L*p+
S*y-(A*q+Q*p+R*y)),e*(C*w+x*n+t*h-(A*n+J*h+v*w)),e*(L*n+J*d+K*w-(E*w+Q*n+t*d)),e*(E*h+S*n+v*d-(R*n+C*d+K*h)),e*(R*w+A*d+Q*h-(L*h+S*w+x*d))]};c.matrixMultiply=function(a,b){return[a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*b[3]+a[5]*b[7]+a[6]*b[11]+a[7]*
b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]]};return g}(BC||{});BC=function(g){(g.Time=g.Time||{}).getTimeInSeconds=function(){return 0.001*Date.now()};return g}(BC||{});BC=function(g){(g.Ring=g.Ring||{}).makeRing=function(c,a,b){for(var m=a.numSlices,d=a.outerRadius,q=a.maxY,k=a.minY,e=BC.Math.circlePoints(a.innerRadius,m),m=BC.Math.circlePoints(d,m),d=[],h=[],g=0,u=function(a,b,d,c,e,f,k){b=a.textureCoord(b,d);h[g++]=b[0];h[g++]=b[1];b=a.textureCoord(c,e);h[g++]=b[0];h[g++]=b[1];b=a.textureCoord(f,k);h[g++]=b[0];h[g++]=b[1]},s=0,w=0,y=0,f=0,l=0;y<a.numSlices;y++,l+=2){for(var n=(l+2)%m.length;w===s;)s=Math.floor(Math.random()*b.length);var w=s,r=b[s];d[f++]=e[l];
d[f++]=q;d[f++]=-e[l+1];d[f++]=m[l];d[f++]=q;d[f++]=-m[l+1];d[f++]=m[n];d[f++]=q;d[f++]=-m[n+1];u(r,0,0,0,1,1,1);d[f++]=e[l];d[f++]=q;d[f++]=-e[l+1];d[f++]=m[n];d[f++]=q;d[f++]=-m[n+1];d[f++]=e[n];d[f++]=q;d[f++]=-e[n+1];u(r,0,0,1,1,1,0);d[f++]=e[l];d[f++]=k;d[f++]=-e[l+1];d[f++]=m[n];d[f++]=k;d[f++]=-m[n+1];d[f++]=m[l];d[f++]=k;d[f++]=-m[l+1];u(r,0,0,1,1,0,1);d[f++]=e[l];d[f++]=k;d[f++]=-e[l+1];d[f++]=e[n];d[f++]=k;d[f++]=-e[n+1];d[f++]=m[n];d[f++]=k;d[f++]=-m[n+1];u(r,0,0,1,0,1,1);d[f++]=m[l];d[f++]=
k;d[f++]=-m[l+1];d[f++]=m[n];d[f++]=k;d[f++]=-m[n+1];d[f++]=m[n];d[f++]=q;d[f++]=-m[n+1];u(r,0,1,1,1,1,0);d[f++]=m[l];d[f++]=k;d[f++]=-m[l+1];d[f++]=m[n];d[f++]=q;d[f++]=-m[n+1];d[f++]=m[l];d[f++]=q;d[f++]=-m[l+1];u(r,0,1,1,0,0,0);d[f++]=e[l];d[f++]=k;d[f++]=-e[l+1];d[f++]=e[n];d[f++]=q;d[f++]=-e[n+1];d[f++]=e[n];d[f++]=k;d[f++]=-e[n+1];u(r,0,1,1,0,1,1);d[f++]=e[l];d[f++]=k;d[f++]=-e[l+1];d[f++]=e[l];d[f++]=q;d[f++]=-e[l+1];d[f++]=e[n];d[f++]=q;d[f++]=-e[n+1];u(r,0,1,0,0,1,0)}var D=c.createBuffer();
c.bindBuffer(c.ARRAY_BUFFER,D);c.bufferData(c.ARRAY_BUFFER,new Float32Array(d),c.STATIC_DRAW);var F=d.length/3,B=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,B);c.bufferData(c.ARRAY_BUFFER,new Float32Array(h),c.STATIC_DRAW);return{draw:function(a,b){c.bindBuffer(c.ARRAY_BUFFER,D);c.enableVertexAttribArray(a);c.vertexAttribPointer(a,3,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,B);c.enableVertexAttribArray(b);c.vertexAttribPointer(b,2,c.FLOAT,!1,0,0);c.drawArrays(c.TRIANGLES,0,F)}}};return g}(BC||
{});BC=function(g){(g.Selector=g.Selector||{}).makeSelector=function(c,a,b){var m=a.minY,d=a.maxY;a=BC.Math.circlePoints(a.outerRadius+0.01,a.numSlices,-Math.PI/2);var q=a.length-2,k=[],e=0;k[e++]=a[q]+0.001;k[e++]=m;k[e++]=-a[q+1]-0.001;k[e++]=a[0]+0.001;k[e++]=m;k[e++]=-a[1]-0.001;k[e++]=a[0]+0.001;k[e++]=d;k[e++]=-a[1]-0.001;k[e++]=a[q]+0.001;k[e++]=d;k[e++]=-a[q+1]-0.001;k[e++]=a[0]+0.001;k[e++]=m;k[e++]=-a[1]-0.001;k[e++]=a[2]+0.001;k[e++]=m;k[e++]=-a[3]-0.001;k[e++]=a[2]+0.001;k[e++]=d;k[e++]=-a[3]-
0.001;k[e++]=a[0]+0.001;k[e++]=d;k[e++]=-a[1]-0.001;var h=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,h);c.bufferData(c.ARRAY_BUFFER,new Float32Array(k),c.STATIC_DRAW);m=b.textureCoord(0,0);d=b.textureCoord(1,0);a=b.textureCoord(1,1);b=b.textureCoord(0,1);b=new Float32Array([].concat(m,d,a,b,m,d,a,b));var g=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,g);c.bufferData(c.ARRAY_BUFFER,b,c.STATIC_DRAW);var u=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7]),s=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,
s);c.bufferData(c.ELEMENT_ARRAY_BUFFER,u,c.STATIC_DRAW);return{draw:function(a,b){c.enable(c.BLEND);c.bindBuffer(c.ARRAY_BUFFER,h);c.enableVertexAttribArray(a);c.vertexAttribPointer(a,3,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,g);c.enableVertexAttribArray(b);c.vertexAttribPointer(b,2,c.FLOAT,!1,0,0);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,s);c.drawElements(c.TRIANGLES,u.length,c.UNSIGNED_SHORT,0);c.disable(c.BLEND)}}};return g}(BC||{});BC=function(g){(g.Game=g.Game||{}).run=function(){function c(){return e.width!=e.clientWidth||e.height!=e.clientHeight?(e.width=e.clientWidth,e.height=e.clientHeight,!0):!1}function a(){var a=e.width/e.height,b=BC.Math.radians(90);return BC.Matrix.makePerspective(b,a,1,2E3)}function b(){v===t.NONE&&(v=t.LEFT,x=0)}function m(){v===t.NONE&&(v=t.RIGHT,x=0)}function d(){v===t.NONE&&0<E&&(v=t.UP,x=0,E--)}function g(){v===t.NONE&&E+1<H.length&&(v=t.DOWN,x=0,E++)}function k(){h.clear(h.COLOR_BUFFER_BIT|
h.DEPTH_BUFFER_BIT);h.viewport(0,0,h.canvas.width,h.canvas.height);var a=BC.Time.getTimeInSeconds(),b=a-n;n=a;h.uniformMatrix4fv(y,!1,I);h.uniformMatrix4fv(f,!1,F);if(v!==t.NONE){x+b>C&&(b=C-x);var d=b*J/C,c=b*P/C;switch(v){case t.UP:A[1]+=d;break;case t.DOWN:A[1]-=d;break;case t.LEFT:r[1]+=c;break;case t.RIGHT:r[1]-=c}x+=b;x>=C&&(v=t.NONE,x=0)}b=BC.Matrix.makeYRotation(r[1]);for(d=0;d<H.length;d++){var c=BC.Matrix.makeTranslation(0,-d*J,0),e=BC.Matrix.matrixMultiply(D,O),e=BC.Matrix.matrixMultiply(e,
b),e=BC.Matrix.matrixMultiply(e,N),e=BC.Matrix.matrixMultiply(e,c);h.uniformMatrix4fv(l,!1,e);H[d].draw(s,w)}a=1+Math.abs(Math.sin(4*a))/50;a=BC.Matrix.makeScale(a,a,1);b=BC.Matrix.makeTranslation(A[0],A[1],A[2]);a=BC.Matrix.matrixMultiply(a,b);h.uniformMatrix4fv(l,!1,a);M.draw(s,w);requestAnimationFrame(k)}var e=document.getElementById("canvas");if(e){var h=e.getContext("webgl")||e.getContext("experimental-webgl");if(h){h.enable(h.CULL_FACE);h.enable(h.DEPTH_TEST);h.blendFunc(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA);
var p=BC.GL.loadShader(h,"vertex-shader",h.VERTEX_SHADER),u=BC.GL.loadShader(h,"fragment-shader",h.FRAGMENT_SHADER),p=BC.GL.createProgram(h,[p,u]);h.useProgram(p);var s=h.getAttribLocation(p,"a_position"),w=h.getAttribLocation(p,"a_texcoord"),y=h.getUniformLocation(p,"u_projectionMatrix"),f=h.getUniformLocation(p,"u_viewMatrix"),l=h.getUniformLocation(p,"u_matrix"),n=BC.Time.getTimeInSeconds(),r=[0,0,0],p=[1,1,1],D=BC.Matrix.makeScale(p[0],p[1],p[2]),p=BC.Matrix.makeLookAt([0,0.75,2],[0,0,0],[0,1,
0]),F=BC.Matrix.makeInverse(p),B=h.createTexture();h.bindTexture(h.TEXTURE_2D,B);h.texImage2D(h.TEXTURE_2D,0,h.RGBA,1,1,0,h.RGBA,h.UNSIGNED_BYTE,new Uint8Array([0,0,0,255]));var G=new Image;G.src="images/textures.png";$(G).load(function(){h.bindTexture(h.TEXTURE_2D,B);h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,G);h.generateMipmap(h.TEXTURE_2D)});p={numSlices:24,innerRadius:0.75,outerRadius:1,maxY:0.15,minY:-0.15};c();var I=a();$(window).resize(function(){c()&&(I=a())});var z=BC.GL.textureTileSet(4,
4,0.002),u=[z.tile(0,0),z.tile(0,1),z.tile(0,2),z.tile(0,3),z.tile(1,0),z.tile(1,1)],z=z.tile(1,2),H=[BC.Ring.makeRing(h,p,u),BC.Ring.makeRing(h,p,u),BC.Ring.makeRing(h,p,u)],M=BC.Selector.makeSelector(h,p,z),N=BC.Matrix.makeXRotation(r[0]);BC.Matrix.makeYRotation(r[1]);var O=BC.Matrix.makeZRotation(r[2]),P=2*Math.PI/24,J=0.3,t={NONE:0,UP:1,DOWN:2,LEFT:3,RIGHT:4},C=0.05,v=t.NONE,A=[0,0,0],x=0,E=0,K=0,L=0;$(document).on("touchstart",function(a){var b=a.originalEvent.changedTouches[0];K=b.pageX;L=b.pageY;
a.preventDefault()});$(document).on("touchmove",function(a){a.preventDefault()});$(document).on("touchend",function(a){var c=a.originalEvent.changedTouches[0],e=c.pageX-K,c=c.pageY-L;50<e?b():-50>e?m():50<c?g():-50>c&&d();a.preventDefault()});$(document).keydown(function(a){switch(a.keyCode){case 37:b();break;case 39:m();break;case 38:d();break;case 40:g()}});k()}}};return g}(BC||{});$(document).ready(function(){BC.Game.run()});BC=function(g){var c=g.Math=g.Math||{};c.radians=function(a){return a*Math.PI/180};c.circlePoints=function(a,b,c){c=c||0;for(var d=2*Math.PI/b,g=[],k=0;k<b;k++)g[2*k]=a*Math.cos(c+k*d),g[2*k+1]=a*Math.sin(c+k*d);return g};c.cross=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]};c.subtractVectors=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]};c.normalize=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return 1E-5<b?[a[0]/b,a[1]/b,a[2]/b]:[0,0,0]};
return g}(BC||{});BC=function(g){var c=g.GL=g.GL||{};c.loadShader=function(a,b,c,d){d=d||BC.Util.error;var g=document.getElementById(b);if(!g)return d("** Error getting script element:"+b),null;b=a.createShader(c);a.shaderSource(b,g.text);a.compileShader(b);return a.getShaderParameter(b,a.COMPILE_STATUS)?b:(lastError=a.getShaderInfoLog(b),d("*** Error compiling shader '"+b+"':"+lastError),a.deleteShader(b),null)};c.createProgram=function(a,b,c,d){for(var g=a.createProgram(),k=0;k<b.length;k++)a.attachShader(g,b[k]);
if(c)for(k=0;k<c.length;k++)a.bindAttribLocation(g,d?d[k]:k,c[k]);a.linkProgram(g);return a.getProgramParameter(g,a.LINK_STATUS)?g:(lastError=a.getProgramInfoLog(g),error("Error in program linking: "+lastError),a.deleteProgram(g),null)};c.textureTileSet=function(a,b,c){var d=1/a,g=1/b;return{tile:function(a,b){var h=d*b,p=g*a;return{textureCoord:function(a,b){return[h+c+(d-2*c)*a,p+c+(g-2*c)*b]}}}}};return g}(BC||{});BC=function(g){(g.Util=g.Util||{}).error=function(c){window.console&&(window.console.error?window.console.error(c):window.console.log&&window.console.log(c))};return g}(BC||{});
