var BC=function(h){var c=h.Matrix=h.Matrix||{};c.makeLookAt=function(a,b,c){b=BC.Math.normalize(BC.Math.subtractVectors(a,b));c=BC.Math.cross(c,b);var d=BC.Math.cross(b,c);return[c[0],c[1],c[2],0,d[0],d[1],d[2],0,b[0],b[1],b[2],0,a[0],a[1],a[2],1]};c.makePerspective=function(a,b,c,d){a=Math.tan(0.5*Math.PI-0.5*a);var k=1/(c-d);return[a/b,0,0,0,0,a,0,0,0,0,(c+d)*k,-1,0,0,c*d*k*2,0]};c.makeTranslation=function(a,b,c){return[1,0,0,0,0,1,0,0,0,0,1,0,a,b,c,1]};c.makeXRotation=function(a){var b=Math.cos(a);
a=Math.sin(a);return[1,0,0,0,0,b,a,0,0,-a,b,0,0,0,0,1]};c.makeYRotation=function(a){var b=Math.cos(a);a=Math.sin(a);return[b,0,-a,0,0,1,0,0,a,0,b,0,0,0,0,1]};c.makeZRotation=function(a){var b=Math.cos(a);a=Math.sin(a);return[b,a,0,0,-a,b,0,0,0,0,1,0,0,0,0,1]};c.makeScale=function(a,b,c){return[a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1]};c.identity=c.makeScale(1,1,1);c.makeInverse=function(a){var b=a[0],c=a[1],d=a[2],k=a[3],f=a[4],e=a[5],g=a[6],h=a[7],l=a[8],p=a[9],n=a[10],s=a[11],r=a[12],q=a[13],u=a[14];a=
a[15];var t=n*a,v=u*s,w=g*a,x=u*h,y=g*s,z=n*h,A=d*a,B=u*k,C=d*s,D=n*k,E=d*h,F=g*k,G=l*q,H=r*p,I=f*q,J=r*e,K=f*p,L=l*e,M=b*q,N=r*c,O=b*p,P=l*c,Q=b*e,R=f*c,S=t*e+x*p+y*q-(v*e+w*p+z*q),T=v*c+A*p+D*q-(t*c+B*p+C*q),q=w*c+B*e+E*q-(x*c+A*e+F*q),c=z*c+C*e+F*p-(y*c+D*e+E*p),e=1/(b*S+f*T+l*q+r*c);return[e*S,e*T,e*q,e*c,e*(v*f+w*l+z*r-(t*f+x*l+y*r)),e*(t*b+B*l+C*r-(v*b+A*l+D*r)),e*(x*b+A*f+F*r-(w*b+B*f+E*r)),e*(y*b+D*f+E*l-(z*b+C*f+F*l)),e*(G*h+J*s+K*a-(H*h+I*s+L*a)),e*(H*k+M*s+P*a-(G*k+N*s+O*a)),e*(I*k+N*h+
Q*a-(J*k+M*h+R*a)),e*(L*k+O*h+R*s-(K*k+P*h+Q*s)),e*(I*n+L*u+H*g-(K*u+G*g+J*n)),e*(O*u+G*d+N*n-(M*n+P*u+H*d)),e*(M*g+R*u+J*d-(Q*u+I*d+N*g)),e*(Q*n+K*d+P*g-(O*g+R*n+L*d))]};c.matrixMultiply=function(a,b){return[a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*
b[3]+a[5]*b[7]+a[6]*b[11]+a[7]*b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]]};return h}(BC||{});BC=function(h){(h.CellView=h.CellView||{}).make=function(c,a,b){function h(a,b){var d=b.positionLocation,g=b.textureCoordLocation,e=b.yellowBoostLocation,f=b.alphaLocation;c.bindBuffer(c.ARRAY_BUFFER,m);c.enableVertexAttribArray(d);c.vertexAttribPointer(d,3,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,l[a.blockStyle]);c.enableVertexAttribArray(g);c.vertexAttribPointer(g,2,c.FLOAT,!1,0,0);c.uniform1f(e,a.yellowBoost);c.uniform1f(f,a.alpha);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,p);c.drawElements(c.TRIANGLES,
n,c.UNSIGNED_SHORT,0)}var d=a.numCells,k=a.ringOuterRadius,f=a.ringHeight/2,e=-f,g=-Math.PI/2;a=BC.Math.circlePoints(a.ringInnerRadius,d,g);k=BC.Math.circlePoints(k,d,g);d=0;g=[];g[d++]=a[0];g[d++]=f;g[d++]=-a[1];g[d++]=k[0];g[d++]=f;g[d++]=-k[1];g[d++]=k[2];g[d++]=f;g[d++]=-k[3];g[d++]=a[2];g[d++]=f;g[d++]=-a[3];g[d++]=a[0];g[d++]=f;g[d++]=-a[1];g[d++]=a[0];g[d++]=e;g[d++]=-a[1];g[d++]=k[0];g[d++]=e;g[d++]=-k[1];g[d++]=k[0];g[d++]=f;g[d++]=-k[1];g[d++]=k[2];g[d++]=f;g[d++]=-k[3];g[d++]=k[2];g[d++]=
e;g[d++]=-k[3];g[d++]=a[2];g[d++]=e;g[d++]=-a[3];g[d++]=a[2];g[d++]=f;g[d++]=-a[3];g[d++]=k[0];g[d++]=f;g[d++]=-k[1];g[d++]=k[0];g[d++]=e;g[d++]=-k[1];g[d++]=k[2];g[d++]=e;g[d++]=-k[3];g[d++]=k[2];g[d++]=f;g[d++]=-k[3];g[d++]=a[2];g[d++]=f;g[d++]=-a[3];g[d++]=a[2];g[d++]=e;g[d++]=-a[3];g[d++]=a[0];g[d++]=e;g[d++]=-a[1];g[d++]=a[0];g[d++]=f;g[d++]=-a[1];var m=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,m);c.bufferData(c.ARRAY_BUFFER,new Float32Array(g),c.STATIC_DRAW);f=[];for(d=0;d<b.length;d++)for(e=
b[d],f[d]=[],k=a=0;5>a;a++)g=e.textureCoord(0,0),f[d][k++]=g[0],f[d][k++]=g[1],g=e.textureCoord(0,1),f[d][k++]=g[0],f[d][k++]=g[1],g=e.textureCoord(1,1),f[d][k++]=g[0],f[d][k++]=g[1],g=e.textureCoord(1,0),f[d][k++]=g[0],f[d][k++]=g[1];for(var l=[],d=0;d<b.length;d++)l[d]=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,l[d]),c.bufferData(c.ARRAY_BUFFER,new Float32Array(f[d]),c.STATIC_DRAW);b=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19]);var p=c.createBuffer();
c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,p);c.bufferData(c.ELEMENT_ARRAY_BUFFER,b,c.STATIC_DRAW);var n=b.length;return{drawOpaque:function(a,b){a.isEmpty()||a.isTransparent()||h(a,b)},drawTransparent:function(a,b){!a.isEmpty()&&a.isTransparent()&&(c.disable(c.CULL_FACE),h(a,b),c.enable(c.CULL_FACE))}}};return h}(BC||{});BC=function(h){(h.Animation=h.Animation||{}).make=function(c){var a=c.duration,b=c.startCallback,h=c.updateCallback,d=c.finishCallback,k=0,f=!1;b();return{update:function(b){var c=b.deltaTime;k+c>a&&(c=a-k);k+=c;b=h({now:b.now,deltaTime:c,elapsedPercent:k/a,deltaPercent:c/a});k>=a&&(d(),f=!0);return b},isDone:function(){return f}}};return h}(BC||{});BC=function(h){(h.BoardView=h.BoardView||{}).make=function(c,a,b){var h=b.boardMatrixLocation,d=b.ringMatrixLocation,k=b.cellMatrixLocation,f=BC.GL.textureTileSet(4,4,0.002),e=[f.tile(0,0),f.tile(0,1),f.tile(0,2),f.tile(0,3),f.tile(1,0),f.tile(1,1)],f=f.tile(1,2),g=BC.CellView.make(a,c.metrics,e),m=BC.SelectorView.make(a,c.metrics,f);return{draw:function(){a.uniformMatrix4fv(h,!1,c.matrix);for(var e=c.rings,f=0;2>f;f++)for(var n=0;n<e.length;n++){a.uniformMatrix4fv(d,!1,e[n].matrix);for(var s=e[n].cells,
r=0;r<s.length;r++)a.uniformMatrix4fv(k,!1,s[r].matrix),0==f?g.drawOpaque(s[r],b):g.drawTransparent(s[r],b)}a.uniformMatrix4fv(h,!1,c.selector.matrix);a.uniformMatrix4fv(d,!1,BC.Matrix.identity);a.uniformMatrix4fv(k,!1,BC.Matrix.identity);m.draw(b)}}};return h}(BC||{});BC=function(h){(h.SelectorView=h.SelectorView||{}).make=function(c,a,b){var h=-a.ringHeight/2,d=-h;a=BC.Math.circlePoints(a.ringOuterRadius+0.01,a.numCells,-Math.PI/2);var k=a.length-2,f=[],e=0;f[e++]=a[k]+0.001;f[e++]=h;f[e++]=-a[k+1]-0.001;f[e++]=a[0]+0.001;f[e++]=h;f[e++]=-a[1]-0.001;f[e++]=a[0]+0.001;f[e++]=d;f[e++]=-a[1]-0.001;f[e++]=a[k]+0.001;f[e++]=d;f[e++]=-a[k+1]-0.001;f[e++]=a[0]+0.001;f[e++]=h;f[e++]=-a[1]-0.001;f[e++]=a[2]+0.001;f[e++]=h;f[e++]=-a[3]-0.001;f[e++]=a[2]+0.001;f[e++]=d;
f[e++]=-a[3]-0.001;f[e++]=a[0]+0.001;f[e++]=d;f[e++]=-a[1]-0.001;var g=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,g);c.bufferData(c.ARRAY_BUFFER,new Float32Array(f),c.STATIC_DRAW);h=b.textureCoord(0,0);d=b.textureCoord(1,0);a=b.textureCoord(1,1);b=b.textureCoord(0,1);b=new Float32Array([].concat(h,d,a,b,h,d,a,b));var m=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,m);c.bufferData(c.ARRAY_BUFFER,b,c.STATIC_DRAW);var l=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7]),p=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,
p);c.bufferData(c.ELEMENT_ARRAY_BUFFER,l,c.STATIC_DRAW);return{draw:function(a){var b=a.positionLocation,d=a.textureCoordLocation;a=a.alphaLocation;c.bindBuffer(c.ARRAY_BUFFER,g);c.enableVertexAttribArray(b);c.vertexAttribPointer(b,3,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,m);c.enableVertexAttribArray(d);c.vertexAttribPointer(d,2,c.FLOAT,!1,0,0);c.uniform1f(a,1);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,p);c.drawElements(c.TRIANGLES,l.length,c.UNSIGNED_SHORT,0)}}};return h}(BC||{});BC=function(h){(h.Constants=h.Constants||{}).Direction={NONE:0,UP:1,DOWN:2,LEFT:3,RIGHT:4};return h}(BC||{});BC=function(h){(h.Board=h.Board||{}).make=function(c){function a(a,b){var d=h(a,b);if(d.state!==k.BLOCK)return!1;var g=b-1;0>g&&(g=c.numCells-1);g=h(a,g);if(g.state!==k.BLOCK||g.blockStyle!==d.blockStyle)return!1;var e=b+1;e>=c.numCells&&(e=0);e=h(a,e);if(e.state!==k.BLOCK||e.blockStyle!==d.blockStyle)return!1;g.clearBlock();d.clearBlock();e.clearBlock();return!0}function b(a,b){var d=h(a,b);if(d.state!==k.BLOCK)return!1;var g=a-1;if(0>g)return!1;g=h(g,b);if(g.state!==k.BLOCK||g.blockStyle!==d.blockStyle)return!1;
var e=a+1;if(e>=c.numRings)return!1;e=h(e,b);if(e.state!==k.BLOCK||e.blockStyle!==d.blockStyle)return!1;g.clearBlock();d.clearBlock();e.clearBlock();return!0}function h(a,b){return g.rings[a].cells[b]}for(var d=BC.Constants.Direction,k=BC.Cell.CellState,f=[],e=0;e<c.numRings;e++)f[e]=BC.Ring.make(e,c);var g={rings:f,matrix:BC.Matrix.identity,metrics:c,move:function(a){switch(a){case d.LEFT:n.move(d.LEFT)&&(l--,0>l&&(l=c.numCells-1));break;case d.RIGHT:n.move(d.RIGHT)&&(l++,l>=c.numCells&&(l=0));break;
case d.UP:0<m&&n.move(d.UP)&&m--;break;case d.DOWN:m+1<g.rings.length&&n.move(d.DOWN)&&m++}},rotate:function(a){p[1]+=a},swap:function(){var a=g.rings[m],b=a.cells[l],a=a.cells[(l+1)%a.cells.length],c=b.blockStyle,e=a.blockStyle;console.log(b.state+", "+a.state);b.state===k.EMPTY&&a.state===k.BLOCK?(a.sendBlock(0.125,d.LEFT),b.receiveBlock(0.125,d.RIGHT,e)):b.state===k.BLOCK&&a.state===k.EMPTY?(b.sendBlock(0.125,d.RIGHT),a.receiveBlock(0.125,d.LEFT,c)):b.state===k.BLOCK&&a.state===k.BLOCK&&(b.receiveBlock(0.125,
d.RIGHT,e),a.receiveBlock(0.125,d.LEFT,c))},update:function(e){for(var f=0;f<c.numRings;f++)for(var l=0;l<c.numCells;l++){h(f,l).update(e);var m=f,t=l;a(m,t);b(m,t);var v=t,t=h(m,v);t.state===k.BLOCK&&(m+=1,m>=c.numRings||(m=h(m,v),t.state===k.BLOCK&&m.state==k.EMPTY&&(t=t.sendBlock(0.075),m.receiveBlock(0.075,d.UP,t))))}n.update(e);e=BC.Matrix.makeXRotation(p[0]);f=BC.Matrix.makeYRotation(p[1]);l=BC.Matrix.makeZRotation(p[2]);f=BC.Matrix.matrixMultiply(l,f);f=BC.Matrix.matrixMultiply(f,e);g.matrix=
f}},m=0,l=c.numCells-1,p=[0,0,0],n=BC.Selector.make(c,g);g.selector=n;return g};return h}(BC||{});BC=function(h){(h.Ring=h.Ring||{}).make=function(c,a){for(var b=[],h=0;h<a.numCells;h++)b[h]=BC.Cell.make(h,a);h=BC.Matrix.makeTranslation(0,-c*a.ringHeight,0);return{cells:b,matrix:h}};return h}(BC||{});BC=function(h){(h.Selector=h.Selector||{}).make=function(c,a){var b=BC.Constants.Direction,h={matrix:BC.Matrix.identity,move:function(a){switch(a){case b.LEFT:return d!==b.NONE?a=!1:(d=b.LEFT,f=0,a=!0),a;case b.RIGHT:return d!==b.NONE?a=!1:(d=b.RIGHT,f=0,a=!0),a;case b.UP:return d!==b.NONE?a=!1:(d=b.UP,f=0,a=!0),a;case b.DOWN:return d!==b.NONE?a=!1:(d=b.DOWN,f=0,a=!0),a}},update:function(g){if(d!==b.NONE){var m=g.deltaTime;0.05<f+m&&(m=0.05-f);var l=m*c.ringHeight/0.05,p=m*e/0.05;switch(d){case b.UP:k[1]+=
l;break;case b.DOWN:k[1]-=l;break;case b.LEFT:a.rotate(p);break;case b.RIGHT:a.rotate(-p)}f+=m;0.05<=f&&(d=b.NONE,f=0)}g=1+Math.abs(Math.sin(4*g.now))/25;g=BC.Matrix.makeScale(g,g,1);m=BC.Matrix.makeTranslation(k[0],k[1],k[2]);h.matrix=BC.Matrix.matrixMultiply(g,m)}},d=b.NONE,k=[0,0,0],f=0,e=BC.Math.sliceRadians(c.numCells);return h};return h}(BC||{});BC=function(h){(h.Game=h.Game||{}).run=function(){function c(a){return e.getUniformLocation(n,a)}function a(){return f.width!=f.clientWidth||f.height!=f.clientHeight?(f.width=f.clientWidth,f.height=f.clientHeight,!0):!1}function b(){var a=f.width/f.height,b=BC.Math.radians(90);return BC.Matrix.makePerspective(b,a,1,2E3)}function h(){var a=BC.Matrix.makeLookAt([0,0.5,2],[0,0,0],[0,1,0]);return BC.Matrix.makeInverse(a)}function d(){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);e.viewport(0,0,e.canvas.width,
e.canvas.height);e.uniformMatrix4fv(s.projectionMatrixLocation,!1,r);t.tick();q.update(t);u.draw();requestAnimationFrame(d)}var k=BC.Constants.Direction,f=document.getElementById("canvas");if(f){var e=f.getContext("webgl")||f.getContext("experimental-webgl");if(e){var g=e.createTexture();e.bindTexture(e.TEXTURE_2D,g);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([0,0,0,255]));var m=new Image;m.src="images/textures.png";$(m).load(function(){e.bindTexture(e.TEXTURE_2D,
g);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,m);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST);e.generateMipmap(e.TEXTURE_2D)});e.enable(e.CULL_FACE);e.enable(e.DEPTH_TEST);e.enable(e.BLEND);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);var l=BC.GL.loadShader(e,"vertex-shader",e.VERTEX_SHADER),p=BC.GL.loadShader(e,"fragment-shader",e.FRAGMENT_SHADER),n=BC.GL.createProgram(e,[l,p]);e.useProgram(n);
var s={positionLocation:e.getAttribLocation(n,"a_position"),textureCoordLocation:e.getAttribLocation(n,"a_textureCoord"),projectionMatrixLocation:c("u_projectionMatrix"),viewMatrixLocation:c("u_viewMatrix"),boardMatrixLocation:c("u_boardMatrix"),ringMatrixLocation:c("u_ringMatrix"),cellMatrixLocation:c("u_cellMatrix"),yellowBoostLocation:c("u_yellowBoost"),alphaLocation:c("u_alpha")};a();var r=b();$(window).resize(function(){a()&&(r=b())});l=h();e.uniformMatrix4fv(s.viewMatrixLocation,!1,l);var q=
BC.Board.make({numRings:3,numCells:24,numBlockTypes:6,ringInnerRadius:0.75,ringOuterRadius:1,ringHeight:0.3}),u=BC.BoardView.make(q,e,s),l=BC.Controller.make(f);l.setMoveLeftListener(function(){q.move(k.LEFT)});l.setMoveRightListener(function(){q.move(k.RIGHT)});l.setMoveUpListener(function(){q.move(k.UP)});l.setMoveDownListener(function(){q.move(k.DOWN)});l.setPrimaryActionListener(function(){q.swap()});var t=BC.StopWatch.make();d()}}};return h}(BC||{});$(document).ready(function(){BC.Game.run()});BC=function(h){var c=h.Math=h.Math||{};c.radians=function(a){return a*Math.PI/180};c.sliceRadians=function(a){return 2*Math.PI/a};c.randomInt=function(a){return Math.floor(Math.random()*a)};c.circlePoints=function(a,b,c){c=c||0;for(var d=2*Math.PI/b,h=[],f=0;f<b;f++)h[2*f]=a*Math.cos(c+f*d),h[2*f+1]=a*Math.sin(c+f*d);return h};c.cross=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]};c.subtractVectors=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]};c.normalize=
function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return 1E-5<b?[a[0]/b,a[1]/b,a[2]/b]:[0,0,0]};return h}(BC||{});BC=function(h){var c=h.Cell=h.Cell||{};c.CellState={EMPTY:0,EMPTY_RESERVED:1,BLOCK:2,RECEIVING_BLOCK:3,CLEARING_BLOCK:4};c.make=function(a,b){var c=BC.Cell.CellState,d=BC.Constants.Direction,h=BC.Math.randomInt(b.numBlockTypes),f=[],e=BC.Math.sliceRadians(b.numCells),g=[0,a*e,0],m=[0,0,0],l={matrix:BC.Matrix.makeYRotation(g[1]),state:c.BLOCK,blockStyle:h,yellowBoost:0,alpha:1,clearBlock:function(){var a=BC.Animation.make({duration:0.5,startCallback:function(){l.state=c.CLEARING_BLOCK},updateCallback:function(a){l.yellowBoost=
Math.abs(Math.sin(50*a.now)/2);return!1},finishCallback:function(){l.yellowBoost=0}}),b=BC.Animation.make({duration:0.125,startCallback:function(){},updateCallback:function(a){l.alpha=1-a.elapsedPercent;return!1},finishCallback:function(){l.state=c.EMPTY;l.alpha=1}});f.push(a,b)},sendBlock:function(a){var b=l.blockStyle;f.push(BC.Animation.make({duration:a,startCallback:function(){l.blockStyle=0;l.state=c.EMPTY_RESERVED},updateCallback:function(a){return!1},finishCallback:function(){l.state=c.EMPTY}}));
return b},receiveBlock:function(a,h,k){f.push(BC.Animation.make({duration:a,startCallback:function(){l.state=c.RECEIVING_BLOCK;l.blockStyle=k;switch(h){case d.LEFT:g[1]-=e;break;case d.RIGHT:g[1]+=e;break;case d.UP:m[1]=b.ringHeight}},updateCallback:function(a){var c=e*a.deltaPercent;a=b.ringHeight*a.deltaPercent;switch(h){case d.LEFT:return g[1]+=c,!0;case d.RIGHT:return g[1]-=c,!0;case d.UP:return m[1]-=a,!0;default:return!1}},finishCallback:function(){l.state=c.BLOCK}}))},isEmpty:function(){return l.state===
c.EMPTY||l.state===c.EMPTY_RESERVED},isTransparent:function(){return l.state===c.CLEARING_BLOCK},update:function(a){var b=!1;if(0<f.length){var c=f[0],b=b|c.update(a);c.isDone()&&f.shift()}b&&(a=BC.Matrix.makeYRotation(g[1]),b=BC.Matrix.makeTranslation(m[0],m[1],m[2]),l.matrix=BC.Matrix.matrixMultiply(a,b))}};return l};return h}(BC||{});BC=function(h){var c=h.GL=h.GL||{};c.loadShader=function(a,b,c,d){d=d||BC.Util.error;var h=document.getElementById(b);if(!h)return d("** Error getting script element:"+b),null;b=a.createShader(c);a.shaderSource(b,h.text);a.compileShader(b);return a.getShaderParameter(b,a.COMPILE_STATUS)?b:(lastError=a.getShaderInfoLog(b),d("*** Error compiling shader '"+b+"':"+lastError),a.deleteShader(b),null)};c.createProgram=function(a,b,c,d){for(var h=a.createProgram(),f=0;f<b.length;f++)a.attachShader(h,b[f]);
if(c)for(f=0;f<c.length;f++)a.bindAttribLocation(h,d?d[f]:f,c[f]);a.linkProgram(h);return a.getProgramParameter(h,a.LINK_STATUS)?h:(lastError=a.getProgramInfoLog(h),error("Error in program linking: "+lastError),a.deleteProgram(h),null)};c.textureTileSet=function(a,b,c){var d=1/a,h=1/b;return{tile:function(a,b){var g=d*b,m=h*a;return{textureCoord:function(a,b){return[g+c+(d-2*c)*a,m+c+(h-2*c)*b]}}}}};return h}(BC||{});BC=function(h){(h.Util=h.Util||{}).error=function(c){window.console&&(window.console.error?window.console.error(c):window.console.log&&window.console.log(c))};return h}(BC||{});BC=function(h){(h.Controller=h.Controller||{}).make=function(c){var a=function(){},b=function(){},h=function(){},d=function(){},k=function(){};$(document).keydown(function(c){switch(c.keyCode){case 32:k.call();break;case 37:a.call();break;case 39:b.call();break;case 38:h.call();break;case 40:d.call()}return!1});var f=0,e=0;$(c).on("touchstart touchmove touchend",function(c){var m=c.originalEvent.changedTouches[0];switch(c.type){case "touchstart":f=m.pageX;e=m.pageY;break;case "touchend":c=m.pageX-
f,m=m.pageY-e,50<c?a.call():-50>c?b.call():50<m?d.call():-50>m?h.call():k.call()}return!1});return{setMoveLeftListener:function(b){a=b},setMoveRightListener:function(a){b=a},setMoveUpListener:function(a){h=a},setMoveDownListener:function(a){d=a},setPrimaryActionListener:function(a){k=a}}};return h}(BC||{});BC=function(h){(h.StopWatch=h.StopWatch||{}).make=function(){var c={then:0.001*Date.now(),tick:function(){c.now=0.001*Date.now();c.deltaTime=c.now-c.then;c.then=c.now}};return c};return h}(BC||{});
