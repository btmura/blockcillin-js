var BC=function(c){var e=c.Cell=c.Cell||{};e.CellState={EMPTY:0,EMPTY_NO_SWAP:1,EMPTY_NO_DROP:2,BLOCK:3,BLOCK_INCOMING:4,BLOCK_RECEIVING:5,BLOCK_CLEARING_MARKED:6,BLOCK_CLEARING_PREPARING:7,BLOCK_CLEARING_READY:8,BLOCK_CLEARING_IN_PROGRESS:9};e.make=function(a){function b(){var a=BC.Matrix.makeYRotation(w[1]),b=BC.Matrix.makeTranslation(p[0],p[1],p[2]);n.matrix=BC.Matrix.matrixMultiply(a,b)}var l=BC.Cell.CellState,k=BC.Common.Direction,d=BC.Audio.Sound,g=a.metrics,h=a.rotationY,e=a.state,f=a.blockStyle,
c=a.audioPlayer,q=BC.Math.sliceRadians(g.numCells),r=[],v=!1,w=[0,h,0],p=[0,0,0],n={matrix:BC.Matrix.makeYRotation(w[1]),state:e,blockStyle:f,yellowBoost:0,alpha:1,markBlock:function(){n.state=l.BLOCK_CLEARING_MARKED;0<r.length&&BC.Util.error("markBlock: pending animations: "+r.length);var a=BC.Animation.make({duration:0.5,startCallback:function(){n.state=l.BLOCK_CLEARING_PREPARING},updateCallback:function(a){n.yellowBoost=Math.abs(Math.sin(50*a.now)/2);return!1},finishCallback:function(){n.yellowBoost=
0}}),b=BC.Animation.make({duration:0.25,startCallback:function(){n.blockStyle+=g.numBlockTypes},finishCallback:function(){n.state=l.BLOCK_CLEARING_READY}});r.push(a,b)},clearBlock:function(){n.state=l.BLOCK_CLEARING_IN_PROGRESS;0<r.length&&BC.Util.error("clearBlock: pending animations: "+r.length);var a=BC.Animation.make({duration:0.25,startCallback:function(){c.play(d.CELL_CLEAR)},updateCallback:function(a){n.alpha=1-a.elapsedPercent;return!1},finishCallback:function(){n.state=l.EMPTY_NO_DROP;n.alpha=
1}});r.push(a)},sendBlock:function(a){var b=n.blockStyle;n.blockStyle=0;n.state=l.EMPTY_NO_SWAP;0<r.length&&BC.Util.error("sendBlock: pending animations: "+r.length);r.push(BC.Animation.make({duration:a,finishCallback:function(){n.state=l.EMPTY}}));return b},receiveBlock:function(a,d,h){n.blockStyle=h;n.state=l.BLOCK_RECEIVING;switch(d){case k.LEFT:w[1]-=q;break;case k.RIGHT:w[1]+=q;break;case k.UP:p[1]=g.ringHeight;v=!0;break;default:BC.Util.error("receiveBlock: unsupport direction: "+d)}b();0<r.length&&
BC.Util.error("receiveBlock: pending animations: "+r.length);r.push(BC.Animation.make({duration:a,updateCallback:function(a){var b=q*a.deltaPercent;a=g.ringHeight*a.deltaPercent;switch(d){case k.LEFT:return w[1]+=b,!0;case k.RIGHT:return w[1]-=b,!0;case k.UP:return p[1]-=a,!0;default:return!1}},finishCallback:function(){n.state=l.BLOCK;v=!1}}))},isClearing:function(){return n.state===l.BLOCK_CLEARING_MARKED||n.state===l.BLOCK_CLEARING_PREPARING||n.state===l.BLOCK_CLEARING_READY||n.state===l.BLOCK_CLEARING_IN_PROGRESS},
isDrawable:function(){return n.state!==l.EMPTY&&n.state!==l.EMPTY_NO_SWAP&&n.state!==l.EMPTY_NO_DROP},isTransparent:function(){return n.state===l.BLOCK_CLEARING_IN_PROGRESS},hasDroppingBlock:function(){return v},update:function(a){BC.Animation.process(r,a)&&b()}};return n};return c}(BC||{});BC=function(c){(c.Ring=c.Ring||{}).make=function(e){var a=BC.Cell.CellState,b=e.metrics,l=e.translationY,k=e.selectable;e=e.audioPlayer;for(var d=BC.Math.sliceRadians(b.numCells),l=BC.Matrix.makeTranslation(0,l,0),a=k?a.BLOCK:a.BLOCK_INCOMING,g=[],h=0;h<b.numCells;h++){var c=h*d,f=BC.Math.randomInt(b.numBlockTypes);k||(f+=2*b.numBlockTypes);g[h]=BC.Cell.make({metrics:b,rotationY:c,state:a,blockStyle:f,audioPlayer:e})}return{matrix:l,cells:g,isEmpty:function(){for(var a=0;a<g.length;a++)if(g[a].state!==
BC.Cell.CellState.EMPTY)return!1;return!0},setSelectable:function(a){if(!k&&a)for(var d=0;d<g.length;d++)g[d].state===BC.Cell.CellState.BLOCK_INCOMING&&(g[d].state=BC.Cell.CellState.BLOCK,g[d].blockStyle-=2*b.numBlockTypes);k=a},isSelectable:function(){return k}}};return c}(BC||{});BC=function(c){var e=c.Board=c.Board||{};(e.View=e.View||{}).make=function(a){var b=a.board,l=a.gl,k=a.programLocations,d=a.resources,g=a.speedLevelStatView,h=a.elapsedTimeStatView,e=a.scoreStatView,f=k.boardRotationMatrixLocation,c=k.boardTranslationMatrixLocation,q=k.selectorMatrixLocation,r=k.ringMatrixLocation,v=k.cellMatrixLocation,w=BC.Cell.View.make(l,b.metrics,d.blockTextureTiles),p=BC.Selector.View.make(l,b.metrics,d.selectorTextureTile),n=BC.Stage.View.make(l,b.metrics,d.blackTextureTile);
return{draw:function(){g.draw(b.speedLevel);h.draw(b.elapsedTime);e.draw(b.score);l.uniformMatrix4fv(f,!1,b.rotationMatrix);l.uniformMatrix4fv(c,!1,b.translationMatrix);l.uniformMatrix4fv(q,!1,BC.Matrix.identity);for(var a=b.rings,d=0;2>d;d++)for(var z=0;z<a.length;z++){l.uniformMatrix4fv(r,!1,a[z].matrix);for(var B=a[z].cells,y=0;y<B.length;y++)l.uniformMatrix4fv(v,!1,B[y].matrix),0==d?w.drawOpaque(B[y],k):w.drawTransparent(B[y],k)}l.uniformMatrix4fv(f,!1,BC.Matrix.identity);l.uniformMatrix4fv(c,
!1,BC.Matrix.identity);l.uniformMatrix4fv(q,!1,b.stage.matrix);l.uniformMatrix4fv(r,!1,BC.Matrix.identity);l.uniformMatrix4fv(v,!1,BC.Matrix.identity);n.draw(k);l.uniformMatrix4fv(f,!1,BC.Matrix.identity);l.uniformMatrix4fv(c,!1,b.translationMatrix);l.uniformMatrix4fv(q,!1,b.selector.matrix);l.uniformMatrix4fv(r,!1,BC.Matrix.identity);l.uniformMatrix4fv(v,!1,BC.Matrix.identity);p.draw(k)}}};return c}(BC||{});BC=function(c){var e=c.Math=c.Math||{};e.radians=function(a){return a*Math.PI/180};e.sliceRadians=function(a){return 2*Math.PI/a};e.randomInt=function(a){return Math.floor(Math.random()*a)};e.circlePoints=function(a,b,l){l=l||0;for(var k=2*Math.PI/b,d=[],g=0;g<b;g++)d[2*g]=a*Math.cos(l+g*k),d[2*g+1]=a*Math.sin(l+g*k);return d};e.cross=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]};e.subtractVectors=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]};e.normalize=
function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return 1E-5<b?[a[0]/b,a[1]/b,a[2]/b]:[0,0,0]};return c}(BC||{});BC=function(c){var e=c.GL=c.GL||{};e.loadShader=function(a,b,l,k){k=k||BC.Util.error;var d=document.getElementById(b);if(!d)return k("** Error getting script element:"+b),null;b=a.createShader(l);a.shaderSource(b,d.text);a.compileShader(b);return a.getShaderParameter(b,a.COMPILE_STATUS)?b:(lastError=a.getShaderInfoLog(b),k("*** Error compiling shader '"+b+"':"+lastError),a.deleteShader(b),null)};e.createProgram=function(a,b,l,k){for(var d=a.createProgram(),g=0;g<b.length;g++)a.attachShader(d,b[g]);
if(l)for(g=0;g<l.length;g++)a.bindAttribLocation(d,k?k[g]:g,l[g]);a.linkProgram(d);return a.getProgramParameter(d,a.LINK_STATUS)?d:(lastError=a.getProgramInfoLog(d),BC.Util.error("Error in program linking: "+lastError),a.deleteProgram(d),null)};e.textureTileSet=function(a,b,l){var k=1/a,d=1/b;return{tile:function(a,b){var e=k*b,f=d*a;return{textureCoord:function(a,b){return[e+l+(k-2*l)*a,f+l+(d-2*l)*b]}}}}};return c}(BC||{});BC=function(c){var e=c.Audio=c.Audio||{};(e.Player=e.Player||{}).make=function(){function a(a){var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=function(){b.decodeAudioData(d.response,function(a){l=a},function(){BC.Util.error("error decoding data for "+a)})};d.send()}var b,l;window.AudioContext=window.AudioContext||window.webkitAudioContext;window.AudioContext&&(b=new AudioContext,a("audio/sounds.ogg"));return{play:function(a){if(l){var d=l,g=a.offset;a=a.duration;
var h=b.createBufferSource();h.buffer=d;h.connect(b.destination);h.start(0,g,a)}}}};return c}(BC||{});BC=function(c){function e(a,b){return{offset:a,duration:b}}(c.Audio=c.Audio||{}).Sound={BUTTON_HOVER:e(1,0.5),BUTTON_CLICK:e(0,0.75),SELECTOR_MOVEMENT:e(1,0.5),CELL_SWAP:e(2,0.5),CELL_CLEAR:e(3,0.5)};return c}(BC||{});BC=function(c){(c.Selector=c.Selector||{}).make=function(e){function a(a){f=a;0<t.length&&BC.Util.error("startMoving: pending animations: "+t.length);t.push(BC.Animation.make({duration:h,updateCallback:function(a){var k=b.ringHeight*a.deltaPercent;a=r*a.deltaPercent;switch(f){case d.UP:return q[1]+=k,!0;case d.DOWN:return q[1]-=k,!0;case d.LEFT:return l.rotate(a),!0;case d.RIGHT:return l.rotate(-a),!0;default:return!1}},finishCallback:function(){f=d.NONE;k.play(g.SELECTOR_MOVEMENT)}}))}var b=e.metrics,
l=e.board,k=e.audioPlayer,d=BC.Common.Direction,g=BC.Audio.Sound,h=0.025,c={matrix:BC.Matrix.identity,move:function(b){switch(b){case d.LEFT:return f!==d.NONE?b=!1:(a(d.LEFT),b=!0),b;case d.RIGHT:return f!==d.NONE?b=!1:(a(d.RIGHT),b=!0),b;case d.UP:return f!==d.NONE?b=!1:(a(d.UP),b=!0),b;case d.DOWN:return f!==d.NONE?b=!1:(a(d.DOWN),b=!0),b;default:return BC.Util.error("move: unsupported direction: "+b),!1}},update:function(a){BC.Animation.process(t,a);a=1+Math.abs(Math.sin(4*a.now))/25;a=BC.Matrix.makeScale(a,
a,1);var b=BC.Matrix.makeTranslation(q[0],q[1],q[2]);c.matrix=BC.Matrix.matrixMultiply(a,b)}},f=d.NONE,t=[],q=[0,0,0],r=BC.Math.sliceRadians(b.numCells);return c};return c}(BC||{});BC=function(c){(c.Resources=c.Resources||{}).make=function(){var e=BC.GL.textureTileSet(8,8,0.002),a=[e.tile(0,0),e.tile(0,1),e.tile(0,2),e.tile(0,3),e.tile(0,4),e.tile(0,5),e.tile(2,0),e.tile(2,1),e.tile(2,2),e.tile(2,3),e.tile(2,4),e.tile(2,5),e.tile(1,0),e.tile(1,1),e.tile(1,2),e.tile(1,3),e.tile(1,4),e.tile(1,5)],b=e.tile(4,0),e=e.tile(4,1);return{blockTextureTiles:a,selectorTextureTile:b,blackTextureTile:e}};return c}(BC||{});BC=function(c){(c.Common=c.Common||{}).Unit={NONE:"NONE",SECONDS:"SECONDS"};return c}(BC||{});BC=function(c){(c.Common=c.Common||{}).Direction={NONE:"0",UP:"1",DOWN:"2",LEFT:"3",RIGHT:"4"};return c}(BC||{});BC=function(c){var e=c.Common=c.Common||{};(e.Storage=e.Storage||{}).make=function(){var a=localStorage||{};return{get:function(b){return a[b]},set:function(b,l){a[b]=l}}};return c}(BC||{});BC=function(c){var e=c.Common=c.Common||{};(e.Clock=e.Clock||{}).make=function(){return{now:function(){return Date.now()}}};return c}(BC||{});BC=function(c){var e=c.Common=c.Common||{};(e.StopWatch=e.StopWatch||{}).make=function(a){function b(){k.then=0.001*l.now()}var l=a.clock,k={reset:b,tick:function(){k.now=0.001*l.now();k.deltaTime=k.now-k.then;k.then=k.now}};b();return k};return c}(BC||{});BC=function(c){(c.Game=c.Game||{}).run=function(){function e(a){return s.getUniformLocation(X,a)}function a(){return C.width!=C.clientWidth||C.height!=C.clientHeight?(C.width=C.clientWidth,C.height=C.clientHeight,!0):!1}function b(){var a=C.width/C.height,b=BC.Math.radians(90);return BC.Matrix.makePerspective(b,a,1,2E3)}function l(){var a=BC.Matrix.makeLookAt([0,0.1,3],[0,0,0],[0,1,0]);return BC.Matrix.makeInverse(a)}function k(){n=!0;x=!1;A=BC.Board.make({metrics:P,audioPlayer:I});J=BC.Board.View.make({board:A,
gl:s,programLocations:Y,resources:Q,speedLevelStatView:R,elapsedTimeStatView:S,scoreStatView:T});N.setMoveLeftListener(function(){A.move(v.LEFT)});N.setMoveRightListener(function(){A.move(v.RIGHT)});N.setMoveUpListener(function(){A.move(v.UP)});N.setMoveDownListener(function(){A.move(v.DOWN)});N.setPrimaryActionListener(function(){A.swap()});d()}function d(){u=!1;h(!1);K.reset();g()}function g(){s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);s.viewport(0,0,s.canvas.width,s.canvas.height);s.uniformMatrix4fv(Y.projectionMatrixLocation,
!1,aa);var a=!u&&!x&&A;if(a){K.tick();var b=x;x=A.update(K);b!==x&&W.addStats({speedLevel:A.speedLevel.value,elapsedTime:A.elapsedTime.value,score:A.score.value})}J&&J.draw();a&&requestAnimationFrame(g);x&&(u=n=!1,h(!0))}function h(a){if(a){B.text(x?t:n&&u?f:c);if(a=n||x)E.draw(A.speedLevel),U.draw(A.score),G.draw(A.elapsedTime);var b=y;a?b.show():b.hide();a=D;n?a.show():a.hide();z.fadeIn(q);F.fadeOut(q)}else z.fadeOut(q),F.fadeIn(q)}var c="b l o c k c i l l i n",f="P A U S E D",t="G A M E  O V E R",
q="slow",r=BC.Common.Clock,v=BC.Common.Direction,w=BC.Audio.Sound,p=BC.Common.StopWatch,n=!1,u=!1,x=!1,z=$("#main-menu"),B=$("#main-menu-title",z),y=$("#main-menu-stats",z),D=$("#continue-button",z),L=$("#new-game-button",z),M=$("#stats-button",z),H=$("#options-button",z),E=BC.View.Stat.make($("#speed-level-stat",z)),G=BC.View.Stat.make($("#elapsed-time-stat",z)),U=BC.View.Stat.make($("#score-stat",z)),F=$("#game-menu"),V=$("#pause-button",F),R=BC.View.Stat.make($("#speed-level-stat",F)),S=BC.View.Stat.make($("#elapsed-time-stat",
F)),T=BC.View.Stat.make($("#score-stat",F)),O=$(".button"),P={numRings:3,numCells:24,numBlockTypes:6,ringInnerRadius:0.75,ringOuterRadius:1,ringHeight:0.3},Q=BC.Resources.make(),r=r.make(),K=p.make({clock:r}),I=BC.Audio.Player.make(),A,J,C=document.getElementById("canvas");if(C){var p=BC.Common.Storage.make(),W=BC.Game.StatBoard.make({storage:p}),ca=BC.Menu.Stats.make({statBoard:W}),N=BC.Controller.make({storage:p,canvas:C}),da=BC.Menu.Options.make({controller:N}),s=C.getContext("webgl")||C.getContext("experimental-webgl");
if(s){var ba=s.createTexture();s.bindTexture(s.TEXTURE_2D,ba);s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array([0,0,0,255]));var Z=new Image;Z.src="images/textures.png";$(Z).load(function(){s.bindTexture(s.TEXTURE_2D,ba);s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Z);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR_MIPMAP_NEAREST);s.generateMipmap(s.TEXTURE_2D)});s.enable(s.CULL_FACE);
s.enable(s.DEPTH_TEST);s.enable(s.BLEND);s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA);var p=BC.GL.loadShader(s,"vertex-shader",s.VERTEX_SHADER),r=BC.GL.loadShader(s,"fragment-shader",s.FRAGMENT_SHADER),X=BC.GL.createProgram(s,[p,r]);s.useProgram(X);var Y={positionLocation:s.getAttribLocation(X,"a_position"),textureCoordLocation:s.getAttribLocation(X,"a_textureCoord"),projectionMatrixLocation:e("u_projectionMatrix"),viewMatrixLocation:e("u_viewMatrix"),boardRotationMatrixLocation:e("u_boardRotationMatrix"),
boardTranslationMatrixLocation:e("u_boardTranslationMatrix"),selectorMatrixLocation:e("u_selectorMatrix"),ringMatrixLocation:e("u_ringMatrix"),cellMatrixLocation:e("u_cellMatrix"),yellowBoostLocation:e("u_yellowBoost"),alphaLocation:e("u_alpha")};a();var aa=b();$(window).resize(function(){a()&&(aa=b(),g())});p=l();s.uniformMatrix4fv(Y.viewMatrixLocation,!1,p);O.click(function(a){I.play(w.BUTTON_CLICK);$(a.target).fadeIn(20).fadeOut(20).fadeIn(20).fadeOut(20).fadeIn(20)});O.mouseenter(function(){I.play(w.BUTTON_HOVER)});
h(!0);D.click(function(){d()});L.click(function(){k()});M.click(function(){ca.show()});H.click(function(){da.show()});V.click(function(){u=!0;h(!0)});N.setMenuActionListener(function(){u?d():(u=!0,h(!0))});document.addEventListener("visibilitychange",function(){document.hidden&&(u=!0,h(!0))})}}};return c}(BC||{});$(document).ready(function(){BC.Game.run()});BC=function(c){var e=c.Cell=c.Cell||{},e=e.Chain=e.Chain||{};e.find=function(a){function b(b,d){return a.rings[b].cells[d]}function l(){for(var d=a.rings.length,k=[],l=0;l<d;l++){var g;g=l;for(var c=0,p=b(g,c),n=0;n<e;n++){var u=b(g,c);if(p.state!==u.state||p.blockStyle!=u.blockStyle)break;c+=1;c=c===e?0:c}g=c;for(c=0;c<e;)if(n=(c+g)%e,u=b(l,n),u.state!==h.BLOCK)c++;else{for(var x=1,p=c+1;p<e;p++)if(n=(p+g)%e,n=b(l,n),u.state===n.state&&u.blockStyle==n.blockStyle)x++;else break;if(x>=f){for(u=[];c<
p;c++)n=(c+g)%e,x=b(l,n),u.push({cell:x,row:l,col:n});k.push(u)}c=p}}return k}function k(){for(var d=a.rings.length,k=[],l=0;l<e;l++)for(var g=0;g<d;){var c=b(g,l);if(c.state!==h.BLOCK)g++;else{for(var p=1,n=g+1;n<d;n++){var u=b(n,l);if(c.state===u.state&&c.blockStyle==u.blockStyle)p++;else break}if(p>=f){for(c=[];g<n;g++)p=b(g,l),c.push({cell:p,row:g,col:l});k.push(c)}g=n}}return k}function d(a,b){for(var d=0;d<a.length;d++)for(var k=a[d],l=0;l<b.length;l++){var g=b[l];if(k.blockStyle===g.blockStyle&&
k.row===g.row&&k.col===g.col)return!0}return!1}function g(a,b){for(var d=0;d<a.length;d++){var k=a[d];if(k.blockStyle===b.blockStyle&&k.row===b.row&&k.col===b.col)return!0}return!1}var h=BC.Cell.CellState,e=a.rings[0].cells.length,f=3;return function(){for(var a=[],b=l(),c=k();0<b.length;){var h=b.shift();for(a.push(h);;){for(var f=!1,e=0;e<c.length;e++)if(d(h,c[e])){for(f=0;f<c[e].length;f++)g(h,c[e][f])||h.push(c[e][f]);c.splice(e,1);f=!0}if(!f)break;f=!1;for(e=0;e<b.length;e++)if(d(h,b[e])){for(f=
0;f<b[e].length;f++)g(h,b[e][f])||h.push(b[e][f]);b.splice(e,1);f=!0}if(!f)break}}for(;0<c.length;)h=c.shift(),a.push(h);for(e=0;e<a.length;e++)a[e].sort(function(a,b){return a.row-b.row});return a}()};e.makeManager=function(){var a=BC.Cell.CellState,b=[],l=[];return{update:function(k){k=BC.Cell.Chain.find(k);for(var d=0;d<k.length;d++){var e=k[d];l.push(e);for(var c=0;c<e.length;c++){var m=e[c].cell;m.markBlock();b.push(m)}}if(0<b.length)switch(m=b[0],m.state){case a.BLOCK_CLEARING_MARKED:case a.BLOCK_CLEARING_PREPARING:break;
case a.BLOCK_CLEARING_READY:m.clearBlock();break;case a.BLOCK_CLEARING_IN_PROGRESS:break;default:b.shift()}if(0<l.length){e=l[0];c=!0;for(d=0;d<e.length;d++)m=e[d].cell,c&=!m.isClearing();if(c){for(d=0;d<e.length;d++)m=e[d].cell,m.state===a.EMPTY_NO_DROP&&(m.state=a.EMPTY);l.shift()}}return{newChains:k,pendingChainCount:l.length}}}};return c}(BC||{});BC=function(c){(c.Stage=c.Stage||{}).make=function(e,a){a+=e.ringHeight/2-0.01;return{matrix:BC.Matrix.makeTranslation(0,a,0)}};return c}(BC||{});BC=function(c){var e=c.Util=c.Util||{};e.log=function(a){window.console&&window.console.log&&window.console.log(a)};e.error=function(a){window.console&&(window.console.error?window.console.error(a):window.console.log&&window.console.log(a))};return c}(BC||{});BC=function(c){var e=c.Selector=c.Selector||{};(e.View=e.View||{}).make=function(a,b,l){var k=-b.ringHeight/2,d=-k;b=BC.Math.circlePoints(b.ringOuterRadius+0.01,b.numCells,-Math.PI/2);var e=b.length-2,c=[],m=0;c[m++]=b[e]+0.001;c[m++]=k;c[m++]=-b[e+1]-0.001;c[m++]=b[0]+0.001;c[m++]=k;c[m++]=-b[1]-0.001;c[m++]=b[0]+0.001;c[m++]=d;c[m++]=-b[1]-0.001;c[m++]=b[e]+0.001;c[m++]=d;c[m++]=-b[e+1]-0.001;c[m++]=b[0]+0.001;c[m++]=k;c[m++]=-b[1]-0.001;c[m++]=b[2]+0.001;c[m++]=k;c[m++]=-b[3]-0.001;c[m++]=b[2]+
0.001;c[m++]=d;c[m++]=-b[3]-0.001;c[m++]=b[0]+0.001;c[m++]=d;c[m++]=-b[1]-0.001;var f=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,f);a.bufferData(a.ARRAY_BUFFER,new Float32Array(c),a.STATIC_DRAW);k=l.textureCoord(0,0);d=l.textureCoord(1,0);b=l.textureCoord(1,1);l=l.textureCoord(0,1);l=new Float32Array([].concat(k,d,b,l,k,d,b,l));var t=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,t);a.bufferData(a.ARRAY_BUFFER,l,a.STATIC_DRAW);var q=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7]),r=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,
r);a.bufferData(a.ELEMENT_ARRAY_BUFFER,q,a.STATIC_DRAW);return{draw:function(b){var d=b.positionLocation,c=b.textureCoordLocation;b=b.alphaLocation;a.bindBuffer(a.ARRAY_BUFFER,f);a.enableVertexAttribArray(d);a.vertexAttribPointer(d,3,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,t);a.enableVertexAttribArray(c);a.vertexAttribPointer(c,2,a.FLOAT,!1,0,0);a.uniform1f(b,1);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r);a.drawElements(a.TRIANGLES,q.length,a.UNSIGNED_SHORT,0)}}};return c}(BC||{});BC=function(c){var e=c.Matrix=c.Matrix||{};e.makeLookAt=function(a,b,c){b=BC.Math.normalize(BC.Math.subtractVectors(a,b));c=BC.Math.cross(c,b);var k=BC.Math.cross(b,c);return[c[0],c[1],c[2],0,k[0],k[1],k[2],0,b[0],b[1],b[2],0,a[0],a[1],a[2],1]};e.makePerspective=function(a,b,c,k){a=Math.tan(0.5*Math.PI-0.5*a);var d=1/(c-k);return[a/b,0,0,0,0,a,0,0,0,0,(c+k)*d,-1,0,0,c*k*d*2,0]};e.makeTranslation=function(a,b,c){return[1,0,0,0,0,1,0,0,0,0,1,0,a,b,c,1]};e.makeXRotation=function(a){var b=Math.cos(a);
a=Math.sin(a);return[1,0,0,0,0,b,a,0,0,-a,b,0,0,0,0,1]};e.makeYRotation=function(a){var b=Math.cos(a);a=Math.sin(a);return[b,0,-a,0,0,1,0,0,a,0,b,0,0,0,0,1]};e.makeZRotation=function(a){var b=Math.cos(a);a=Math.sin(a);return[b,a,0,0,-a,b,0,0,0,0,1,0,0,0,0,1]};e.makeScale=function(a,b,c){return[a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1]};e.identity=e.makeScale(1,1,1);e.makeInverse=function(a){var b=a[0],c=a[1],k=a[2],d=a[3],e=a[4],h=a[5],m=a[6],f=a[7],t=a[8],q=a[9],r=a[10],v=a[11],w=a[12],p=a[13],n=a[14];a=
a[15];var u=r*a,x=n*v,z=m*a,B=n*f,y=m*v,D=r*f,L=k*a,M=n*d,H=k*v,E=r*d,G=k*f,U=m*d,F=t*p,V=w*q,R=e*p,S=w*h,T=e*q,O=t*h,P=b*p,Q=w*c,K=b*q,I=t*c,A=b*h,J=e*c,C=u*h+B*q+y*p-(x*h+z*q+D*p),W=x*c+L*q+E*p-(u*c+M*q+H*p),p=z*c+M*h+G*p-(B*c+L*h+U*p),c=D*c+H*h+U*q-(y*c+E*h+G*q),h=1/(b*C+e*W+t*p+w*c);return[h*C,h*W,h*p,h*c,h*(x*e+z*t+D*w-(u*e+B*t+y*w)),h*(u*b+M*t+H*w-(x*b+L*t+E*w)),h*(B*b+L*e+U*w-(z*b+M*e+G*w)),h*(y*b+E*e+G*t-(D*b+H*e+U*t)),h*(F*f+S*v+T*a-(V*f+R*v+O*a)),h*(V*d+P*v+I*a-(F*d+Q*v+K*a)),h*(R*d+Q*f+
A*a-(S*d+P*f+J*a)),h*(O*d+K*f+J*v-(T*d+I*f+A*v)),h*(R*r+O*n+V*m-(T*n+F*m+S*r)),h*(K*n+F*k+Q*r-(P*r+I*n+V*k)),h*(P*m+J*n+S*k-(A*n+R*k+Q*m)),h*(A*r+T*k+I*m-(K*m+J*r+O*k))]};e.matrixMultiply=function(a,b){return[a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*
b[3]+a[5]*b[7]+a[6]*b[11]+a[7]*b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]]};return c}(BC||{});BC=function(c){var e=c.Cell=c.Cell||{};(e.Drop=e.Drop||{}).makeManager=function(a){var b=BC.Cell.CellState,c=BC.Common.Direction,e=[];return{update:function(d){for(var g=0;g<d.rings.length;g++)for(var h=0;h<a.numCells;h++){var m=d,f=g,t=h,q=m.rings[f].cells[t];q.state===b.BLOCK&&(f+=1,f>=m.rings.length||(m=m.rings[f].cells[t],q.state===b.BLOCK&&m.state==b.EMPTY&&(q=q.sendBlock(0.05),m.receiveBlock(0.05,c.UP,q),e.push(m))))}a:{for(;0<e.length;){if(e[0].hasDroppingBlock()){d=!0;break a}e.shift()}d=
!1}return d}}};return c}(BC||{});BC=function(c){var e=c.Animation=c.Animation||{};e.make=function(a){var b=a.duration,c=a.startCallback||function(){},e=a.updateCallback||function(){return!1},d=a.finishCallback||function(){},g=0,h=!1,m=!1;return{update:function(a){h||(h=!0,c());var t=a.deltaTime;g+t>b&&(t=b-g);g+=t;a=e({now:a.now,deltaTime:t,elapsedPercent:g/b,deltaPercent:t/b});g>=b&&(m=!0,d());return a},isDone:function(){return m}}};e.process=function(a,b){var c=!1;if(0<a.length){var e=a[0],c=c|e.update(b);e.isDone()&&a.shift()}return c};
return c}(BC||{});BC=function(c){var e=c.Stage=c.Stage||{};(e.View=e.View||{}).make=function(a,b,c){b=[];var e=0;b[e++]=-1;b[e++]=0;b[e++]=1;b[e++]=1;b[e++]=0;b[e++]=1;b[e++]=1;b[e++]=0;b[e++]=-1;b[e++]=-1;b[e++]=0;b[e++]=-1;b[e++]=-1;b[e++]=-1;b[e++]=1;b[e++]=1;b[e++]=-1;b[e++]=1;b[e++]=1;b[e++]=0;b[e++]=1;b[e++]=-1;b[e++]=0;b[e++]=1;var d=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d);a.bufferData(a.ARRAY_BUFFER,new Float32Array(b),a.STATIC_DRAW);b=c.textureCoord(0,0);var e=c.textureCoord(1,0),g=c.textureCoord(1,
1);c=c.textureCoord(0,1);c=new Float32Array([].concat(b,e,g,c,b,e,g,c));var h=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,h);a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW);var m=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7]),f=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,f);a.bufferData(a.ELEMENT_ARRAY_BUFFER,m,a.STATIC_DRAW);return{draw:function(b){var c=b.positionLocation,e=b.textureCoordLocation,k=b.yellowBoostLocation;b=b.alphaLocation;a.bindBuffer(a.ARRAY_BUFFER,d);a.enableVertexAttribArray(c);
a.vertexAttribPointer(c,3,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,h);a.enableVertexAttribArray(e);a.vertexAttribPointer(e,2,a.FLOAT,!1,0,0);a.uniform1f(k,0);a.uniform1f(b,1);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,f);a.drawElements(a.TRIANGLES,m.length,a.UNSIGNED_SHORT,0)}}};return c}(BC||{});BC=function(c){(c.Board=c.Board||{}).make=function(c){function a(a){a=BC.Ring.make({metrics:k,translationY:-k.ringHeight*z,selectable:a,audioPlayer:d});x.push(a);z++}function b(){y.translationMatrix=BC.Matrix.makeTranslation(n[0],n[1],n[2])}function l(){var a=BC.Matrix.makeXRotation(u[0]),b=BC.Matrix.makeYRotation(u[1]),d=BC.Matrix.makeZRotation(u[2]),b=BC.Matrix.matrixMultiply(d,b),b=BC.Matrix.matrixMultiply(b,a);y.rotationMatrix=b}var k=c.metrics,d=c.audioPlayer,g=BC.Cell.CellState,h=BC.Common.Direction,
m=BC.Audio.Sound;c=BC.Game.Stat;for(var f=BC.Common.Unit,t=11*k.ringHeight,q=2*k.ringHeight,r=0,v=k.numCells-1,w=5.5*-k.ringHeight-k.ringHeight/2,p=k.ringHeight*k.numRings,n=[0,w+p,0],u=[0,0,0],x=[],z=0,B=0;B<k.numRings;B++)a(!0);for(B=0;2>B;B++)a(!1);var y={metrics:k,rings:x,rotationMatrix:BC.Matrix.identity,translationMatrix:BC.Matrix.identity,move:function(a){switch(a){case h.LEFT:D.move(h.LEFT)&&(v--,0>v&&(v=k.numCells-1));break;case h.RIGHT:D.move(h.RIGHT)&&(v++,v>=k.numCells&&(v=0));break;case h.UP:0<
r&&D.move(h.UP)&&r--;break;case h.DOWN:r+1<y.rings.length&&x[r+1].isSelectable()&&D.move(h.DOWN)&&r++}},rotate:function(a){u[1]+=a},swap:function(){var a=x[r].cells[v%k.numCells],b=x[r].cells[(v+1)%k.numCells];BC.Util.log("swap: ("+a.state+", "+b.state+")");var c=a.blockStyle,e=b.blockStyle;a.state!==g.EMPTY&&a.state!==g.EMPTY_NO_DROP||b.state!==g.BLOCK?a.state!==g.BLOCK||b.state!==g.EMPTY&&b.state!==g.EMPTY_NO_DROP?a.state===g.BLOCK&&b.state===g.BLOCK&&(a.receiveBlock(0.1,h.RIGHT,e),b.receiveBlock(0.1,
h.LEFT,c),d.play(m.CELL_SWAP)):(a.sendBlock(0.1,h.RIGHT),b.receiveBlock(0.1,h.LEFT,c),d.play(m.CELL_SWAP)):(b.sendBlock(0.1,h.LEFT),a.receiveBlock(0.1,h.RIGHT,e),d.play(m.CELL_SWAP))},update:function(d){for(var c=0;c<x.length;c++)for(var e=0;e<k.numCells;e++)x[c].cells[e%k.numCells].update(d);for(var c=0|M.update(y),e=L.update(y),f=0;f<e.newChains.length;f++)G.value+=100*e.newChains[f].length;c|=0<e.pendingChainCount;c||(c=(0.02+0.01*(H.value-1))*d.deltaTime,p+c>t&&(c=t-p),p+=c,n[1]+=c);E.value+=
d.deltaTime;H.value=1+Math.floor(E.value/30);D.update(d);b();for(l();0<x.length&&x[0].isEmpty();)x.shift(),p-=k.ringHeight,r--;for(d=p-k.ringHeight*x.length;d>-q;)a(!1),d-=k.ringHeight;for(d=x.length-1;0<=d&&!x[d].isSelectable();d--)0<=p-k.ringHeight*(d+1)&&x[d].setSelectable(!0);return p>=t}};b();l();var D=BC.Selector.make({metrics:k,board:y,audioPlayer:d});y.selector=D;w=BC.Stage.make(k,w);y.stage=w;var L=BC.Cell.Chain.makeManager(),M=BC.Cell.Drop.makeManager(k),H=c.make({value:1,unit:f.NONE});
y.speedLevel=H;var E=c.make({value:0,unit:f.SECONDS});y.elapsedTime=E;var G=c.make({value:0,unit:f.NONE});y.score=G;return y};return c}(BC||{});BC=function(c){var e=c.Menu=c.Menu||{};(e.Options=e.Options||{}).make=function(a){function b(a,b,d){var c=$(a,b);t[d]=c;c.click(function(){c.text(h);f.startKeyCodeAssignment(d)});return c}function c(a,b){var d=f.getKeyCode(b);a.text(g[d]||"#"+d)}function e(){f.cancelKeyCodeAssignment();q.fadeOut(m)}var d=BC.Controller.Key,g={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause/Break",20:"Caps Lock",27:"Esc",32:"Space",33:"Page Up",34:"Page Down",35:"End",36:"Home",37:"Left",38:"Up",
39:"Right",40:"Down",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"Windows",93:"Right Click",96:"Numpad 0",97:"Numpad 1",98:"Numpad 2",99:"Numpad 3",100:"Numpad 4",101:"Numpad 5",102:"Numpad 6",103:"Numpad 7",104:"Numpad 8",105:"Numpad 9",106:"Numpad *",107:"Numpad +",
109:"Numpad -",110:"Numpad .",111:"Numpad /",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Num Lock",145:"Scroll Lock",182:"My Computer",183:"My Calculator",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},h="PRESS KEY",m="slow",f=a.controller,t={},q=$("#options-menu"),r=b("#up-button",q,d.UP),v=b("#down-button",q,d.DOWN),w=b("#left-button",q,d.LEFT),p=b("#right-button",q,d.RIGHT),n=b("#swap-button",
q,d.PRIMARY_ACTION),u=b("#menu-button",q,d.MENU_ACTION);$("#close-button",q).click(function(){e()});f.setKeyCodeAssignmentListener(function(a,b){t[a].text(g[b]||"#"+b)});return{show:function(){c(r,d.UP);c(v,d.DOWN);c(w,d.LEFT);c(p,d.RIGHT);c(n,d.PRIMARY_ACTION);c(u,d.MENU_ACTION);q.fadeIn(m)},hide:e}};return c}(BC||{});BC=function(c){var e=c.Menu=c.Menu||{};(e.Stats=e.Stats||{}).make=function(a){function b(){h.fadeOut(c)}var c="slow",e=BC.Game.Stat,d=BC.Common.Unit,g=a.statBoard,h=$("#stats-menu"),m=$("#no-stats-label",h);a=$("#close-button",h);for(var f=[],t=[],q=1;5>=q;q++){var r=$("#stats-entry-"+q,h);f.push(r);var v=function(a){return BC.View.Stat.make($(a,r))};t.push({speedLevel:v("#speed-level-stat"),elapsedTime:v("#elapsed-time-stat"),score:v("#score-stat")})}var w=e.make(),p=e.make({unit:d.SECONDS}),n=e.make();
a.click(function(){b()});return{show:function(){var a=g.getStats();0==a.length?m.show():m.hide();for(var b=0;b<f.length;b++)b<a.length?(w.value=a[b].speedLevel,p.value=a[b].elapsedTime,n.value=a[b].score,t[b].speedLevel.draw(w),t[b].elapsedTime.draw(p),t[b].score.draw(n),f[b].show()):f[b].hide();h.fadeIn(c)},hide:b}};return c}(BC||{});BC=function(c){var e=c.View=c.View||{},a;(e.Stat=e.Stat||{}).make=function(b){if(!a){var c=BC.Common.Unit;a={};a[c.NONE]=function(a){return a};a[c.SECONDS]=function(a){var b=Math.floor(a/3600);a-=3600*b;var c=Math.floor(a/60);a=Math.floor(a-60*c);10>b&&(b="0"+b);10>c&&(c="0"+c);10>a&&(a="0"+a);return b+":"+c+":"+a}}return{draw:function(c){b.text((0,a[c.unit])(c.value))}}};return c}(BC||{});BC=function(c){var e=c.Controller=c.Controller||{};e.Key={UP:"0",DOWN:"1",LEFT:"2",RIGHT:"3",PRIMARY_ACTION:"4",MENU_ACTION:"5"};e.make=function(a){function b(a,b){var c=parseInt(g.get(a),10)||b;return{storageKey:a,keyCode:c}}function c(a){return u[a].keyCode}function e(a,b){u[a].keyCode=b;g.set(u[a].storageKey,b);v(a,b)}var d=BC.Controller.Key,g=a.storage;a=a.canvas;var h=function(){},m=function(){},f=function(){},t=function(){},q=function(){},r=function(){},v=function(){},w=0,p=0,n,u={};u[d.UP]=
b("bc.controller.up",38);u[d.DOWN]=b("bc.controller.down",40);u[d.LEFT]=b("bc.controller.left",37);u[d.RIGHT]=b("bc.controller.right",39);u[d.PRIMARY_ACTION]=b("bc.controller.primaryAction",32);u[d.MENU_ACTION]=b("bc.controller.menuAction",27);$(document).keydown(function(a){if(null!=n){a=a.keyCode;var b=c(n),g;a:{var p=n;for(g in u)if(u.hasOwnProperty(g)&&g!==p&&u[g].keyCode===a)break a;g=null}g&&e(g,b);e(n,a);n=null;return!1}switch(a.keyCode){case c(d.LEFT):h.call();break;case c(d.RIGHT):m.call();
break;case c(d.UP):f.call();break;case c(d.DOWN):t.call();break;case c(d.PRIMARY_ACTION):q.call();break;case c(d.MENU_ACTION):r.call();break;default:console.log(a.keyCode)}return!1});$(a).on("touchstart touchmove touchend",function(a){var b=a.originalEvent.changedTouches[0];switch(a.type){case "touchstart":w=b.pageX;p=b.pageY;break;case "touchend":var c=b.pageX-w,d=b.pageY-p,e=Math.abs(c),g=Math.abs(d);a=function(){return 20<g?(0<d?t.call():f.call(),!0):!1};b=function(){return 20<e?(0<c?h.call():
m.call(),!0):!1};if(e>g){if(b()||a())break}else if(a()||b())break;q.call()}return!1});return{setMoveLeftListener:function(a){h=a},setMoveRightListener:function(a){m=a},setMoveUpListener:function(a){f=a},setMoveDownListener:function(a){t=a},setPrimaryActionListener:function(a){q=a},setMenuActionListener:function(a){r=a},setKeyCodeAssignmentListener:function(a){v=a},startKeyCodeAssignment:function(a){n=a},cancelKeyCodeAssignment:function(){n=null},getKeyCode:c}};return c}(BC||{});BC=function(c){var e=c.Game=c.Game||{};(e.StatBoard=e.StatBoard||{}).make=function(a){function b(){var a=d.get(e);return a?JSON.parse(a):[]}function c(a,b){var d=b.score-a.score;if(0!==d)return d;d=b.elapsedTime-a.elapsedTime;return 0!==d?d:b.speedLevel-a.speedLevel}var e="bc.stats",d=a.storage;return{getStats:b,addStats:function(a){var h=b();h.push(a);h.sort(c);h.slice(0,5);d.set(e,JSON.stringify(h))}}};return c}(BC||{});BC=function(c){var e=c.Game=c.Game||{};(e.Stat=e.Stat||{}).make=function(a){a=a||{};return{value:a.value||0,unit:a.unit||BC.Common.Unit.NONE}};return c}(BC||{});BC=function(c){var e=c.Cell=c.Cell||{};(e.View=e.View||{}).make=function(a,b,c){function e(b,c){var d=c.positionLocation,f=c.textureCoordLocation,g=c.yellowBoostLocation,h=c.alphaLocation;a.bindBuffer(a.ARRAY_BUFFER,t);a.enableVertexAttribArray(d);a.vertexAttribPointer(d,3,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,q[b.blockStyle]);a.enableVertexAttribArray(f);a.vertexAttribPointer(f,2,a.FLOAT,!1,0,0);a.uniform1f(g,b.yellowBoost);a.uniform1f(h,b.alpha);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r);a.drawElements(a.TRIANGLES,
v,a.UNSIGNED_SHORT,0)}var d=b.numCells,g=b.ringOuterRadius,h=b.ringHeight/2,m=-h,f=-Math.PI/2;b=BC.Math.circlePoints(b.ringInnerRadius,d,f);g=BC.Math.circlePoints(g,d,f);d=0;f=[];f[d++]=b[0];f[d++]=h;f[d++]=-b[1];f[d++]=g[0];f[d++]=h;f[d++]=-g[1];f[d++]=g[2];f[d++]=h;f[d++]=-g[3];f[d++]=b[2];f[d++]=h;f[d++]=-b[3];f[d++]=g[0];f[d++]=m;f[d++]=-g[1];f[d++]=b[0];f[d++]=m;f[d++]=-b[1];f[d++]=b[2];f[d++]=m;f[d++]=-b[3];f[d++]=g[2];f[d++]=m;f[d++]=-g[3];f[d++]=b[0];f[d++]=h;f[d++]=-b[1];f[d++]=b[0];f[d++]=
m;f[d++]=-b[1];f[d++]=g[0];f[d++]=m;f[d++]=-g[1];f[d++]=g[0];f[d++]=h;f[d++]=-g[1];f[d++]=g[2];f[d++]=h;f[d++]=-g[3];f[d++]=g[2];f[d++]=m;f[d++]=-g[3];f[d++]=b[2];f[d++]=m;f[d++]=-b[3];f[d++]=b[2];f[d++]=h;f[d++]=-b[3];f[d++]=g[0];f[d++]=h;f[d++]=-g[1];f[d++]=g[0];f[d++]=m;f[d++]=-g[1];f[d++]=g[2];f[d++]=m;f[d++]=-g[3];f[d++]=g[2];f[d++]=h;f[d++]=-g[3];f[d++]=b[2];f[d++]=h;f[d++]=-b[3];f[d++]=b[2];f[d++]=m;f[d++]=-b[3];f[d++]=b[0];f[d++]=m;f[d++]=-b[1];f[d++]=b[0];f[d++]=h;f[d++]=-b[1];var t=a.createBuffer();
a.bindBuffer(a.ARRAY_BUFFER,t);a.bufferData(a.ARRAY_BUFFER,new Float32Array(f),a.STATIC_DRAW);h=[];for(d=0;d<c.length;d++)for(m=c[d],h[d]=[],g=b=0;6>b;b++)f=m.textureCoord(0,0),h[d][g++]=f[0],h[d][g++]=f[1],f=m.textureCoord(0,1),h[d][g++]=f[0],h[d][g++]=f[1],f=m.textureCoord(1,1),h[d][g++]=f[0],h[d][g++]=f[1],f=m.textureCoord(1,0),h[d][g++]=f[0],h[d][g++]=f[1];for(var q=[],d=0;d<c.length;d++)q[d]=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,q[d]),a.bufferData(a.ARRAY_BUFFER,new Float32Array(h[d]),
a.STATIC_DRAW);c=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);var r=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r);a.bufferData(a.ELEMENT_ARRAY_BUFFER,c,a.STATIC_DRAW);var v=c.length;return{drawOpaque:function(a,b){a.isDrawable()&&!a.isTransparent()&&e(a,b)},drawTransparent:function(b,c){b.isDrawable()&&b.isTransparent()&&(a.disable(a.CULL_FACE),e(b,c),a.enable(a.CULL_FACE))}}};return c}(BC||{});
