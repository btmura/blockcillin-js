var BC=function(h){var d=h.Matrix=h.Matrix||{};d.makeLookAt=function(a,b,D){b=BC.Math.normalize(BC.Math.subtractVectors(a,b));D=BC.Math.cross(D,b);var c=BC.Math.cross(b,D);return[D[0],D[1],D[2],0,c[0],c[1],c[2],0,b[0],b[1],b[2],0,a[0],a[1],a[2],1]};d.makePerspective=function(a,b,D,c){a=Math.tan(0.5*Math.PI-0.5*a);var d=1/(D-c);return[a/b,0,0,0,0,a,0,0,0,0,(D+c)*d,-1,0,0,D*c*d*2,0]};d.makeTranslation=function(a,b,d){return[1,0,0,0,0,1,0,0,0,0,1,0,a,b,d,1]};d.makeXRotation=function(a){var b=Math.cos(a);
a=Math.sin(a);return[1,0,0,0,0,b,a,0,0,-a,b,0,0,0,0,1]};d.makeYRotation=function(a){var b=Math.cos(a);a=Math.sin(a);return[b,0,-a,0,0,1,0,0,a,0,b,0,0,0,0,1]};d.makeZRotation=function(a){var b=Math.cos(a);a=Math.sin(a);return[b,a,0,0,-a,b,0,0,0,0,1,0,0,0,0,1]};d.makeScale=function(a,b,d){return[a,0,0,0,0,b,0,0,0,0,d,0,0,0,0,1]};d.makeInverse=function(a){var b=a[0],d=a[1],c=a[2],k=a[3],e=a[4],l=a[5],h=a[6],s=a[7],t=a[8],q=a[9],A=a[10],B=a[11],y=a[12],u=a[13],v=a[14];a=a[15];var r=A*a,m=v*B,F=h*a,f=
v*s,z=h*B,C=A*s,w=c*a,E=v*k,G=c*B,H=A*k,g=c*s,n=h*k,p=t*u,x=y*q,I=e*u,J=y*l,K=e*q,M=t*l,N=b*u,O=y*d,P=b*q,Q=t*d,R=b*l,S=e*d,T=r*l+f*q+z*u-(m*l+F*q+C*u),U=m*d+w*q+H*u-(r*d+E*q+G*u),u=F*d+E*l+g*u-(f*d+w*l+n*u),d=C*d+G*l+n*q-(z*d+H*l+g*q),l=1/(b*T+e*U+t*u+y*d);return[l*T,l*U,l*u,l*d,l*(m*e+F*t+C*y-(r*e+f*t+z*y)),l*(r*b+E*t+G*y-(m*b+w*t+H*y)),l*(f*b+w*e+n*y-(F*b+E*e+g*y)),l*(z*b+H*e+g*t-(C*b+G*e+n*t)),l*(p*s+J*B+K*a-(x*s+I*B+M*a)),l*(x*k+N*B+Q*a-(p*k+O*B+P*a)),l*(I*k+O*s+R*a-(J*k+N*s+S*a)),l*(M*k+P*s+
S*B-(K*k+Q*s+R*B)),l*(I*A+M*v+x*h-(K*v+p*h+J*A)),l*(P*v+p*c+O*A-(N*A+Q*v+x*c)),l*(N*h+S*v+J*c-(R*v+I*c+O*h)),l*(R*A+K*c+Q*h-(P*h+S*A+M*c))]};d.matrixMultiply=function(a,b){return[a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*b[3]+a[5]*b[7]+a[6]*b[11]+a[7]*
b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]]};return h}(BC||{});BC=function(h){(h.Time=h.Time||{}).getTimeInSeconds=function(){return 0.001*Date.now()};return h}(BC||{});BC=function(h){var d=h.GL=h.GL||{};d.loadShader=function(a,b,d,c){c=c||BC.Util.error;var k=document.getElementById(b);if(!k)return c("** Error getting script element:"+b),null;b=a.createShader(d);a.shaderSource(b,k.text);a.compileShader(b);return a.getShaderParameter(b,a.COMPILE_STATUS)?b:(lastError=a.getShaderInfoLog(b),c("*** Error compiling shader '"+b+"':"+lastError),a.deleteShader(b),null)};d.createProgram=function(a,b,d,c){for(var k=a.createProgram(),e=0;e<b.length;e++)a.attachShader(k,b[e]);
if(d)for(e=0;e<d.length;e++)a.bindAttribLocation(k,c?c[e]:e,d[e]);a.linkProgram(k);return a.getProgramParameter(k,a.LINK_STATUS)?k:(lastError=a.getProgramInfoLog(k),error("Error in program linking: "+lastError),a.deleteProgram(k),null)};d.textureTileSet=function(a,b,d){var c=1/a,k=1/b;return{tile:function(a,b){var h=c*b,s=k*a;return{textureCoord:function(a,b){return[h+d+(c-2*d)*a,s+d+(k-2*d)*b]}}}}};return h}(BC||{});BC=function(h){(h.Selector=h.Selector||{}).makeSelector=function(d,a,b){var h=a.minY,c=a.maxY;a=BC.Math.circlePoints(a.outerRadius+0.005,a.numSlices,-Math.PI/2);var k=a.length-2,e=[],l=0;e[l++]=a[k]+0.001;e[l++]=h;e[l++]=-a[k+1]-0.001;e[l++]=a[0]+0.001;e[l++]=h;e[l++]=-a[1]-0.001;e[l++]=a[0]+0.001;e[l++]=c;e[l++]=-a[1]-0.001;e[l++]=a[k]+0.001;e[l++]=c;e[l++]=-a[k+1]-0.001;e[l++]=a[0]+0.001;e[l++]=h;e[l++]=-a[1]-0.001;e[l++]=a[2]+0.001;e[l++]=h;e[l++]=-a[3]-0.001;e[l++]=a[2]+0.001;e[l++]=c;e[l++]=
-a[3]-0.001;e[l++]=a[0]+0.001;e[l++]=c;e[l++]=-a[1]-0.001;var L=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,L);d.bufferData(d.ARRAY_BUFFER,new Float32Array(e),d.STATIC_DRAW);h=b.textureCoord(0,0);c=b.textureCoord(1,0);a=b.textureCoord(1,1);b=b.textureCoord(0,1);b=new Float32Array([].concat(h,c,a,b,h,c,a,b));var s=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,s);d.bufferData(d.ARRAY_BUFFER,b,d.STATIC_DRAW);var t=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7]),q=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,
q);d.bufferData(d.ELEMENT_ARRAY_BUFFER,t,d.STATIC_DRAW);return{draw:function(a,b){d.enable(d.BLEND);d.bindBuffer(d.ARRAY_BUFFER,L);d.enableVertexAttribArray(a);d.vertexAttribPointer(a,3,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,s);d.enableVertexAttribArray(b);d.vertexAttribPointer(b,2,d.FLOAT,!1,0,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,q);d.drawElements(d.TRIANGLES,t.length,d.UNSIGNED_SHORT,0);d.disable(d.BLEND)}}};return h}(BC||{});BC=function(h){(h.Game=h.Game||{}).run=function(){function d(){return h.width!=h.clientWidth||h.height!=h.clientHeight?(h.width=h.clientWidth,h.height=h.clientHeight,!0):!1}function a(){var a=h.width/h.height,b=BC.Math.radians(90);return BC.Matrix.makePerspective(b,a,1,2E3)}function b(){c.viewport(0,0,c.canvas.width,c.canvas.height);var a=BC.Time.getTimeInSeconds(),d=a-t;t=a;q[0]+=r[0]*d;q[1]+=r[1]*d;var e=BC.Matrix.makeZRotation(q[2]),a=BC.Matrix.makeYRotation(q[1]),d=BC.Matrix.makeXRotation(q[0]),
e=BC.Matrix.matrixMultiply(A,e),e=BC.Matrix.matrixMultiply(e,a),e=BC.Matrix.matrixMultiply(e,d),e=BC.Matrix.matrixMultiply(e,B),e=BC.Matrix.matrixMultiply(e,y),e=BC.Matrix.matrixMultiply(e,I);c.uniformMatrix4fv(s,!1,e);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT);c.bindBuffer(c.ARRAY_BUFFER,J);c.enableVertexAttribArray(l);c.vertexAttribPointer(l,3,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,K);c.enableVertexAttribArray(L);c.vertexAttribPointer(L,2,c.FLOAT,!1,0,0);c.drawArrays(c.TRIANGLES,0,f.length/
3);M.draw(l,L);requestAnimationFrame(b)}var h=document.getElementById("canvas");if(h){var c=h.getContext("webgl")||h.getContext("experimental-webgl");if(c){c.enable(c.CULL_FACE);c.enable(c.DEPTH_TEST);c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA);var k=BC.GL.loadShader(c,"vertex-shader",c.VERTEX_SHADER),e=BC.GL.loadShader(c,"fragment-shader",c.FRAGMENT_SHADER),k=BC.GL.createProgram(c,[k,e]);c.useProgram(k);var l=c.getAttribLocation(k,"a_position"),L=c.getAttribLocation(k,"a_texcoord"),s=c.getUniformLocation(k,
"u_matrix"),t=BC.Time.getTimeInSeconds(),q=[BC.Math.radians(0),BC.Math.radians(0),BC.Math.radians(0)],k=[1,1,1],A=BC.Matrix.makeScale(k[0],k[1],k[2]),k=[0,0,0],B=BC.Matrix.makeTranslation(k[0],k[1],k[2]),k=BC.Matrix.makeLookAt([0,0.75,2],[0,0,0],[0,1,0]),y=BC.Matrix.makeInverse(k),u=c.createTexture();c.bindTexture(c.TEXTURE_2D,u);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,1,1,0,c.RGBA,c.UNSIGNED_BYTE,new Uint8Array([255,0,0,255]));var v=new Image;v.src="images/block-texture.png";$(v).load(function(){c.bindTexture(c.TEXTURE_2D,
u);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,v);c.generateMipmap(c.TEXTURE_2D)});var r=[0,0,0];$(document).keydown(function(a){switch(a.keyCode){case 32:r[0]=0;r[1]=0;break;case 37:r[0]=0;r[1]=-1;break;case 38:r[0]=-1;r[1]=0;break;case 39:r[0]=0;r[1]=1;break;case 40:r[0]=1,r[1]=0}});for(var e=BC.Math.circlePoints(0.75,24),m=BC.Math.circlePoints(1,24),k=BC.GL.textureTileSet(4,4,0.01),F=[k.tile(0,0),k.tile(0,1),k.tile(0,2),k.tile(0,3),k.tile(1,0),k.tile(1,1)],k=k.tile(1,2),f=[],z=[],
C=0,w=function(a,b,c,d,e,f,g){b=a.textureCoord(b,c);z[C++]=b[0];z[C++]=b[1];b=a.textureCoord(d,e);z[C++]=b[0];z[C++]=b[1];b=a.textureCoord(f,g);z[C++]=b[0];z[C++]=b[1]},E=0,G=0,H=0,g=0,n=0;24>H;H++,n+=2){for(var p=(n+2)%m.length;G===E;)E=Math.floor(Math.random()*F.length);var G=E,x=F[E];f[g++]=e[n];f[g++]=0.15;f[g++]=-e[n+1];f[g++]=m[n];f[g++]=0.15;f[g++]=-m[n+1];f[g++]=m[p];f[g++]=0.15;f[g++]=-m[p+1];w(x,0,0,0,1,1,1);f[g++]=e[n];f[g++]=0.15;f[g++]=-e[n+1];f[g++]=m[p];f[g++]=0.15;f[g++]=-m[p+1];f[g++]=
e[p];f[g++]=0.15;f[g++]=-e[p+1];w(x,0,0,1,1,1,0);f[g++]=e[n];f[g++]=-0.15;f[g++]=-e[n+1];f[g++]=m[p];f[g++]=-0.15;f[g++]=-m[p+1];f[g++]=m[n];f[g++]=-0.15;f[g++]=-m[n+1];w(x,0,0,1,1,0,1);f[g++]=e[n];f[g++]=-0.15;f[g++]=-e[n+1];f[g++]=e[p];f[g++]=-0.15;f[g++]=-e[p+1];f[g++]=m[p];f[g++]=-0.15;f[g++]=-m[p+1];w(x,0,0,1,0,1,1);f[g++]=m[n];f[g++]=-0.15;f[g++]=-m[n+1];f[g++]=m[p];f[g++]=-0.15;f[g++]=-m[p+1];f[g++]=m[p];f[g++]=0.15;f[g++]=-m[p+1];w(x,0,1,1,1,1,0);f[g++]=m[n];f[g++]=-0.15;f[g++]=-m[n+1];f[g++]=
m[p];f[g++]=0.15;f[g++]=-m[p+1];f[g++]=m[n];f[g++]=0.15;f[g++]=-m[n+1];w(x,0,1,1,0,0,0);f[g++]=e[n];f[g++]=-0.15;f[g++]=-e[n+1];f[g++]=e[p];f[g++]=0.15;f[g++]=-e[p+1];f[g++]=e[p];f[g++]=-0.15;f[g++]=-e[p+1];w(x,0,1,1,0,1,1);f[g++]=e[n];f[g++]=-0.15;f[g++]=-e[n+1];f[g++]=e[n];f[g++]=0.15;f[g++]=-e[n+1];f[g++]=e[p];f[g++]=0.15;f[g++]=-e[p+1];w(x,0,1,0,0,1,0)}e=new Float32Array(f);m=new Float32Array(z);d();var I=a();$(window).resize(function(){d()&&(I=a())});var J=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,
J);c.bufferData(c.ARRAY_BUFFER,e,c.STATIC_DRAW);var K=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,K);c.bufferData(c.ARRAY_BUFFER,m,c.STATIC_DRAW);var M=BC.Selector.makeSelector(c,{numSlices:24,innerRadius:0.75,outerRadius:1,maxY:0.15,minY:-0.15},k);b()}}};return h}(BC||{});$(document).ready(function(){BC.Game.run()});BC=function(h){var d=h.Math=h.Math||{};d.radians=function(a){return a*Math.PI/180};d.circlePoints=function(a,b,d){d=d||0;for(var c=2*Math.PI/b,h=[],e=0;e<b;e++)h[2*e]=a*Math.cos(d+e*c),h[2*e+1]=a*Math.sin(d+e*c);return h};d.cross=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]};d.subtractVectors=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]};d.normalize=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return 1E-5<b?[a[0]/b,a[1]/b,a[2]/b]:[0,0,0]};
return h}(BC||{});BC=function(h){(h.Util=h.Util||{}).error=function(d){window.console&&(window.console.error?window.console.error(d):window.console.log&&window.console.log(d))};return h}(BC||{});
