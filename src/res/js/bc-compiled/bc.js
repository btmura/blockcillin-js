var BC=function(l){var d=l.Matrix=l.Matrix||{};d.makeLookAt=function(a,c,e){c=BC.Math.normalize(BC.Math.subtractVectors(a,c));e=BC.Math.cross(e,c);var b=BC.Math.cross(c,e);return[e[0],e[1],e[2],0,b[0],b[1],b[2],0,c[0],c[1],c[2],0,a[0],a[1],a[2],1]};d.makePerspective=function(a,c,e,b){a=Math.tan(0.5*Math.PI-0.5*a);var d=1/(e-b);return[a/c,0,0,0,0,a,0,0,0,0,(e+b)*d,-1,0,0,e*b*d*2,0]};d.makeTranslation=function(a,c,e){return[1,0,0,0,0,1,0,0,0,0,1,0,a,c,e,1]};d.makeXRotation=function(a){var c=Math.cos(a);
a=Math.sin(a);return[1,0,0,0,0,c,a,0,0,-a,c,0,0,0,0,1]};d.makeYRotation=function(a){var c=Math.cos(a);a=Math.sin(a);return[c,0,-a,0,0,1,0,0,a,0,c,0,0,0,0,1]};d.makeZRotation=function(a){var c=Math.cos(a);a=Math.sin(a);return[c,a,0,0,-a,c,0,0,0,0,1,0,0,0,0,1]};d.makeScale=function(a,c,e){return[a,0,0,0,0,c,0,0,0,0,e,0,0,0,0,1]};d.makeInverse=function(a){var c=a[0],e=a[1],b=a[2],d=a[3],h=a[4],g=a[5],l=a[6],q=a[7],p=a[8],s=a[9],x=a[10],r=a[11],f=a[12],m=a[13],n=a[14];a=a[15];var u=x*a,B=n*r,v=l*a,A=
n*q,F=l*r,G=x*q,H=b*a,I=n*d,E=b*r,t=x*d,C=b*q,w=l*d,y=p*m,D=f*s,z=h*m,J=f*g,K=h*s,L=p*g,M=c*m,N=f*e,O=c*s,P=p*e,Q=c*g,R=h*e,S=u*g+A*s+F*m-(B*g+v*s+G*m),T=B*e+H*s+t*m-(u*e+I*s+E*m),m=v*e+I*g+C*m-(A*e+H*g+w*m),e=G*e+E*g+w*s-(F*e+t*g+C*s),g=1/(c*S+h*T+p*m+f*e);return[g*S,g*T,g*m,g*e,g*(B*h+v*p+G*f-(u*h+A*p+F*f)),g*(u*c+I*p+E*f-(B*c+H*p+t*f)),g*(A*c+H*h+w*f-(v*c+I*h+C*f)),g*(F*c+t*h+C*p-(G*c+E*h+w*p)),g*(y*q+J*r+K*a-(D*q+z*r+L*a)),g*(D*d+M*r+P*a-(y*d+N*r+O*a)),g*(z*d+N*q+Q*a-(J*d+M*q+R*a)),g*(L*d+O*q+
R*r-(K*d+P*q+Q*r)),g*(z*x+L*n+D*l-(K*n+y*l+J*x)),g*(O*n+y*b+N*x-(M*x+P*n+D*b)),g*(M*l+R*n+J*b-(Q*n+z*b+N*l)),g*(Q*x+K*b+P*l-(O*l+R*x+L*b))]};d.matrixMultiply=function(a,c){return[a[0]*c[0]+a[1]*c[4]+a[2]*c[8]+a[3]*c[12],a[0]*c[1]+a[1]*c[5]+a[2]*c[9]+a[3]*c[13],a[0]*c[2]+a[1]*c[6]+a[2]*c[10]+a[3]*c[14],a[0]*c[3]+a[1]*c[7]+a[2]*c[11]+a[3]*c[15],a[4]*c[0]+a[5]*c[4]+a[6]*c[8]+a[7]*c[12],a[4]*c[1]+a[5]*c[5]+a[6]*c[9]+a[7]*c[13],a[4]*c[2]+a[5]*c[6]+a[6]*c[10]+a[7]*c[14],a[4]*c[3]+a[5]*c[7]+a[6]*c[11]+a[7]*
c[15],a[8]*c[0]+a[9]*c[4]+a[10]*c[8]+a[11]*c[12],a[8]*c[1]+a[9]*c[5]+a[10]*c[9]+a[11]*c[13],a[8]*c[2]+a[9]*c[6]+a[10]*c[10]+a[11]*c[14],a[8]*c[3]+a[9]*c[7]+a[10]*c[11]+a[11]*c[15],a[12]*c[0]+a[13]*c[4]+a[14]*c[8]+a[15]*c[12],a[12]*c[1]+a[13]*c[5]+a[14]*c[9]+a[15]*c[13],a[12]*c[2]+a[13]*c[6]+a[14]*c[10]+a[15]*c[14],a[12]*c[3]+a[13]*c[7]+a[14]*c[11]+a[15]*c[15]]};return l}(BC||{});BC=function(l){(l.Time=l.Time||{}).getTimeInSeconds=function(){return 0.001*Date.now()};return l}(BC||{});BC=function(l){(l.Ring=l.Ring||{}).makeRing=function(d,a,c){for(var e=a.numSlices,b=a.outerRadius,k=a.maxY,h=a.minY,g=BC.Math.circlePoints(a.innerRadius,e),e=BC.Math.circlePoints(b,e),b=[],l=[],q=0,p=function(a,b,c,d,e,f,g){b=a.textureCoord(b,c);l[q++]=b[0];l[q++]=b[1];b=a.textureCoord(d,e);l[q++]=b[0];l[q++]=b[1];b=a.textureCoord(f,g);l[q++]=b[0];l[q++]=b[1]},s=0,x=0,r=0,f=0,m=0;r<a.numSlices;r++,m+=2){for(var n=(m+2)%e.length;x===s;)s=Math.floor(Math.random()*c.length);var x=s,u=c[s];b[f++]=g[m];
b[f++]=k;b[f++]=-g[m+1];b[f++]=e[m];b[f++]=k;b[f++]=-e[m+1];b[f++]=e[n];b[f++]=k;b[f++]=-e[n+1];p(u,0,0,0,1,1,1);b[f++]=g[m];b[f++]=k;b[f++]=-g[m+1];b[f++]=e[n];b[f++]=k;b[f++]=-e[n+1];b[f++]=g[n];b[f++]=k;b[f++]=-g[n+1];p(u,0,0,1,1,1,0);b[f++]=g[m];b[f++]=h;b[f++]=-g[m+1];b[f++]=e[n];b[f++]=h;b[f++]=-e[n+1];b[f++]=e[m];b[f++]=h;b[f++]=-e[m+1];p(u,0,0,1,1,0,1);b[f++]=g[m];b[f++]=h;b[f++]=-g[m+1];b[f++]=g[n];b[f++]=h;b[f++]=-g[n+1];b[f++]=e[n];b[f++]=h;b[f++]=-e[n+1];p(u,0,0,1,0,1,1);b[f++]=e[m];b[f++]=
h;b[f++]=-e[m+1];b[f++]=e[n];b[f++]=h;b[f++]=-e[n+1];b[f++]=e[n];b[f++]=k;b[f++]=-e[n+1];p(u,0,1,1,1,1,0);b[f++]=e[m];b[f++]=h;b[f++]=-e[m+1];b[f++]=e[n];b[f++]=k;b[f++]=-e[n+1];b[f++]=e[m];b[f++]=k;b[f++]=-e[m+1];p(u,0,1,1,0,0,0);b[f++]=g[m];b[f++]=h;b[f++]=-g[m+1];b[f++]=g[n];b[f++]=k;b[f++]=-g[n+1];b[f++]=g[n];b[f++]=h;b[f++]=-g[n+1];p(u,0,1,1,0,1,1);b[f++]=g[m];b[f++]=h;b[f++]=-g[m+1];b[f++]=g[m];b[f++]=k;b[f++]=-g[m+1];b[f++]=g[n];b[f++]=k;b[f++]=-g[n+1];p(u,0,1,0,0,1,0)}var B=d.createBuffer();
d.bindBuffer(d.ARRAY_BUFFER,B);d.bufferData(d.ARRAY_BUFFER,new Float32Array(b),d.STATIC_DRAW);var v=b.length/3,A=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,A);d.bufferData(d.ARRAY_BUFFER,new Float32Array(l),d.STATIC_DRAW);return{draw:function(a,b){d.bindBuffer(d.ARRAY_BUFFER,B);d.enableVertexAttribArray(a);d.vertexAttribPointer(a,3,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,A);d.enableVertexAttribArray(b);d.vertexAttribPointer(b,2,d.FLOAT,!1,0,0);d.drawArrays(d.TRIANGLES,0,v)}}};return l}(BC||
{});BC=function(l){(l.Selector=l.Selector||{}).makeSelector=function(d,a,c){var e=a.minY,b=a.maxY;a=BC.Math.circlePoints(a.outerRadius+0.01,a.numSlices,-Math.PI/2);var k=a.length-2,h=[],g=0;h[g++]=a[k]+0.001;h[g++]=e;h[g++]=-a[k+1]-0.001;h[g++]=a[0]+0.001;h[g++]=e;h[g++]=-a[1]-0.001;h[g++]=a[0]+0.001;h[g++]=b;h[g++]=-a[1]-0.001;h[g++]=a[k]+0.001;h[g++]=b;h[g++]=-a[k+1]-0.001;h[g++]=a[0]+0.001;h[g++]=e;h[g++]=-a[1]-0.001;h[g++]=a[2]+0.001;h[g++]=e;h[g++]=-a[3]-0.001;h[g++]=a[2]+0.001;h[g++]=b;h[g++]=-a[3]-
0.001;h[g++]=a[0]+0.001;h[g++]=b;h[g++]=-a[1]-0.001;var l=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,l);d.bufferData(d.ARRAY_BUFFER,new Float32Array(h),d.STATIC_DRAW);e=c.textureCoord(0,0);b=c.textureCoord(1,0);a=c.textureCoord(1,1);c=c.textureCoord(0,1);c=new Float32Array([].concat(e,b,a,c,e,b,a,c));var q=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,q);d.bufferData(d.ARRAY_BUFFER,c,d.STATIC_DRAW);var p=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7]),s=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,
s);d.bufferData(d.ELEMENT_ARRAY_BUFFER,p,d.STATIC_DRAW);return{draw:function(a,b){d.enable(d.BLEND);d.bindBuffer(d.ARRAY_BUFFER,l);d.enableVertexAttribArray(a);d.vertexAttribPointer(a,3,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,q);d.enableVertexAttribArray(b);d.vertexAttribPointer(b,2,d.FLOAT,!1,0,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,s);d.drawElements(d.TRIANGLES,p.length,d.UNSIGNED_SHORT,0);d.disable(d.BLEND)}}};return l}(BC||{});BC=function(l){(l.Game=l.Game||{}).run=function(){function d(){return e.width!=e.clientWidth||e.height!=e.clientHeight?(e.width=e.clientWidth,e.height=e.clientHeight,!0):!1}function a(){var a=e.width/e.height,b=BC.Math.radians(90);return BC.Matrix.makePerspective(b,a,1,2E3)}function c(){b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.viewport(0,0,b.canvas.width,b.canvas.height);var a=BC.Time.getTimeInSeconds(),d=a-x;x=a;b.uniformMatrix4fv(q,!1,B);b.uniformMatrix4fv(p,!1,m);if(w!==t.NONE){y+d>C&&
(d=C-y);var e=d*E/C,h=d*I/C;switch(w){case t.UP:z[1]+=e;break;case t.DOWN:z[1]-=e;break;case t.LEFT:r[1]+=h;break;case t.RIGHT:r[1]-=h}y+=d;y>=C&&(w=t.NONE,y=0)}d=BC.Matrix.makeYRotation(r[1]);for(e=0;e<A.length;e++){var h=BC.Matrix.makeTranslation(0,-e*E,0),k=BC.Matrix.matrixMultiply(f,H),k=BC.Matrix.matrixMultiply(k,d),k=BC.Matrix.matrixMultiply(k,G),k=BC.Matrix.matrixMultiply(k,h);b.uniformMatrix4fv(s,!1,k);A[e].draw(g,l)}a=1+Math.abs(Math.sin(4*a))/50;a=BC.Matrix.makeScale(a,a,1);d=BC.Matrix.makeTranslation(z[0],
z[1],z[2]);a=BC.Matrix.matrixMultiply(a,d);b.uniformMatrix4fv(s,!1,a);F.draw(g,l);requestAnimationFrame(c)}var e=document.getElementById("canvas");if(e){var b=e.getContext("webgl")||e.getContext("experimental-webgl");if(b){b.enable(b.CULL_FACE);b.enable(b.DEPTH_TEST);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);var k=BC.GL.loadShader(b,"vertex-shader",b.VERTEX_SHADER),h=BC.GL.loadShader(b,"fragment-shader",b.FRAGMENT_SHADER),k=BC.GL.createProgram(b,[k,h]);b.useProgram(k);var g=b.getAttribLocation(k,
"a_position"),l=b.getAttribLocation(k,"a_texcoord"),q=b.getUniformLocation(k,"u_projectionMatrix"),p=b.getUniformLocation(k,"u_viewMatrix"),s=b.getUniformLocation(k,"u_matrix"),x=BC.Time.getTimeInSeconds(),r=[0,0,0],k=[1,1,1],f=BC.Matrix.makeScale(k[0],k[1],k[2]),k=BC.Matrix.makeLookAt([0,0.75,2],[0,0,0],[0,1,0]),m=BC.Matrix.makeInverse(k),n=b.createTexture();b.bindTexture(b.TEXTURE_2D,n);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,1,1,0,b.RGBA,b.UNSIGNED_BYTE,new Uint8Array([0,0,0,255]));var u=new Image;
u.src="images/textures.png";$(u).load(function(){b.bindTexture(b.TEXTURE_2D,n);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,u);b.generateMipmap(b.TEXTURE_2D)});k={numSlices:24,innerRadius:0.75,outerRadius:1,maxY:0.15,minY:-0.15};d();var B=a();$(window).resize(function(){d()&&(B=a())});var v=BC.GL.textureTileSet(4,4,0.002),h=[v.tile(0,0),v.tile(0,1),v.tile(0,2),v.tile(0,3),v.tile(1,0),v.tile(1,1)],v=v.tile(1,2),A=[BC.Ring.makeRing(b,k,h),BC.Ring.makeRing(b,k,h),BC.Ring.makeRing(b,k,h)],
F=BC.Selector.makeSelector(b,k,v),G=BC.Matrix.makeXRotation(r[0]);BC.Matrix.makeYRotation(r[1]);var H=BC.Matrix.makeZRotation(r[2]),I=2*Math.PI/24,E=0.3,t={NONE:0,UP:1,DOWN:2,LEFT:3,RIGHT:4},C=0.05,w=t.NONE,y=0,D=0,z=[0,0,0];$(document).keydown(function(a){switch(a.keyCode){case 37:w===t.NONE&&(w=t.LEFT,y=0);break;case 39:w===t.NONE&&(w=t.RIGHT,y=0);break;case 38:w===t.NONE&&0<D&&(w=t.UP,y=0,D--);break;case 40:w===t.NONE&&D+1<A.length&&(w=t.DOWN,y=0,D++)}});c()}}};return l}(BC||{});$(document).ready(function(){BC.Game.run()});BC=function(l){var d=l.Math=l.Math||{};d.radians=function(a){return a*Math.PI/180};d.circlePoints=function(a,c,d){d=d||0;for(var b=2*Math.PI/c,k=[],h=0;h<c;h++)k[2*h]=a*Math.cos(d+h*b),k[2*h+1]=a*Math.sin(d+h*b);return k};d.cross=function(a,c){return[a[1]*c[2]-a[2]*c[1],a[2]*c[0]-a[0]*c[2],a[0]*c[1]-a[1]*c[0]]};d.subtractVectors=function(a,c){return[a[0]-c[0],a[1]-c[1],a[2]-c[2]]};d.normalize=function(a){var c=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return 1E-5<c?[a[0]/c,a[1]/c,a[2]/c]:[0,0,0]};
return l}(BC||{});BC=function(l){var d=l.GL=l.GL||{};d.loadShader=function(a,c,d,b){b=b||BC.Util.error;var k=document.getElementById(c);if(!k)return b("** Error getting script element:"+c),null;c=a.createShader(d);a.shaderSource(c,k.text);a.compileShader(c);return a.getShaderParameter(c,a.COMPILE_STATUS)?c:(lastError=a.getShaderInfoLog(c),b("*** Error compiling shader '"+c+"':"+lastError),a.deleteShader(c),null)};d.createProgram=function(a,c,d,b){for(var k=a.createProgram(),h=0;h<c.length;h++)a.attachShader(k,c[h]);
if(d)for(h=0;h<d.length;h++)a.bindAttribLocation(k,b?b[h]:h,d[h]);a.linkProgram(k);return a.getProgramParameter(k,a.LINK_STATUS)?k:(lastError=a.getProgramInfoLog(k),error("Error in program linking: "+lastError),a.deleteProgram(k),null)};d.textureTileSet=function(a,c,d){var b=1/a,k=1/c;return{tile:function(a,c){var l=b*c,q=k*a;return{textureCoord:function(a,c){return[l+d+(b-2*d)*a,q+d+(k-2*d)*c]}}}}};return l}(BC||{});BC=function(l){(l.Util=l.Util||{}).error=function(d){window.console&&(window.console.error?window.console.error(d):window.console.log&&window.console.log(d))};return l}(BC||{});
