var BC=function(k){var d=k.Matrix=k.Matrix||{};d.makeLookAt=function(a,c,e){c=BC.Math.normalize(BC.Math.subtractVectors(a,c));e=BC.Math.cross(e,c);var b=BC.Math.cross(c,e);return[e[0],e[1],e[2],0,b[0],b[1],b[2],0,c[0],c[1],c[2],0,a[0],a[1],a[2],1]};d.makePerspective=function(a,c,e,b){a=Math.tan(0.5*Math.PI-0.5*a);var d=1/(e-b);return[a/c,0,0,0,0,a,0,0,0,0,(e+b)*d,-1,0,0,e*b*d*2,0]};d.makeTranslation=function(a,c,e){return[1,0,0,0,0,1,0,0,0,0,1,0,a,c,e,1]};d.makeXRotation=function(a){var c=Math.cos(a);
a=Math.sin(a);return[1,0,0,0,0,c,a,0,0,-a,c,0,0,0,0,1]};d.makeYRotation=function(a){var c=Math.cos(a);a=Math.sin(a);return[c,0,-a,0,0,1,0,0,a,0,c,0,0,0,0,1]};d.makeZRotation=function(a){var c=Math.cos(a);a=Math.sin(a);return[c,a,0,0,-a,c,0,0,0,0,1,0,0,0,0,1]};d.makeScale=function(a,c,e){return[a,0,0,0,0,c,0,0,0,0,e,0,0,0,0,1]};d.makeInverse=function(a){var c=a[0],e=a[1],b=a[2],d=a[3],h=a[4],g=a[5],k=a[6],q=a[7],p=a[8],r=a[9],v=a[10],s=a[11],f=a[12],l=a[13],n=a[14];a=a[15];var t=v*a,z=n*s,u=k*a,y=
n*q,F=k*s,G=v*q,E=b*a,H=n*d,A=b*s,B=v*d,D=b*q,C=k*d,w=p*l,x=f*r,I=h*l,J=f*g,K=h*r,L=p*g,M=c*l,N=f*e,O=c*r,P=p*e,Q=c*g,R=h*e,S=t*g+y*r+F*l-(z*g+u*r+G*l),T=z*e+E*r+B*l-(t*e+H*r+A*l),l=u*e+H*g+D*l-(y*e+E*g+C*l),e=G*e+A*g+C*r-(F*e+B*g+D*r),g=1/(c*S+h*T+p*l+f*e);return[g*S,g*T,g*l,g*e,g*(z*h+u*p+G*f-(t*h+y*p+F*f)),g*(t*c+H*p+A*f-(z*c+E*p+B*f)),g*(y*c+E*h+C*f-(u*c+H*h+D*f)),g*(F*c+B*h+D*p-(G*c+A*h+C*p)),g*(w*q+J*s+K*a-(x*q+I*s+L*a)),g*(x*d+M*s+P*a-(w*d+N*s+O*a)),g*(I*d+N*q+Q*a-(J*d+M*q+R*a)),g*(L*d+O*q+
R*s-(K*d+P*q+Q*s)),g*(I*v+L*n+x*k-(K*n+w*k+J*v)),g*(O*n+w*b+N*v-(M*v+P*n+x*b)),g*(M*k+R*n+J*b-(Q*n+I*b+N*k)),g*(Q*v+K*b+P*k-(O*k+R*v+L*b))]};d.matrixMultiply=function(a,c){return[a[0]*c[0]+a[1]*c[4]+a[2]*c[8]+a[3]*c[12],a[0]*c[1]+a[1]*c[5]+a[2]*c[9]+a[3]*c[13],a[0]*c[2]+a[1]*c[6]+a[2]*c[10]+a[3]*c[14],a[0]*c[3]+a[1]*c[7]+a[2]*c[11]+a[3]*c[15],a[4]*c[0]+a[5]*c[4]+a[6]*c[8]+a[7]*c[12],a[4]*c[1]+a[5]*c[5]+a[6]*c[9]+a[7]*c[13],a[4]*c[2]+a[5]*c[6]+a[6]*c[10]+a[7]*c[14],a[4]*c[3]+a[5]*c[7]+a[6]*c[11]+a[7]*
c[15],a[8]*c[0]+a[9]*c[4]+a[10]*c[8]+a[11]*c[12],a[8]*c[1]+a[9]*c[5]+a[10]*c[9]+a[11]*c[13],a[8]*c[2]+a[9]*c[6]+a[10]*c[10]+a[11]*c[14],a[8]*c[3]+a[9]*c[7]+a[10]*c[11]+a[11]*c[15],a[12]*c[0]+a[13]*c[4]+a[14]*c[8]+a[15]*c[12],a[12]*c[1]+a[13]*c[5]+a[14]*c[9]+a[15]*c[13],a[12]*c[2]+a[13]*c[6]+a[14]*c[10]+a[15]*c[14],a[12]*c[3]+a[13]*c[7]+a[14]*c[11]+a[15]*c[15]]};return k}(BC||{});BC=function(k){(k.Time=k.Time||{}).getTimeInSeconds=function(){return 0.001*Date.now()};return k}(BC||{});BC=function(k){(k.Ring=k.Ring||{}).makeRing=function(d,a,c){for(var e=a.numSlices,b=a.outerRadius,m=a.maxY,h=a.minY,g=BC.Math.circlePoints(a.innerRadius,e),e=BC.Math.circlePoints(b,e),b=[],k=[],q=0,p=function(a,b,c,d,e,f,g){b=a.textureCoord(b,c);k[q++]=b[0];k[q++]=b[1];b=a.textureCoord(d,e);k[q++]=b[0];k[q++]=b[1];b=a.textureCoord(f,g);k[q++]=b[0];k[q++]=b[1]},r=0,v=0,s=0,f=0,l=0;s<a.numSlices;s++,l+=2){for(var n=(l+2)%e.length;v===r;)r=Math.floor(Math.random()*c.length);var v=r,t=c[r];b[f++]=g[l];
b[f++]=m;b[f++]=-g[l+1];b[f++]=e[l];b[f++]=m;b[f++]=-e[l+1];b[f++]=e[n];b[f++]=m;b[f++]=-e[n+1];p(t,0,0,0,1,1,1);b[f++]=g[l];b[f++]=m;b[f++]=-g[l+1];b[f++]=e[n];b[f++]=m;b[f++]=-e[n+1];b[f++]=g[n];b[f++]=m;b[f++]=-g[n+1];p(t,0,0,1,1,1,0);b[f++]=g[l];b[f++]=h;b[f++]=-g[l+1];b[f++]=e[n];b[f++]=h;b[f++]=-e[n+1];b[f++]=e[l];b[f++]=h;b[f++]=-e[l+1];p(t,0,0,1,1,0,1);b[f++]=g[l];b[f++]=h;b[f++]=-g[l+1];b[f++]=g[n];b[f++]=h;b[f++]=-g[n+1];b[f++]=e[n];b[f++]=h;b[f++]=-e[n+1];p(t,0,0,1,0,1,1);b[f++]=e[l];b[f++]=
h;b[f++]=-e[l+1];b[f++]=e[n];b[f++]=h;b[f++]=-e[n+1];b[f++]=e[n];b[f++]=m;b[f++]=-e[n+1];p(t,0,1,1,1,1,0);b[f++]=e[l];b[f++]=h;b[f++]=-e[l+1];b[f++]=e[n];b[f++]=m;b[f++]=-e[n+1];b[f++]=e[l];b[f++]=m;b[f++]=-e[l+1];p(t,0,1,1,0,0,0);b[f++]=g[l];b[f++]=h;b[f++]=-g[l+1];b[f++]=g[n];b[f++]=m;b[f++]=-g[n+1];b[f++]=g[n];b[f++]=h;b[f++]=-g[n+1];p(t,0,1,1,0,1,1);b[f++]=g[l];b[f++]=h;b[f++]=-g[l+1];b[f++]=g[l];b[f++]=m;b[f++]=-g[l+1];b[f++]=g[n];b[f++]=m;b[f++]=-g[n+1];p(t,0,1,0,0,1,0)}var z=d.createBuffer();
d.bindBuffer(d.ARRAY_BUFFER,z);d.bufferData(d.ARRAY_BUFFER,new Float32Array(b),d.STATIC_DRAW);var u=b.length/3,y=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,y);d.bufferData(d.ARRAY_BUFFER,new Float32Array(k),d.STATIC_DRAW);return{draw:function(a,b){d.bindBuffer(d.ARRAY_BUFFER,z);d.enableVertexAttribArray(a);d.vertexAttribPointer(a,3,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,y);d.enableVertexAttribArray(b);d.vertexAttribPointer(b,2,d.FLOAT,!1,0,0);d.drawArrays(d.TRIANGLES,0,u)}}};return k}(BC||
{});BC=function(k){(k.Selector=k.Selector||{}).makeSelector=function(d,a,c){var e=a.minY,b=a.maxY;a=BC.Math.circlePoints(a.outerRadius+0.01,a.numSlices,-Math.PI/2);var m=a.length-2,h=[],g=0;h[g++]=a[m]+0.001;h[g++]=e;h[g++]=-a[m+1]-0.001;h[g++]=a[0]+0.001;h[g++]=e;h[g++]=-a[1]-0.001;h[g++]=a[0]+0.001;h[g++]=b;h[g++]=-a[1]-0.001;h[g++]=a[m]+0.001;h[g++]=b;h[g++]=-a[m+1]-0.001;h[g++]=a[0]+0.001;h[g++]=e;h[g++]=-a[1]-0.001;h[g++]=a[2]+0.001;h[g++]=e;h[g++]=-a[3]-0.001;h[g++]=a[2]+0.001;h[g++]=b;h[g++]=-a[3]-
0.001;h[g++]=a[0]+0.001;h[g++]=b;h[g++]=-a[1]-0.001;var k=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,k);d.bufferData(d.ARRAY_BUFFER,new Float32Array(h),d.STATIC_DRAW);e=c.textureCoord(0,0);b=c.textureCoord(1,0);a=c.textureCoord(1,1);c=c.textureCoord(0,1);c=new Float32Array([].concat(e,b,a,c,e,b,a,c));var q=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,q);d.bufferData(d.ARRAY_BUFFER,c,d.STATIC_DRAW);var p=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7]),r=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,
r);d.bufferData(d.ELEMENT_ARRAY_BUFFER,p,d.STATIC_DRAW);return{draw:function(a,b){d.enable(d.BLEND);d.bindBuffer(d.ARRAY_BUFFER,k);d.enableVertexAttribArray(a);d.vertexAttribPointer(a,3,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,q);d.enableVertexAttribArray(b);d.vertexAttribPointer(b,2,d.FLOAT,!1,0,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,r);d.drawElements(d.TRIANGLES,p.length,d.UNSIGNED_SHORT,0);d.disable(d.BLEND)}}};return k}(BC||{});BC=function(k){(k.Game=k.Game||{}).run=function(){function d(){return e.width!=e.clientWidth||e.height!=e.clientHeight?(e.width=e.clientWidth,e.height=e.clientHeight,!0):!1}function a(){var a=e.width/e.height,b=BC.Math.radians(90);return BC.Matrix.makePerspective(b,a,1,2E3)}function c(){b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.viewport(0,0,b.canvas.width,b.canvas.height);var a=BC.Time.getTimeInSeconds(),d=a-v;v=a;b.uniformMatrix4fv(q,!1,z);b.uniformMatrix4fv(p,!1,l);if(0!=w)if(d*=w,Math.abs(A)<
B){var e=A+d;0<w&&e>B?d-=e-B:0>w&&-e>B&&(d+=-e-B);A+=d;s[1]+=d}else A=w=0;E=BC.Matrix.makeYRotation(s[1]);for(d=0;d<y.length;d++){var e=BC.Matrix.makeTranslation(0,-d*D,0),h=BC.Matrix.matrixMultiply(f,H),h=BC.Matrix.matrixMultiply(h,E),h=BC.Matrix.matrixMultiply(h,G),h=BC.Matrix.matrixMultiply(h,e);b.uniformMatrix4fv(r,!1,h);y[d].draw(g,k)}a=1+Math.abs(Math.sin(4*a))/50;a=BC.Matrix.makeScale(a,a,1);d=BC.Matrix.makeTranslation(x[0],x[1],x[2]);a=BC.Matrix.matrixMultiply(a,d);b.uniformMatrix4fv(r,!1,
a);F.draw(g,k);requestAnimationFrame(c)}var e=document.getElementById("canvas");if(e){var b=e.getContext("webgl")||e.getContext("experimental-webgl");if(b){b.enable(b.CULL_FACE);b.enable(b.DEPTH_TEST);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);var m=BC.GL.loadShader(b,"vertex-shader",b.VERTEX_SHADER),h=BC.GL.loadShader(b,"fragment-shader",b.FRAGMENT_SHADER),m=BC.GL.createProgram(b,[m,h]);b.useProgram(m);var g=b.getAttribLocation(m,"a_position"),k=b.getAttribLocation(m,"a_texcoord"),q=b.getUniformLocation(m,
"u_projectionMatrix"),p=b.getUniformLocation(m,"u_viewMatrix"),r=b.getUniformLocation(m,"u_matrix"),v=BC.Time.getTimeInSeconds(),s=[0,0,0],m=[1,1,1],f=BC.Matrix.makeScale(m[0],m[1],m[2]),m=BC.Matrix.makeLookAt([0,0.75,2],[0,0,0],[0,1,0]),l=BC.Matrix.makeInverse(m),n=b.createTexture();b.bindTexture(b.TEXTURE_2D,n);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,1,1,0,b.RGBA,b.UNSIGNED_BYTE,new Uint8Array([0,0,0,255]));var t=new Image;t.src="images/textures.png";$(t).load(function(){b.bindTexture(b.TEXTURE_2D,n);
b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,t);b.generateMipmap(b.TEXTURE_2D)});m={numSlices:24,innerRadius:0.75,outerRadius:1,maxY:0.15,minY:-0.15};d();var z=a();$(window).resize(function(){d()&&(z=a())});var u=BC.GL.textureTileSet(4,4,0.002),h=[u.tile(0,0),u.tile(0,1),u.tile(0,2),u.tile(0,3),u.tile(1,0),u.tile(1,1)],u=u.tile(1,2),y=[BC.Ring.makeRing(b,m,h),BC.Ring.makeRing(b,m,h),BC.Ring.makeRing(b,m,h)],F=BC.Selector.makeSelector(b,m,u),G=BC.Matrix.makeXRotation(s[0]),E=BC.Matrix.makeYRotation(s[1]),
H=BC.Matrix.makeZRotation(s[2]),A=0,B=2*Math.PI/24,D=0.3,C=0,w=0,x=[0,0,0];$(document).keydown(function(a){switch(a.keyCode){case 37:0===w&&(w=4);break;case 39:0===w&&(w=-4);break;case 38:0<C&&(C--,x[1]+=D);break;case 40:C+1<y.length&&(C++,x[1]-=D)}});c()}}};return k}(BC||{});$(document).ready(function(){BC.Game.run()});BC=function(k){var d=k.Math=k.Math||{};d.radians=function(a){return a*Math.PI/180};d.circlePoints=function(a,c,d){d=d||0;for(var b=2*Math.PI/c,k=[],h=0;h<c;h++)k[2*h]=a*Math.cos(d+h*b),k[2*h+1]=a*Math.sin(d+h*b);return k};d.cross=function(a,c){return[a[1]*c[2]-a[2]*c[1],a[2]*c[0]-a[0]*c[2],a[0]*c[1]-a[1]*c[0]]};d.subtractVectors=function(a,c){return[a[0]-c[0],a[1]-c[1],a[2]-c[2]]};d.normalize=function(a){var c=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return 1E-5<c?[a[0]/c,a[1]/c,a[2]/c]:[0,0,0]};
return k}(BC||{});BC=function(k){var d=k.GL=k.GL||{};d.loadShader=function(a,c,d,b){b=b||BC.Util.error;var k=document.getElementById(c);if(!k)return b("** Error getting script element:"+c),null;c=a.createShader(d);a.shaderSource(c,k.text);a.compileShader(c);return a.getShaderParameter(c,a.COMPILE_STATUS)?c:(lastError=a.getShaderInfoLog(c),b("*** Error compiling shader '"+c+"':"+lastError),a.deleteShader(c),null)};d.createProgram=function(a,c,d,b){for(var k=a.createProgram(),h=0;h<c.length;h++)a.attachShader(k,c[h]);
if(d)for(h=0;h<d.length;h++)a.bindAttribLocation(k,b?b[h]:h,d[h]);a.linkProgram(k);return a.getProgramParameter(k,a.LINK_STATUS)?k:(lastError=a.getProgramInfoLog(k),error("Error in program linking: "+lastError),a.deleteProgram(k),null)};d.textureTileSet=function(a,c,d){var b=1/a,k=1/c;return{tile:function(a,c){var U=b*c,q=k*a;return{textureCoord:function(a,c){return[U+d+(b-2*d)*a,q+d+(k-2*d)*c]}}}}};return k}(BC||{});BC=function(k){(k.Util=k.Util||{}).error=function(d){window.console&&(window.console.error?window.console.error(d):window.console.log&&window.console.log(d))};return k}(BC||{});
